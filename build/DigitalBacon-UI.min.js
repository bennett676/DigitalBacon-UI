/*
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at https://mozilla.org/MPL/2.0/.
 */
import*as e from"three";import{TrianglesDrawMode as r,TriangleFanDrawMode as s,TriangleStripDrawMode as l,Quaternion as u,Matrix4 as h,Loader as p,LoaderUtils as m,FileLoader as v,Color as x,LinearSRGBColorSpace as b,SpotLight as _,PointLight as S,DirectionalLight as A,MeshBasicMaterial as C,SRGBColorSpace as R,MeshPhysicalMaterial as E,Vector2 as I,Vector3 as F,InstancedMesh as D,InstancedBufferAttribute as G,Object3D as B,TextureLoader as N,ImageBitmapLoader as j,BufferAttribute as H,InterleavedBuffer as X,InterleavedBufferAttribute as W,LinearFilter as z,LinearMipmapLinearFilter as V,RepeatWrapping as q,PointsMaterial as $,Material as K,LineBasicMaterial as Y,MeshStandardMaterial as J,DoubleSide as Q,PropertyBinding as Z,BufferGeometry as ee,SkinnedMesh as te,Mesh as re,LineSegments as ne,Line as se,LineLoop as oe,Points as ae,Group as ie,PerspectiveCamera as le,MathUtils as ce,OrthographicCamera as ue,Skeleton as he,AnimationClip as de,Bone as fe,InterpolateLinear as pe,ColorManagement as ge,NearestFilter as me,NearestMipmapNearestFilter as ve,LinearMipmapNearestFilter as ye,NearestMipmapLinearFilter as xe,ClampToEdgeWrapping as be,MirroredRepeatWrapping as _e,InterpolateDiscrete as Te,FrontSide as Se,Texture as Ae,VectorKeyframeTrack as we,NumberKeyframeTrack as Ce,QuaternionKeyframeTrack as Re,Box3 as Ee,Sphere as Ie,Interpolant as Ue,SphereGeometry as ke,Triangle as Fe,UniformsUtils as Me,MeshDepthMaterial as Le,RGBADepthPacking as Pe,MeshDistanceMaterial as De,ShaderChunk as Oe,InstancedBufferGeometry as Ge,BackSide as Be,Vector4 as Ne,Matrix3 as je,PlaneGeometry as He,Float32BufferAttribute as Xe}from"three";const We="IDLE",ze="HOVERED",Ve="SELECTED",uuidv4=()=>([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,(e=>(e^crypto.getRandomValues(new Uint8Array(1))[0]&15>>e/4).toString(16))),isDescendant=(e,r)=>{for(;r?.parent;){if(r.parent==e)return!0;r=r.parent}return!1};let qe=new class{constructor(){this._tool=null,this._listeners={}}getTool(){return this._tool}setTool(e){this._tool=e;for(let r in this._listeners)this._listeners[r](e)}addUpdateListener(e){let r=uuidv4();return this._listeners[r]=e,r}removeUpdateListener(e){delete this._lisreners[e]}};class Interactable{constructor(e){this._threeObj=e,this._state=We,this.children=new Set,this._hoveredOwners=new Set,this._selectedOwners=new Set,this._actions={},this._actionsLength=0,this._toolCounts={}}addAction(e){let r=uuidv4(),s={id:r,tool:e};return this._actions[r]=s,this._actionsLength=Object.keys(this._actions).length,e=e||"none",this._toolCounts[e]||(this._toolCounts[e]=0),this._toolCounts[e]++,s}removeAction(e){let r=this._actions[e];return delete this._actions[e],this._actionsLength=Object.keys(this._actions).length,r&&this._toolCounts[r.tool||"none"]--,r}getActionsLength(e){return e?this._toolCounts[e]:this._actionsLength}supportsTool(){let e=qe.getTool();return this._toolCounts.none||this._toolCounts[e]}isOnlyGroup(){return!this.supportsTool()}getObject(){return this._threeObj}getState(){return this._state}setState(e){this._state!=e&&(this._state=e,this._stateCallback&&this._stateCallback(e))}setStateCallback(e){this._stateCallback=e}setHoveredCallback(e){this._hoveredCallback=e}_determineAndSetState(){this._selectedOwners.size>0?this.setState(Ve):this._hoveredOwners.size>0?this.setState(ze):this.setState(We)}addHoveredBy(e){this._hoveredOwners.has(e)||(this._hoveredOwners.add(e),1==this._hoveredOwners.size&&this._hoveredCallback&&this._hoveredCallback(!0),0==this._selectedOwners.size&&this.setState(ze))}removeHoveredBy(e){this._hoveredOwners.delete(e),0==this._hoveredOwners.size&&this._hoveredCallback&&this._hoveredCallback(!1),this._determineAndSetState()}addSelectedBy(e){console.error("Interactable.addSelectedBy(owner) must be overridden")}removeSelectedBy(e){console.error("Interactable.removeSelectedBy(owner) must be overridden")}reset(){this._hoveredOwners.clear(),this._selectedOwners.clear(),this.setState(We),this.children.forEach((e=>{e.reset()}))}addChild(e){e.parent!=this&&(e.parent&&e.parent.removeChild(e),this.children.add(e),e.parent=this)}addChildren(e){e.forEach((e=>{this.addChild(e)}))}removeChild(e){this.children.delete(e),e.parent=null}removeChildren(e){e.forEach((e=>{this.removeChild(e)}))}}const $e=new e.Vector3;class GripInteractable extends Interactable{constructor(e){super(e),e&&(e.gripInteractable=this),this._createBoundingObject()}addAction(e,r,s){if(e&&"object"==typeof e)return this._actions[e.id]||this._toolCounts[e.tool||"none"]++,this._actions[e.id]=e,this._actionsLength=Object.keys(this._actions).length,e;let l=super.addAction(s);return l.selectedAction=e,l.releasedAction=r,l.selectedBy=new Set,l.type="GRIP",l}_createBoundingObject(){this._boundingBox=new e.Box3}_getBoundingObject(){return this._boundingBox.setFromObject(this._threeObj),this._boundingBox}intersectsSphere(e){let r,s=this._getBoundingObject();return r=!!s&&e.intersectsBox(s),r}distanceToSphere(e){return e.distanceToPoint(this._boundingBox.getCenter($e))}addSelectedBy(e){this._triggerSelected(e),this._selectedOwners.add(e),this.setState(Ve)}removeSelectedBy(e){this._triggerReleased(e),this._selectedOwners.delete(e),this._determineAndSetState()}_triggerSelected(e){let r=qe.getTool(),s=Object.keys(this._actions);for(let l of s){let s=this._actions[l];s&&(s.tool&&s.tool!=r||(s.selectedAction&&s.selectedAction(e),s.selectedBy.add(e)))}}_triggerReleased(e){let r=Object.keys(this._actions);for(let s of r){let r=this._actions[s];r&&(r.selectedBy.has(e)&&(r.releasedAction&&r.releasedAction(e),r.selectedBy.delete(e)))}}static emptyGroup(){return new GripInteractable}}class PointerInteractable extends Interactable{constructor(e){super(e),e&&(e.pointerInteractable=this),this._maxDistance=-1/0}addAction(e,r,s,l,u){if(e&&"object"==typeof e)return this._actions[e.id]||this._toolCounts[e.tool||"none"]++,this._actions[e.id]=e,this._actionsLength=Object.keys(this._actions).length,e;s||(s=1/0),s>this._maxDistance&&(this._maxDistance=s);let h=super.addAction(l,u);return h.clickAction=e,h.draggableAction=r,h.draggingOwners=new Set,h.maxDistance=s,h.type="POINTER",h}removeAction(e){let r=super.removeAction(e);if(r&&r.maxDistance==this._maxDistance){this._maxDistance=-1/0;for(let e in this._actions)this._actions[e].maxDistance>this._maxDistance&&(this._maxDistance=this._actions[e].maxDistance)}return r}isWithinReach(e){return e<this._maxDistance}addHoveredBy(e,r,s){this._hoveredOwners.has(e)||(this._selectedOwners.has(e)&&this.triggerActions(e,r,s),this._hoveredOwners.add(e),1==this._hoveredOwners.size&&this._hoveredCallback&&this._hoveredCallback(!0),0==this._selectedOwners.size&&this.setState(ze))}addSelectedBy(e,r,s){this._selectedOwners.add(e),this.setState(Ve),this.triggerDraggableActions(e,r,s)}removeSelectedBy(e){this._hoveredOwners.has(e)||this.releaseDraggedActions(e),this._selectedOwners.delete(e),this._determineAndSetState()}triggerActions(e,r,s){let l=Object.keys(this._actions),u=qe.getTool();for(let h of l){let l=this._actions[h];l&&(!l.clickAction||l.tool&&l.tool!=u||!(l.maxDistance>=s||l.draggingOwners.has(e))||l.clickAction(e,r),l.draggingOwners.has(e)&&l.draggingOwners.delete(e))}}triggerDraggableActions(e,r,s){let l=Object.keys(this._actions),u=qe.getTool();for(let h of l){let l=this._actions[h];l&&(!l.draggableAction||l.tool&&l.tool!=u||!(l.draggingOwners.has(e)||l.maxDistance>=s)||(l.draggableAction(e,r),l.isDragging=!0,l.draggingOwners.has(e)||l.draggingOwners.add(e)))}}releaseDraggedActions(e){let r=Object.keys(this._actions);for(let s of r){let r=this._actions[s];r&&(r.draggingOwners.has(e)&&(r.clickAction&&r.clickAction(e),r.draggingOwners.delete(e)))}}static emptyGroup(){return new PointerInteractable}static createDraggable(e,r,s){let l=new PointerInteractable(e,!0,null);return l.addAction(r,s),l}}const Ke={LEFT:"LEFT",RIGHT:"RIGHT",otherHand:e=>e==Ke.LEFT?Ke.RIGHT:e==Ke.RIGHT?Ke.LEFT:void console.error("ERROR: Unexpected hand provided to Handedness.otherHand")},Ye={CONTROLLER:"CONTROLLER",HAND:"HAND",OTHER:"OTHER"};function toTrianglesDrawMode(e,u){if(u===r)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),e;if(u===s||u===l){let r=e.getIndex();if(null===r){const s=[],l=e.getAttribute("position");if(void 0===l)return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),e;for(let e=0;e<l.count;e++)s.push(e);e.setIndex(s),r=e.getIndex()}const l=r.count-2,h=[];if(u===s)for(let e=1;e<=l;e++)h.push(r.getX(0)),h.push(r.getX(e)),h.push(r.getX(e+1));else for(let e=0;e<l;e++)e%2==0?(h.push(r.getX(e)),h.push(r.getX(e+1)),h.push(r.getX(e+2))):(h.push(r.getX(e+2)),h.push(r.getX(e+1)),h.push(r.getX(e)));h.length/3!==l&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const p=e.clone();return p.setIndex(h),p.clearGroups(),p}return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",u),e}class GLTFLoader extends p{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register((function(e){return new GLTFMaterialsClearcoatExtension(e)})),this.register((function(e){return new GLTFTextureBasisUExtension(e)})),this.register((function(e){return new GLTFTextureWebPExtension(e)})),this.register((function(e){return new GLTFTextureAVIFExtension(e)})),this.register((function(e){return new GLTFMaterialsSheenExtension(e)})),this.register((function(e){return new GLTFMaterialsTransmissionExtension(e)})),this.register((function(e){return new GLTFMaterialsVolumeExtension(e)})),this.register((function(e){return new GLTFMaterialsIorExtension(e)})),this.register((function(e){return new GLTFMaterialsEmissiveStrengthExtension(e)})),this.register((function(e){return new GLTFMaterialsSpecularExtension(e)})),this.register((function(e){return new GLTFMaterialsIridescenceExtension(e)})),this.register((function(e){return new GLTFMaterialsAnisotropyExtension(e)})),this.register((function(e){return new GLTFMaterialsBumpExtension(e)})),this.register((function(e){return new GLTFLightsExtension(e)})),this.register((function(e){return new GLTFMeshoptCompression(e)})),this.register((function(e){return new GLTFMeshGpuInstancing(e)}))}load(e,r,s,l){const u=this;let h;if(""!==this.resourcePath)h=this.resourcePath;else if(""!==this.path){const r=m.extractUrlBase(e);h=m.resolveURL(r,this.path)}else h=m.extractUrlBase(e);this.manager.itemStart(e);const _onError=function(r){l?l(r):console.error(r),u.manager.itemError(e),u.manager.itemEnd(e)},p=new v(this.manager);p.setPath(this.path),p.setResponseType("arraybuffer"),p.setRequestHeader(this.requestHeader),p.setWithCredentials(this.withCredentials),p.load(e,(function(s){try{u.parse(s,h,(function(s){r(s),u.manager.itemEnd(e)}),_onError)}catch(e){_onError(e)}}),s,_onError)}setDRACOLoader(e){return this.dracoLoader=e,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return-1===this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.push(e),this}unregister(e){return-1!==this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,r,s,l){let u;const h={},p={},m=new TextDecoder;if("string"==typeof e)u=JSON.parse(e);else if(e instanceof ArrayBuffer){if(m.decode(new Uint8Array(e,0,4))===Qe){try{h[Je.KHR_BINARY_GLTF]=new GLTFBinaryExtension(e)}catch(e){return void(l&&l(e))}u=JSON.parse(h[Je.KHR_BINARY_GLTF].content)}else u=JSON.parse(m.decode(e))}else u=e;if(void 0===u.asset||u.asset.version[0]<2)return void(l&&l(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported.")));const v=new GLTFParser(u,{path:r||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});v.fileLoader.setRequestHeader(this.requestHeader);for(let e=0;e<this.pluginCallbacks.length;e++){const r=this.pluginCallbacks[e](v);r.name||console.error("THREE.GLTFLoader: Invalid plugin found: missing name"),p[r.name]=r,h[r.name]=!0}if(u.extensionsUsed)for(let e=0;e<u.extensionsUsed.length;++e){const r=u.extensionsUsed[e],s=u.extensionsRequired||[];switch(r){case Je.KHR_MATERIALS_UNLIT:h[r]=new GLTFMaterialsUnlitExtension;break;case Je.KHR_DRACO_MESH_COMPRESSION:h[r]=new GLTFDracoMeshCompressionExtension(u,this.dracoLoader);break;case Je.KHR_TEXTURE_TRANSFORM:h[r]=new GLTFTextureTransformExtension;break;case Je.KHR_MESH_QUANTIZATION:h[r]=new GLTFMeshQuantizationExtension;break;default:s.indexOf(r)>=0&&void 0===p[r]&&console.warn('THREE.GLTFLoader: Unknown extension "'+r+'".')}}v.setExtensions(h),v.setPlugins(p),v.parse(s,l)}parseAsync(e,r){const s=this;return new Promise((function(l,u){s.parse(e,r,l,u)}))}}function GLTFRegistry(){let e={};return{get:function(r){return e[r]},add:function(r,s){e[r]=s},remove:function(r){delete e[r]},removeAll:function(){e={}}}}const Je={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_ANISOTROPY:"KHR_materials_anisotropy",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_MATERIALS_BUMP:"EXT_materials_bump",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class GLTFLightsExtension{constructor(e){this.parser=e,this.name=Je.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const e=this.parser,r=this.parser.json.nodes||[];for(let s=0,l=r.length;s<l;s++){const l=r[s];l.extensions&&l.extensions[this.name]&&void 0!==l.extensions[this.name].light&&e._addNodeRef(this.cache,l.extensions[this.name].light)}}_loadLight(e){const r=this.parser,s="light:"+e;let l=r.cache.get(s);if(l)return l;const u=r.json,h=((u.extensions&&u.extensions[this.name]||{}).lights||[])[e];let p;const m=new x(16777215);void 0!==h.color&&m.setRGB(h.color[0],h.color[1],h.color[2],b);const v=void 0!==h.range?h.range:0;switch(h.type){case"directional":p=new A(m),p.target.position.set(0,0,-1),p.add(p.target);break;case"point":p=new S(m),p.distance=v;break;case"spot":p=new _(m),p.distance=v,h.spot=h.spot||{},h.spot.innerConeAngle=void 0!==h.spot.innerConeAngle?h.spot.innerConeAngle:0,h.spot.outerConeAngle=void 0!==h.spot.outerConeAngle?h.spot.outerConeAngle:Math.PI/4,p.angle=h.spot.outerConeAngle,p.penumbra=1-h.spot.innerConeAngle/h.spot.outerConeAngle,p.target.position.set(0,0,-1),p.add(p.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+h.type)}return p.position.set(0,0,0),p.decay=2,assignExtrasToUserData(p,h),void 0!==h.intensity&&(p.intensity=h.intensity),p.name=r.createUniqueName(h.name||"light_"+e),l=Promise.resolve(p),r.cache.add(s,l),l}getDependency(e,r){if("light"===e)return this._loadLight(r)}createNodeAttachment(e){const r=this,s=this.parser,l=s.json.nodes[e],u=(l.extensions&&l.extensions[this.name]||{}).light;return void 0===u?null:this._loadLight(u).then((function(e){return s._getNodeRef(r.cache,u,e)}))}}class GLTFMaterialsUnlitExtension{constructor(){this.name=Je.KHR_MATERIALS_UNLIT}getMaterialType(){return C}extendParams(e,r,s){const l=[];e.color=new x(1,1,1),e.opacity=1;const u=r.pbrMetallicRoughness;if(u){if(Array.isArray(u.baseColorFactor)){const r=u.baseColorFactor;e.color.setRGB(r[0],r[1],r[2],b),e.opacity=r[3]}void 0!==u.baseColorTexture&&l.push(s.assignTexture(e,"map",u.baseColorTexture,R))}return Promise.all(l)}}class GLTFMaterialsEmissiveStrengthExtension{constructor(e){this.parser=e,this.name=Je.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(e,r){const s=this.parser.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const l=s.extensions[this.name].emissiveStrength;return void 0!==l&&(r.emissiveIntensity=l),Promise.resolve()}}class GLTFMaterialsClearcoatExtension{constructor(e){this.parser=e,this.name=Je.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){const r=this.parser.json.materials[e];return r.extensions&&r.extensions[this.name]?E:null}extendMaterialParams(e,r){const s=this.parser,l=s.json.materials[e];if(!l.extensions||!l.extensions[this.name])return Promise.resolve();const u=[],h=l.extensions[this.name];if(void 0!==h.clearcoatFactor&&(r.clearcoat=h.clearcoatFactor),void 0!==h.clearcoatTexture&&u.push(s.assignTexture(r,"clearcoatMap",h.clearcoatTexture)),void 0!==h.clearcoatRoughnessFactor&&(r.clearcoatRoughness=h.clearcoatRoughnessFactor),void 0!==h.clearcoatRoughnessTexture&&u.push(s.assignTexture(r,"clearcoatRoughnessMap",h.clearcoatRoughnessTexture)),void 0!==h.clearcoatNormalTexture&&(u.push(s.assignTexture(r,"clearcoatNormalMap",h.clearcoatNormalTexture)),void 0!==h.clearcoatNormalTexture.scale)){const e=h.clearcoatNormalTexture.scale;r.clearcoatNormalScale=new I(e,e)}return Promise.all(u)}}class GLTFMaterialsIridescenceExtension{constructor(e){this.parser=e,this.name=Je.KHR_MATERIALS_IRIDESCENCE}getMaterialType(e){const r=this.parser.json.materials[e];return r.extensions&&r.extensions[this.name]?E:null}extendMaterialParams(e,r){const s=this.parser,l=s.json.materials[e];if(!l.extensions||!l.extensions[this.name])return Promise.resolve();const u=[],h=l.extensions[this.name];return void 0!==h.iridescenceFactor&&(r.iridescence=h.iridescenceFactor),void 0!==h.iridescenceTexture&&u.push(s.assignTexture(r,"iridescenceMap",h.iridescenceTexture)),void 0!==h.iridescenceIor&&(r.iridescenceIOR=h.iridescenceIor),void 0===r.iridescenceThicknessRange&&(r.iridescenceThicknessRange=[100,400]),void 0!==h.iridescenceThicknessMinimum&&(r.iridescenceThicknessRange[0]=h.iridescenceThicknessMinimum),void 0!==h.iridescenceThicknessMaximum&&(r.iridescenceThicknessRange[1]=h.iridescenceThicknessMaximum),void 0!==h.iridescenceThicknessTexture&&u.push(s.assignTexture(r,"iridescenceThicknessMap",h.iridescenceThicknessTexture)),Promise.all(u)}}class GLTFMaterialsSheenExtension{constructor(e){this.parser=e,this.name=Je.KHR_MATERIALS_SHEEN}getMaterialType(e){const r=this.parser.json.materials[e];return r.extensions&&r.extensions[this.name]?E:null}extendMaterialParams(e,r){const s=this.parser,l=s.json.materials[e];if(!l.extensions||!l.extensions[this.name])return Promise.resolve();const u=[];r.sheenColor=new x(0,0,0),r.sheenRoughness=0,r.sheen=1;const h=l.extensions[this.name];if(void 0!==h.sheenColorFactor){const e=h.sheenColorFactor;r.sheenColor.setRGB(e[0],e[1],e[2],b)}return void 0!==h.sheenRoughnessFactor&&(r.sheenRoughness=h.sheenRoughnessFactor),void 0!==h.sheenColorTexture&&u.push(s.assignTexture(r,"sheenColorMap",h.sheenColorTexture,R)),void 0!==h.sheenRoughnessTexture&&u.push(s.assignTexture(r,"sheenRoughnessMap",h.sheenRoughnessTexture)),Promise.all(u)}}class GLTFMaterialsTransmissionExtension{constructor(e){this.parser=e,this.name=Je.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){const r=this.parser.json.materials[e];return r.extensions&&r.extensions[this.name]?E:null}extendMaterialParams(e,r){const s=this.parser,l=s.json.materials[e];if(!l.extensions||!l.extensions[this.name])return Promise.resolve();const u=[],h=l.extensions[this.name];return void 0!==h.transmissionFactor&&(r.transmission=h.transmissionFactor),void 0!==h.transmissionTexture&&u.push(s.assignTexture(r,"transmissionMap",h.transmissionTexture)),Promise.all(u)}}class GLTFMaterialsVolumeExtension{constructor(e){this.parser=e,this.name=Je.KHR_MATERIALS_VOLUME}getMaterialType(e){const r=this.parser.json.materials[e];return r.extensions&&r.extensions[this.name]?E:null}extendMaterialParams(e,r){const s=this.parser,l=s.json.materials[e];if(!l.extensions||!l.extensions[this.name])return Promise.resolve();const u=[],h=l.extensions[this.name];r.thickness=void 0!==h.thicknessFactor?h.thicknessFactor:0,void 0!==h.thicknessTexture&&u.push(s.assignTexture(r,"thicknessMap",h.thicknessTexture)),r.attenuationDistance=h.attenuationDistance||1/0;const p=h.attenuationColor||[1,1,1];return r.attenuationColor=(new x).setRGB(p[0],p[1],p[2],b),Promise.all(u)}}class GLTFMaterialsIorExtension{constructor(e){this.parser=e,this.name=Je.KHR_MATERIALS_IOR}getMaterialType(e){const r=this.parser.json.materials[e];return r.extensions&&r.extensions[this.name]?E:null}extendMaterialParams(e,r){const s=this.parser.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const l=s.extensions[this.name];return r.ior=void 0!==l.ior?l.ior:1.5,Promise.resolve()}}class GLTFMaterialsSpecularExtension{constructor(e){this.parser=e,this.name=Je.KHR_MATERIALS_SPECULAR}getMaterialType(e){const r=this.parser.json.materials[e];return r.extensions&&r.extensions[this.name]?E:null}extendMaterialParams(e,r){const s=this.parser,l=s.json.materials[e];if(!l.extensions||!l.extensions[this.name])return Promise.resolve();const u=[],h=l.extensions[this.name];r.specularIntensity=void 0!==h.specularFactor?h.specularFactor:1,void 0!==h.specularTexture&&u.push(s.assignTexture(r,"specularIntensityMap",h.specularTexture));const p=h.specularColorFactor||[1,1,1];return r.specularColor=(new x).setRGB(p[0],p[1],p[2],b),void 0!==h.specularColorTexture&&u.push(s.assignTexture(r,"specularColorMap",h.specularColorTexture,R)),Promise.all(u)}}class GLTFMaterialsBumpExtension{constructor(e){this.parser=e,this.name=Je.EXT_MATERIALS_BUMP}getMaterialType(e){const r=this.parser.json.materials[e];return r.extensions&&r.extensions[this.name]?E:null}extendMaterialParams(e,r){const s=this.parser,l=s.json.materials[e];if(!l.extensions||!l.extensions[this.name])return Promise.resolve();const u=[],h=l.extensions[this.name];return r.bumpScale=void 0!==h.bumpFactor?h.bumpFactor:1,void 0!==h.bumpTexture&&u.push(s.assignTexture(r,"bumpMap",h.bumpTexture)),Promise.all(u)}}class GLTFMaterialsAnisotropyExtension{constructor(e){this.parser=e,this.name=Je.KHR_MATERIALS_ANISOTROPY}getMaterialType(e){const r=this.parser.json.materials[e];return r.extensions&&r.extensions[this.name]?E:null}extendMaterialParams(e,r){const s=this.parser,l=s.json.materials[e];if(!l.extensions||!l.extensions[this.name])return Promise.resolve();const u=[],h=l.extensions[this.name];return void 0!==h.anisotropyStrength&&(r.anisotropy=h.anisotropyStrength),void 0!==h.anisotropyRotation&&(r.anisotropyRotation=h.anisotropyRotation),void 0!==h.anisotropyTexture&&u.push(s.assignTexture(r,"anisotropyMap",h.anisotropyTexture)),Promise.all(u)}}class GLTFTextureBasisUExtension{constructor(e){this.parser=e,this.name=Je.KHR_TEXTURE_BASISU}loadTexture(e){const r=this.parser,s=r.json,l=s.textures[e];if(!l.extensions||!l.extensions[this.name])return null;const u=l.extensions[this.name],h=r.options.ktx2Loader;if(!h){if(s.extensionsRequired&&s.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return r.loadTextureImage(e,u.source,h)}}class GLTFTextureWebPExtension{constructor(e){this.parser=e,this.name=Je.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){const r=this.name,s=this.parser,l=s.json,u=l.textures[e];if(!u.extensions||!u.extensions[r])return null;const h=u.extensions[r],p=l.images[h.source];let m=s.textureLoader;if(p.uri){const e=s.options.manager.getHandler(p.uri);null!==e&&(m=e)}return this.detectSupport().then((function(u){if(u)return s.loadTextureImage(e,h.source,m);if(l.extensionsRequired&&l.extensionsRequired.indexOf(r)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return s.loadTexture(e)}))}detectSupport(){return this.isSupported||(this.isSupported=new Promise((function(e){const r=new Image;r.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",r.onload=r.onerror=function(){e(1===r.height)}}))),this.isSupported}}class GLTFTextureAVIFExtension{constructor(e){this.parser=e,this.name=Je.EXT_TEXTURE_AVIF,this.isSupported=null}loadTexture(e){const r=this.name,s=this.parser,l=s.json,u=l.textures[e];if(!u.extensions||!u.extensions[r])return null;const h=u.extensions[r],p=l.images[h.source];let m=s.textureLoader;if(p.uri){const e=s.options.manager.getHandler(p.uri);null!==e&&(m=e)}return this.detectSupport().then((function(u){if(u)return s.loadTextureImage(e,h.source,m);if(l.extensionsRequired&&l.extensionsRequired.indexOf(r)>=0)throw new Error("THREE.GLTFLoader: AVIF required by asset but unsupported.");return s.loadTexture(e)}))}detectSupport(){return this.isSupported||(this.isSupported=new Promise((function(e){const r=new Image;r.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABcAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAB9tZGF0EgAKCBgABogQEDQgMgkQAAAAB8dSLfI=",r.onload=r.onerror=function(){e(1===r.height)}}))),this.isSupported}}class GLTFMeshoptCompression{constructor(e){this.name=Je.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){const r=this.parser.json,s=r.bufferViews[e];if(s.extensions&&s.extensions[this.name]){const e=s.extensions[this.name],l=this.parser.getDependency("buffer",e.buffer),u=this.parser.options.meshoptDecoder;if(!u||!u.supported){if(r.extensionsRequired&&r.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return l.then((function(r){const s=e.byteOffset||0,l=e.byteLength||0,h=e.count,p=e.byteStride,m=new Uint8Array(r,s,l);return u.decodeGltfBufferAsync?u.decodeGltfBufferAsync(h,p,m,e.mode,e.filter).then((function(e){return e.buffer})):u.ready.then((function(){const r=new ArrayBuffer(h*p);return u.decodeGltfBuffer(new Uint8Array(r),h,p,m,e.mode,e.filter),r}))}))}return null}}class GLTFMeshGpuInstancing{constructor(e){this.name=Je.EXT_MESH_GPU_INSTANCING,this.parser=e}createNodeMesh(e){const r=this.parser.json,s=r.nodes[e];if(!s.extensions||!s.extensions[this.name]||void 0===s.mesh)return null;const l=r.meshes[s.mesh];for(const e of l.primitives)if(e.mode!==rt.TRIANGLES&&e.mode!==rt.TRIANGLE_STRIP&&e.mode!==rt.TRIANGLE_FAN&&void 0!==e.mode)return null;const p=s.extensions[this.name].attributes,m=[],v={};for(const e in p)m.push(this.parser.getDependency("accessor",p[e]).then((r=>(v[e]=r,v[e]))));return m.length<1?null:(m.push(this.parser.createNodeMesh(e)),Promise.all(m).then((e=>{const r=e.pop(),s=r.isGroup?r.children:[r],l=e[0].count,p=[];for(const e of s){const r=new h,s=new F,m=new u,x=new F(1,1,1),b=new D(e.geometry,e.material,l);for(let e=0;e<l;e++)v.TRANSLATION&&s.fromBufferAttribute(v.TRANSLATION,e),v.ROTATION&&m.fromBufferAttribute(v.ROTATION,e),v.SCALE&&x.fromBufferAttribute(v.SCALE,e),b.setMatrixAt(e,r.compose(s,m,x));for(const r in v)if("_COLOR_0"===r){const e=v[r];b.instanceColor=new G(e.array,e.itemSize,e.normalized)}else"TRANSLATION"!==r&&"ROTATION"!==r&&"SCALE"!==r&&e.geometry.setAttribute(r,v[r]);B.prototype.copy.call(b,e),this.parser.assignFinalMaterial(b),p.push(b)}return r.isGroup?(r.clear(),r.add(...p),r):p[0]})))}}const Qe="glTF",Ze=1313821514,et=5130562;class GLTFBinaryExtension{constructor(e){this.name=Je.KHR_BINARY_GLTF,this.content=null,this.body=null;const r=new DataView(e,0,12),s=new TextDecoder;if(this.header={magic:s.decode(new Uint8Array(e.slice(0,4))),version:r.getUint32(4,!0),length:r.getUint32(8,!0)},this.header.magic!==Qe)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const l=this.header.length-12,u=new DataView(e,12);let h=0;for(;h<l;){const r=u.getUint32(h,!0);h+=4;const l=u.getUint32(h,!0);if(h+=4,l===Ze){const l=new Uint8Array(e,12+h,r);this.content=s.decode(l)}else if(l===et){const s=12+h;this.body=e.slice(s,s+r)}h+=r}if(null===this.content)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class GLTFDracoMeshCompressionExtension{constructor(e,r){if(!r)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=Je.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=r,this.dracoLoader.preload()}decodePrimitive(e,r){const s=this.json,l=this.dracoLoader,u=e.extensions[this.name].bufferView,h=e.extensions[this.name].attributes,p={},m={},v={};for(const e in h){const r=it[e]||e.toLowerCase();p[r]=h[e]}for(const r in e.attributes){const l=it[r]||r.toLowerCase();if(void 0!==h[r]){const u=s.accessors[e.attributes[r]],h=nt[u.componentType];v[l]=h.name,m[l]=!0===u.normalized}}return r.getDependency("bufferView",u).then((function(e){return new Promise((function(r,s){l.decodeDracoFile(e,(function(e){for(const r in e.attributes){const s=e.attributes[r],l=m[r];void 0!==l&&(s.normalized=l)}r(e)}),p,v,b,s)}))}))}}class GLTFTextureTransformExtension{constructor(){this.name=Je.KHR_TEXTURE_TRANSFORM}extendTexture(e,r){return void 0!==r.texCoord&&r.texCoord!==e.channel||void 0!==r.offset||void 0!==r.rotation||void 0!==r.scale?(e=e.clone(),void 0!==r.texCoord&&(e.channel=r.texCoord),void 0!==r.offset&&e.offset.fromArray(r.offset),void 0!==r.rotation&&(e.rotation=r.rotation),void 0!==r.scale&&e.repeat.fromArray(r.scale),e.needsUpdate=!0,e):e}}class GLTFMeshQuantizationExtension{constructor(){this.name=Je.KHR_MESH_QUANTIZATION}}class GLTFCubicSplineInterpolant extends Ue{constructor(e,r,s,l){super(e,r,s,l)}copySampleValue_(e){const r=this.resultBuffer,s=this.sampleValues,l=this.valueSize,u=e*l*3+l;for(let e=0;e!==l;e++)r[e]=s[u+e];return r}interpolate_(e,r,s,l){const u=this.resultBuffer,h=this.sampleValues,p=this.valueSize,m=2*p,v=3*p,x=l-r,b=(s-r)/x,_=b*b,S=_*b,A=e*v,C=A-v,R=-2*S+3*_,E=S-_,I=1-R,F=E-_+b;for(let e=0;e!==p;e++){const r=h[C+e+p],s=h[C+e+m]*x,l=h[A+e+p],v=h[A+e]*x;u[e]=I*r+F*s+R*l+E*v}return u}}const tt=new u;class GLTFCubicSplineQuaternionInterpolant extends GLTFCubicSplineInterpolant{interpolate_(e,r,s,l){const u=super.interpolate_(e,r,s,l);return tt.fromArray(u).normalize().toArray(u),u}}const rt={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},nt={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},st={9728:me,9729:z,9984:ve,9985:ye,9986:xe,9987:V},ot={33071:be,33648:_e,10497:q},at={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},it={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},lt={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},ct={CUBICSPLINE:void 0,LINEAR:pe,STEP:Te},ut="OPAQUE",ht="MASK",dt="BLEND";function addUnknownExtensionsToUserData(e,r,s){for(const l in s.extensions)void 0===e[l]&&(r.userData.gltfExtensions=r.userData.gltfExtensions||{},r.userData.gltfExtensions[l]=s.extensions[l])}function assignExtrasToUserData(e,r){void 0!==r.extras&&("object"==typeof r.extras?Object.assign(e.userData,r.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+r.extras))}function updateMorphTargets(e,r){if(e.updateMorphTargets(),void 0!==r.weights)for(let s=0,l=r.weights.length;s<l;s++)e.morphTargetInfluences[s]=r.weights[s];if(r.extras&&Array.isArray(r.extras.targetNames)){const s=r.extras.targetNames;if(e.morphTargetInfluences.length===s.length){e.morphTargetDictionary={};for(let r=0,l=s.length;r<l;r++)e.morphTargetDictionary[s[r]]=r}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function createPrimitiveKey(e){let r;const s=e.extensions&&e.extensions[Je.KHR_DRACO_MESH_COMPRESSION];if(r=s?"draco:"+s.bufferView+":"+s.indices+":"+createAttributesKey(s.attributes):e.indices+":"+createAttributesKey(e.attributes)+":"+e.mode,void 0!==e.targets)for(let s=0,l=e.targets.length;s<l;s++)r+=":"+createAttributesKey(e.targets[s]);return r}function createAttributesKey(e){let r="";const s=Object.keys(e).sort();for(let l=0,u=s.length;l<u;l++)r+=s[l]+":"+e[s[l]]+";";return r}function getNormalizedComponentScale(e){switch(e){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}const ft=new h;class GLTFParser{constructor(e={},r={}){this.json=e,this.extensions={},this.plugins={},this.options=r,this.cache=new GLTFRegistry,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let s=!1,l=!1,u=-1;"undefined"!=typeof navigator&&(s=!0===/^((?!chrome|android).)*safari/i.test(navigator.userAgent),l=navigator.userAgent.indexOf("Firefox")>-1,u=l?navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]:-1),"undefined"==typeof createImageBitmap||s||l&&u<98?this.textureLoader=new N(this.options.manager):this.textureLoader=new j(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new v(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),"use-credentials"===this.options.crossOrigin&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,r){const s=this,l=this.json,u=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll((function(e){return e._markDefs&&e._markDefs()})),Promise.all(this._invokeAll((function(e){return e.beforeRoot&&e.beforeRoot()}))).then((function(){return Promise.all([s.getDependencies("scene"),s.getDependencies("animation"),s.getDependencies("camera")])})).then((function(r){const h={scene:r[0][l.scene||0],scenes:r[0],animations:r[1],cameras:r[2],asset:l.asset,parser:s,userData:{}};return addUnknownExtensionsToUserData(u,h,l),assignExtrasToUserData(h,l),Promise.all(s._invokeAll((function(e){return e.afterRoot&&e.afterRoot(h)}))).then((function(){e(h)}))})).catch(r)}_markDefs(){const e=this.json.nodes||[],r=this.json.skins||[],s=this.json.meshes||[];for(let s=0,l=r.length;s<l;s++){const l=r[s].joints;for(let r=0,s=l.length;r<s;r++)e[l[r]].isBone=!0}for(let r=0,l=e.length;r<l;r++){const l=e[r];void 0!==l.mesh&&(this._addNodeRef(this.meshCache,l.mesh),void 0!==l.skin&&(s[l.mesh].isSkinnedMesh=!0)),void 0!==l.camera&&this._addNodeRef(this.cameraCache,l.camera)}}_addNodeRef(e,r){void 0!==r&&(void 0===e.refs[r]&&(e.refs[r]=e.uses[r]=0),e.refs[r]++)}_getNodeRef(e,r,s){if(e.refs[r]<=1)return s;const l=s.clone(),updateMappings=(e,r)=>{const s=this.associations.get(e);null!=s&&this.associations.set(r,s);for(const[s,l]of e.children.entries())updateMappings(l,r.children[s])};return updateMappings(s,l),l.name+="_instance_"+e.uses[r]++,l}_invokeOne(e){const r=Object.values(this.plugins);r.push(this);for(let s=0;s<r.length;s++){const l=e(r[s]);if(l)return l}return null}_invokeAll(e){const r=Object.values(this.plugins);r.unshift(this);const s=[];for(let l=0;l<r.length;l++){const u=e(r[l]);u&&s.push(u)}return s}getDependency(e,r){const s=e+":"+r;let l=this.cache.get(s);if(!l){switch(e){case"scene":l=this.loadScene(r);break;case"node":l=this._invokeOne((function(e){return e.loadNode&&e.loadNode(r)}));break;case"mesh":l=this._invokeOne((function(e){return e.loadMesh&&e.loadMesh(r)}));break;case"accessor":l=this.loadAccessor(r);break;case"bufferView":l=this._invokeOne((function(e){return e.loadBufferView&&e.loadBufferView(r)}));break;case"buffer":l=this.loadBuffer(r);break;case"material":l=this._invokeOne((function(e){return e.loadMaterial&&e.loadMaterial(r)}));break;case"texture":l=this._invokeOne((function(e){return e.loadTexture&&e.loadTexture(r)}));break;case"skin":l=this.loadSkin(r);break;case"animation":l=this._invokeOne((function(e){return e.loadAnimation&&e.loadAnimation(r)}));break;case"camera":l=this.loadCamera(r);break;default:if(l=this._invokeOne((function(s){return s!=this&&s.getDependency&&s.getDependency(e,r)})),!l)throw new Error("Unknown type: "+e)}this.cache.add(s,l)}return l}getDependencies(e){let r=this.cache.get(e);if(!r){const s=this,l=this.json[e+("mesh"===e?"es":"s")]||[];r=Promise.all(l.map((function(r,l){return s.getDependency(e,l)}))),this.cache.add(e,r)}return r}loadBuffer(e){const r=this.json.buffers[e],s=this.fileLoader;if(r.type&&"arraybuffer"!==r.type)throw new Error("THREE.GLTFLoader: "+r.type+" buffer type is not supported.");if(void 0===r.uri&&0===e)return Promise.resolve(this.extensions[Je.KHR_BINARY_GLTF].body);const l=this.options;return new Promise((function(e,u){s.load(m.resolveURL(r.uri,l.path),e,void 0,(function(){u(new Error('THREE.GLTFLoader: Failed to load buffer "'+r.uri+'".'))}))}))}loadBufferView(e){const r=this.json.bufferViews[e];return this.getDependency("buffer",r.buffer).then((function(e){const s=r.byteLength||0,l=r.byteOffset||0;return e.slice(l,l+s)}))}loadAccessor(e){const r=this,s=this.json,l=this.json.accessors[e];if(void 0===l.bufferView&&void 0===l.sparse){const e=at[l.type],r=nt[l.componentType],s=!0===l.normalized,u=new r(l.count*e);return Promise.resolve(new H(u,e,s))}const u=[];return void 0!==l.bufferView?u.push(this.getDependency("bufferView",l.bufferView)):u.push(null),void 0!==l.sparse&&(u.push(this.getDependency("bufferView",l.sparse.indices.bufferView)),u.push(this.getDependency("bufferView",l.sparse.values.bufferView))),Promise.all(u).then((function(e){const u=e[0],h=at[l.type],p=nt[l.componentType],m=p.BYTES_PER_ELEMENT,v=m*h,x=l.byteOffset||0,b=void 0!==l.bufferView?s.bufferViews[l.bufferView].byteStride:void 0,_=!0===l.normalized;let S,A;if(b&&b!==v){const e=Math.floor(x/b),s="InterleavedBuffer:"+l.bufferView+":"+l.componentType+":"+e+":"+l.count;let v=r.cache.get(s);v||(S=new p(u,e*b,l.count*b/m),v=new X(S,b/m),r.cache.add(s,v)),A=new W(v,h,x%b/m,_)}else S=null===u?new p(l.count*h):new p(u,x,l.count*h),A=new H(S,h,_);if(void 0!==l.sparse){const r=at.SCALAR,s=nt[l.sparse.indices.componentType],m=l.sparse.indices.byteOffset||0,v=l.sparse.values.byteOffset||0,x=new s(e[1],m,l.sparse.count*r),b=new p(e[2],v,l.sparse.count*h);null!==u&&(A=new H(A.array.slice(),A.itemSize,A.normalized));for(let e=0,r=x.length;e<r;e++){const r=x[e];if(A.setX(r,b[e*h]),h>=2&&A.setY(r,b[e*h+1]),h>=3&&A.setZ(r,b[e*h+2]),h>=4&&A.setW(r,b[e*h+3]),h>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return A}))}loadTexture(e){const r=this.json,s=this.options,l=r.textures[e].source,u=r.images[l];let h=this.textureLoader;if(u.uri){const e=s.manager.getHandler(u.uri);null!==e&&(h=e)}return this.loadTextureImage(e,l,h)}loadTextureImage(e,r,s){const l=this,u=this.json,h=u.textures[e],p=u.images[r],m=(p.uri||p.bufferView)+":"+h.sampler;if(this.textureCache[m])return this.textureCache[m];const v=this.loadImageSource(r,s).then((function(r){r.flipY=!1,r.name=h.name||p.name||"",""===r.name&&"string"==typeof p.uri&&!1===p.uri.startsWith("data:image/")&&(r.name=p.uri);const s=(u.samplers||{})[h.sampler]||{};return r.magFilter=st[s.magFilter]||z,r.minFilter=st[s.minFilter]||V,r.wrapS=ot[s.wrapS]||q,r.wrapT=ot[s.wrapT]||q,l.associations.set(r,{textures:e}),r})).catch((function(){return null}));return this.textureCache[m]=v,v}loadImageSource(e,r){const s=this,l=this.json,u=this.options;if(void 0!==this.sourceCache[e])return this.sourceCache[e].then((e=>e.clone()));const h=l.images[e],p=self.URL||self.webkitURL;let v=h.uri||"",x=!1;if(void 0!==h.bufferView)v=s.getDependency("bufferView",h.bufferView).then((function(e){x=!0;const r=new Blob([e],{type:h.mimeType});return v=p.createObjectURL(r),v}));else if(void 0===h.uri)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");const b=Promise.resolve(v).then((function(e){return new Promise((function(s,l){let h=s;!0===r.isImageBitmapLoader&&(h=function(e){const r=new Ae(e);r.needsUpdate=!0,s(r)}),r.load(m.resolveURL(e,u.path),h,void 0,l)}))})).then((function(e){var r;return!0===x&&p.revokeObjectURL(v),e.userData.mimeType=h.mimeType||((r=h.uri).search(/\.jpe?g($|\?)/i)>0||0===r.search(/^data\:image\/jpeg/)?"image/jpeg":r.search(/\.webp($|\?)/i)>0||0===r.search(/^data\:image\/webp/)?"image/webp":"image/png"),e})).catch((function(e){throw console.error("THREE.GLTFLoader: Couldn't load texture",v),e}));return this.sourceCache[e]=b,b}assignTexture(e,r,s,l){const u=this;return this.getDependency("texture",s.index).then((function(h){if(!h)return null;if(void 0!==s.texCoord&&s.texCoord>0&&((h=h.clone()).channel=s.texCoord),u.extensions[Je.KHR_TEXTURE_TRANSFORM]){const e=void 0!==s.extensions?s.extensions[Je.KHR_TEXTURE_TRANSFORM]:void 0;if(e){const r=u.associations.get(h);h=u.extensions[Je.KHR_TEXTURE_TRANSFORM].extendTexture(h,e),u.associations.set(h,r)}}return void 0!==l&&(h.colorSpace=l),e[r]=h,h}))}assignFinalMaterial(e){const r=e.geometry;let s=e.material;const l=void 0===r.attributes.tangent,u=void 0!==r.attributes.color,h=void 0===r.attributes.normal;if(e.isPoints){const e="PointsMaterial:"+s.uuid;let r=this.cache.get(e);r||(r=new $,K.prototype.copy.call(r,s),r.color.copy(s.color),r.map=s.map,r.sizeAttenuation=!1,this.cache.add(e,r)),s=r}else if(e.isLine){const e="LineBasicMaterial:"+s.uuid;let r=this.cache.get(e);r||(r=new Y,K.prototype.copy.call(r,s),r.color.copy(s.color),r.map=s.map,this.cache.add(e,r)),s=r}if(l||u||h){let e="ClonedMaterial:"+s.uuid+":";l&&(e+="derivative-tangents:"),u&&(e+="vertex-colors:"),h&&(e+="flat-shading:");let r=this.cache.get(e);r||(r=s.clone(),u&&(r.vertexColors=!0),h&&(r.flatShading=!0),l&&(r.normalScale&&(r.normalScale.y*=-1),r.clearcoatNormalScale&&(r.clearcoatNormalScale.y*=-1)),this.cache.add(e,r),this.associations.set(r,this.associations.get(s))),s=r}e.material=s}getMaterialType(){return J}loadMaterial(e){const r=this,s=this.json,l=this.extensions,u=s.materials[e];let h;const p={},m=[];if((u.extensions||{})[Je.KHR_MATERIALS_UNLIT]){const e=l[Je.KHR_MATERIALS_UNLIT];h=e.getMaterialType(),m.push(e.extendParams(p,u,r))}else{const s=u.pbrMetallicRoughness||{};if(p.color=new x(1,1,1),p.opacity=1,Array.isArray(s.baseColorFactor)){const e=s.baseColorFactor;p.color.setRGB(e[0],e[1],e[2],b),p.opacity=e[3]}void 0!==s.baseColorTexture&&m.push(r.assignTexture(p,"map",s.baseColorTexture,R)),p.metalness=void 0!==s.metallicFactor?s.metallicFactor:1,p.roughness=void 0!==s.roughnessFactor?s.roughnessFactor:1,void 0!==s.metallicRoughnessTexture&&(m.push(r.assignTexture(p,"metalnessMap",s.metallicRoughnessTexture)),m.push(r.assignTexture(p,"roughnessMap",s.metallicRoughnessTexture))),h=this._invokeOne((function(r){return r.getMaterialType&&r.getMaterialType(e)})),m.push(Promise.all(this._invokeAll((function(r){return r.extendMaterialParams&&r.extendMaterialParams(e,p)}))))}!0===u.doubleSided&&(p.side=Q);const v=u.alphaMode||ut;if(v===dt?(p.transparent=!0,p.depthWrite=!1):(p.transparent=!1,v===ht&&(p.alphaTest=void 0!==u.alphaCutoff?u.alphaCutoff:.5)),void 0!==u.normalTexture&&h!==C&&(m.push(r.assignTexture(p,"normalMap",u.normalTexture)),p.normalScale=new I(1,1),void 0!==u.normalTexture.scale)){const e=u.normalTexture.scale;p.normalScale.set(e,e)}if(void 0!==u.occlusionTexture&&h!==C&&(m.push(r.assignTexture(p,"aoMap",u.occlusionTexture)),void 0!==u.occlusionTexture.strength&&(p.aoMapIntensity=u.occlusionTexture.strength)),void 0!==u.emissiveFactor&&h!==C){const e=u.emissiveFactor;p.emissive=(new x).setRGB(e[0],e[1],e[2],b)}return void 0!==u.emissiveTexture&&h!==C&&m.push(r.assignTexture(p,"emissiveMap",u.emissiveTexture,R)),Promise.all(m).then((function(){const s=new h(p);return u.name&&(s.name=u.name),assignExtrasToUserData(s,u),r.associations.set(s,{materials:e}),u.extensions&&addUnknownExtensionsToUserData(l,s,u),s}))}createUniqueName(e){const r=Z.sanitizeNodeName(e||"");return r in this.nodeNamesUsed?r+"_"+ ++this.nodeNamesUsed[r]:(this.nodeNamesUsed[r]=0,r)}loadGeometries(e){const r=this,s=this.extensions,l=this.primitiveCache;function createDracoPrimitive(e){return s[Je.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(e,r).then((function(s){return addPrimitiveAttributes(s,e,r)}))}const u=[];for(let s=0,h=e.length;s<h;s++){const h=e[s],p=createPrimitiveKey(h),m=l[p];if(m)u.push(m.promise);else{let e;e=h.extensions&&h.extensions[Je.KHR_DRACO_MESH_COMPRESSION]?createDracoPrimitive(h):addPrimitiveAttributes(new ee,h,r),l[p]={primitive:h,promise:e},u.push(e)}}return Promise.all(u)}loadMesh(e){const r=this,u=this.json,h=this.extensions,p=u.meshes[e],m=p.primitives,v=[];for(let e=0,r=m.length;e<r;e++){const r=void 0===m[e].material?(void 0===(x=this.cache).DefaultMaterial&&(x.DefaultMaterial=new J({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:Se})),x.DefaultMaterial):this.getDependency("material",m[e].material);v.push(r)}var x;return v.push(r.loadGeometries(m)),Promise.all(v).then((function(u){const v=u.slice(0,u.length-1),x=u[u.length-1],b=[];for(let u=0,_=x.length;u<_;u++){const _=x[u],S=m[u];let A;const C=v[u];if(S.mode===rt.TRIANGLES||S.mode===rt.TRIANGLE_STRIP||S.mode===rt.TRIANGLE_FAN||void 0===S.mode)A=!0===p.isSkinnedMesh?new te(_,C):new re(_,C),!0===A.isSkinnedMesh&&A.normalizeSkinWeights(),S.mode===rt.TRIANGLE_STRIP?A.geometry=toTrianglesDrawMode(A.geometry,l):S.mode===rt.TRIANGLE_FAN&&(A.geometry=toTrianglesDrawMode(A.geometry,s));else if(S.mode===rt.LINES)A=new ne(_,C);else if(S.mode===rt.LINE_STRIP)A=new se(_,C);else if(S.mode===rt.LINE_LOOP)A=new oe(_,C);else{if(S.mode!==rt.POINTS)throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+S.mode);A=new ae(_,C)}Object.keys(A.geometry.morphAttributes).length>0&&updateMorphTargets(A,p),A.name=r.createUniqueName(p.name||"mesh_"+e),assignExtrasToUserData(A,p),S.extensions&&addUnknownExtensionsToUserData(h,A,S),r.assignFinalMaterial(A),b.push(A)}for(let s=0,l=b.length;s<l;s++)r.associations.set(b[s],{meshes:e,primitives:s});if(1===b.length)return p.extensions&&addUnknownExtensionsToUserData(h,b[0],p),b[0];const _=new ie;p.extensions&&addUnknownExtensionsToUserData(h,_,p),r.associations.set(_,{meshes:e});for(let e=0,r=b.length;e<r;e++)_.add(b[e]);return _}))}loadCamera(e){let r;const s=this.json.cameras[e],l=s[s.type];if(l)return"perspective"===s.type?r=new le(ce.radToDeg(l.yfov),l.aspectRatio||1,l.znear||1,l.zfar||2e6):"orthographic"===s.type&&(r=new ue(-l.xmag,l.xmag,l.ymag,-l.ymag,l.znear,l.zfar)),s.name&&(r.name=this.createUniqueName(s.name)),assignExtrasToUserData(r,s),Promise.resolve(r);console.warn("THREE.GLTFLoader: Missing camera parameters.")}loadSkin(e){const r=this.json.skins[e],s=[];for(let e=0,l=r.joints.length;e<l;e++)s.push(this._loadNodeShallow(r.joints[e]));return void 0!==r.inverseBindMatrices?s.push(this.getDependency("accessor",r.inverseBindMatrices)):s.push(null),Promise.all(s).then((function(e){const s=e.pop(),l=e,u=[],p=[];for(let e=0,m=l.length;e<m;e++){const m=l[e];if(m){u.push(m);const r=new h;null!==s&&r.fromArray(s.array,16*e),p.push(r)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',r.joints[e])}return new he(u,p)}))}loadAnimation(e){const r=this.json,s=this,l=r.animations[e],u=l.name?l.name:"animation_"+e,h=[],p=[],m=[],v=[],x=[];for(let e=0,r=l.channels.length;e<r;e++){const r=l.channels[e],s=l.samplers[r.sampler],u=r.target,b=u.node,_=void 0!==l.parameters?l.parameters[s.input]:s.input,S=void 0!==l.parameters?l.parameters[s.output]:s.output;void 0!==u.node&&(h.push(this.getDependency("node",b)),p.push(this.getDependency("accessor",_)),m.push(this.getDependency("accessor",S)),v.push(s),x.push(u))}return Promise.all([Promise.all(h),Promise.all(p),Promise.all(m),Promise.all(v),Promise.all(x)]).then((function(e){const r=e[0],l=e[1],h=e[2],p=e[3],m=e[4],v=[];for(let e=0,u=r.length;e<u;e++){const u=r[e],x=l[e],b=h[e],_=p[e],S=m[e];if(void 0===u)continue;u.updateMatrix&&u.updateMatrix();const A=s._createAnimationTracks(u,x,b,_,S);if(A)for(let e=0;e<A.length;e++)v.push(A[e])}return new de(u,void 0,v)}))}createNodeMesh(e){const r=this.json,s=this,l=r.nodes[e];return void 0===l.mesh?null:s.getDependency("mesh",l.mesh).then((function(e){const r=s._getNodeRef(s.meshCache,l.mesh,e);return void 0!==l.weights&&r.traverse((function(e){if(e.isMesh)for(let r=0,s=l.weights.length;r<s;r++)e.morphTargetInfluences[r]=l.weights[r]})),r}))}loadNode(e){const r=this,s=this.json.nodes[e],l=r._loadNodeShallow(e),u=[],h=s.children||[];for(let e=0,s=h.length;e<s;e++)u.push(r.getDependency("node",h[e]));const p=void 0===s.skin?Promise.resolve(null):r.getDependency("skin",s.skin);return Promise.all([l,Promise.all(u),p]).then((function(e){const r=e[0],s=e[1],l=e[2];null!==l&&r.traverse((function(e){e.isSkinnedMesh&&e.bind(l,ft)}));for(let e=0,l=s.length;e<l;e++)r.add(s[e]);return r}))}_loadNodeShallow(e){const r=this.json,s=this.extensions,l=this;if(void 0!==this.nodeCache[e])return this.nodeCache[e];const u=r.nodes[e],p=u.name?l.createUniqueName(u.name):"",m=[],v=l._invokeOne((function(r){return r.createNodeMesh&&r.createNodeMesh(e)}));return v&&m.push(v),void 0!==u.camera&&m.push(l.getDependency("camera",u.camera).then((function(e){return l._getNodeRef(l.cameraCache,u.camera,e)}))),l._invokeAll((function(r){return r.createNodeAttachment&&r.createNodeAttachment(e)})).forEach((function(e){m.push(e)})),this.nodeCache[e]=Promise.all(m).then((function(r){let m;if(m=!0===u.isBone?new fe:r.length>1?new ie:1===r.length?r[0]:new B,m!==r[0])for(let e=0,s=r.length;e<s;e++)m.add(r[e]);if(u.name&&(m.userData.name=u.name,m.name=p),assignExtrasToUserData(m,u),u.extensions&&addUnknownExtensionsToUserData(s,m,u),void 0!==u.matrix){const e=new h;e.fromArray(u.matrix),m.applyMatrix4(e)}else void 0!==u.translation&&m.position.fromArray(u.translation),void 0!==u.rotation&&m.quaternion.fromArray(u.rotation),void 0!==u.scale&&m.scale.fromArray(u.scale);return l.associations.has(m)||l.associations.set(m,{}),l.associations.get(m).nodes=e,m})),this.nodeCache[e]}loadScene(e){const r=this.extensions,s=this.json.scenes[e],l=this,u=new ie;s.name&&(u.name=l.createUniqueName(s.name)),assignExtrasToUserData(u,s),s.extensions&&addUnknownExtensionsToUserData(r,u,s);const h=s.nodes||[],p=[];for(let e=0,r=h.length;e<r;e++)p.push(l.getDependency("node",h[e]));return Promise.all(p).then((function(e){for(let r=0,s=e.length;r<s;r++)u.add(e[r]);return l.associations=(e=>{const r=new Map;for(const[e,s]of l.associations)(e instanceof K||e instanceof Ae)&&r.set(e,s);return e.traverse((e=>{const s=l.associations.get(e);null!=s&&r.set(e,s)})),r})(u),u}))}_createAnimationTracks(e,r,s,l,u){const h=[],p=e.name?e.name:e.uuid,m=[];let v;switch(lt[u.path]===lt.weights?e.traverse((function(e){e.morphTargetInfluences&&m.push(e.name?e.name:e.uuid)})):m.push(p),lt[u.path]){case lt.weights:v=Ce;break;case lt.rotation:v=Re;break;case lt.position:case lt.scale:v=we;break;default:if(1===s.itemSize)v=Ce;else v=we}const x=void 0!==l.interpolation?ct[l.interpolation]:pe,b=this._getArrayFromAccessor(s);for(let e=0,s=m.length;e<s;e++){const s=new v(m[e]+"."+lt[u.path],r.array,b,x);"CUBICSPLINE"===l.interpolation&&this._createCubicSplineTrackInterpolant(s),h.push(s)}return h}_getArrayFromAccessor(e){let r=e.array;if(e.normalized){const e=getNormalizedComponentScale(r.constructor),s=new Float32Array(r.length);for(let l=0,u=r.length;l<u;l++)s[l]=r[l]*e;r=s}return r}_createCubicSplineTrackInterpolant(e){e.createInterpolant=function(e){return new(this instanceof Re?GLTFCubicSplineQuaternionInterpolant:GLTFCubicSplineInterpolant)(this.times,this.values,this.getValueSize()/3,e)},e.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0}}function addPrimitiveAttributes(e,r,s){const l=r.attributes,u=[];function assignAttributeAccessor(r,l){return s.getDependency("accessor",r).then((function(r){e.setAttribute(l,r)}))}for(const r in l){const s=it[r]||r.toLowerCase();s in e.attributes||u.push(assignAttributeAccessor(l[r],s))}if(void 0!==r.indices&&!e.index){const l=s.getDependency("accessor",r.indices).then((function(r){e.setIndex(r)}));u.push(l)}return ge.workingColorSpace!==b&&"COLOR_0"in l&&console.warn(`THREE.GLTFLoader: Converting vertex colors from "srgb-linear" to "${ge.workingColorSpace}" not supported.`),assignExtrasToUserData(e,r),function(e,r,s){const l=r.attributes,u=new Ee;if(void 0===l.POSITION)return;{const e=s.json.accessors[l.POSITION],r=e.min,h=e.max;if(void 0===r||void 0===h)return void console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");if(u.set(new F(r[0],r[1],r[2]),new F(h[0],h[1],h[2])),e.normalized){const r=getNormalizedComponentScale(nt[e.componentType]);u.min.multiplyScalar(r),u.max.multiplyScalar(r)}}const h=r.targets;if(void 0!==h){const e=new F,r=new F;for(let l=0,u=h.length;l<u;l++){const u=h[l];if(void 0!==u.POSITION){const l=s.json.accessors[u.POSITION],h=l.min,p=l.max;if(void 0!==h&&void 0!==p){if(r.setX(Math.max(Math.abs(h[0]),Math.abs(p[0]))),r.setY(Math.max(Math.abs(h[1]),Math.abs(p[1]))),r.setZ(Math.max(Math.abs(h[2]),Math.abs(p[2]))),l.normalized){const e=getNormalizedComponentScale(nt[l.componentType]);r.multiplyScalar(e)}e.max(r)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}u.expandByVector(e)}e.boundingBox=u;const p=new Ie;u.getCenter(p.center),p.radius=u.min.distanceTo(u.max)/2,e.boundingSphere=p}(e,r,s),Promise.all(u).then((function(){return void 0!==r.targets?function(e,r,s){let l=!1,u=!1,h=!1;for(let e=0,s=r.length;e<s;e++){const s=r[e];if(void 0!==s.POSITION&&(l=!0),void 0!==s.NORMAL&&(u=!0),void 0!==s.COLOR_0&&(h=!0),l&&u&&h)break}if(!l&&!u&&!h)return Promise.resolve(e);const p=[],m=[],v=[];for(let x=0,b=r.length;x<b;x++){const b=r[x];if(l){const r=void 0!==b.POSITION?s.getDependency("accessor",b.POSITION):e.attributes.position;p.push(r)}if(u){const r=void 0!==b.NORMAL?s.getDependency("accessor",b.NORMAL):e.attributes.normal;m.push(r)}if(h){const r=void 0!==b.COLOR_0?s.getDependency("accessor",b.COLOR_0):e.attributes.color;v.push(r)}}return Promise.all([Promise.all(p),Promise.all(m),Promise.all(v)]).then((function(r){const s=r[0],p=r[1],m=r[2];return l&&(e.morphAttributes.position=s),u&&(e.morphAttributes.normal=p),h&&(e.morphAttributes.color=m),e.morphTargetsRelative=!0,e}))}(e,r.targets,s):e}))}const pt={Handedness:Object.freeze({NONE:"none",LEFT:"left",RIGHT:"right"}),ComponentState:Object.freeze({DEFAULT:"default",TOUCHED:"touched",PRESSED:"pressed"}),ComponentProperty:Object.freeze({BUTTON:"button",X_AXIS:"xAxis",Y_AXIS:"yAxis",STATE:"state"}),ComponentType:Object.freeze({TRIGGER:"trigger",SQUEEZE:"squeeze",TOUCHPAD:"touchpad",THUMBSTICK:"thumbstick",BUTTON:"button"}),ButtonTouchThreshold:.05,AxisTouchThreshold:.1,VisualResponseProperty:Object.freeze({TRANSFORM:"transform",VISIBILITY:"visibility"})};async function fetchJsonFile(e){const r=await fetch(e);if(r.ok)return r.json();throw new Error(r.statusText)}async function fetchProfile(e,r,s=null,l=!0){if(!e)throw new Error("No xrInputSource supplied");if(!r)throw new Error("No basePath supplied");const u=await async function(e){if(!e)throw new Error("No basePath supplied");return await fetchJsonFile(`${e}/profilesList.json`)}(r);let h;if(e.profiles.some((e=>{const s=u[e];return s&&(h={profileId:e,profilePath:`${r}/${s.path}`,deprecated:!!s.deprecated}),!!h})),!h){if(!s)throw new Error("No matching profile name found");const e=u[s];if(!e)throw new Error(`No matching profile name found and default profile "${s}" missing.`);h={profileId:s,profilePath:`${r}/${e.path}`,deprecated:!!e.deprecated}}const p=await fetchJsonFile(h.profilePath);let m;if(l){let r;if(r="any"===e.handedness?p.layouts[Object.keys(p.layouts)[0]]:p.layouts[e.handedness],!r)throw new Error(`No matching handedness, ${e.handedness}, in profile ${h.profileId}`);r.assetPath&&(m=h.profilePath.replace("profile.json",r.assetPath))}return{profile:p,assetPath:m}}const gt={xAxis:0,yAxis:0,button:0,state:pt.ComponentState.DEFAULT};class VisualResponse{constructor(e){this.componentProperty=e.componentProperty,this.states=e.states,this.valueNodeName=e.valueNodeName,this.valueNodeProperty=e.valueNodeProperty,this.valueNodeProperty===pt.VisualResponseProperty.TRANSFORM&&(this.minNodeName=e.minNodeName,this.maxNodeName=e.maxNodeName),this.value=0,this.updateFromComponent(gt)}updateFromComponent({xAxis:e,yAxis:r,button:s,state:l}){const{normalizedXAxis:u,normalizedYAxis:h}=function(e=0,r=0){let s=e,l=r;if(Math.sqrt(e*e+r*r)>1){const u=Math.atan2(r,e);s=Math.cos(u),l=Math.sin(u)}return{normalizedXAxis:.5*s+.5,normalizedYAxis:.5*l+.5}}(e,r);switch(this.componentProperty){case pt.ComponentProperty.X_AXIS:this.value=this.states.includes(l)?u:.5;break;case pt.ComponentProperty.Y_AXIS:this.value=this.states.includes(l)?h:.5;break;case pt.ComponentProperty.BUTTON:this.value=this.states.includes(l)?s:0;break;case pt.ComponentProperty.STATE:this.valueNodeProperty===pt.VisualResponseProperty.VISIBILITY?this.value=this.states.includes(l):this.value=this.states.includes(l)?1:0;break;default:throw new Error(`Unexpected visualResponse componentProperty ${this.componentProperty}`)}}}class Component{constructor(e,r){if(!(e&&r&&r.visualResponses&&r.gamepadIndices&&0!==Object.keys(r.gamepadIndices).length))throw new Error("Invalid arguments supplied");this.id=e,this.type=r.type,this.rootNodeName=r.rootNodeName,this.touchPointNodeName=r.touchPointNodeName,this.visualResponses={},Object.keys(r.visualResponses).forEach((e=>{const s=new VisualResponse(r.visualResponses[e]);this.visualResponses[e]=s})),this.gamepadIndices=Object.assign({},r.gamepadIndices),this.values={state:pt.ComponentState.DEFAULT,button:void 0!==this.gamepadIndices.button?0:void 0,xAxis:void 0!==this.gamepadIndices.xAxis?0:void 0,yAxis:void 0!==this.gamepadIndices.yAxis?0:void 0}}get data(){return{id:this.id,...this.values}}updateFromGamepad(e){if(this.values.state=pt.ComponentState.DEFAULT,void 0!==this.gamepadIndices.button&&e.buttons.length>this.gamepadIndices.button){const r=e.buttons[this.gamepadIndices.button];this.values.button=r.value,this.values.button=this.values.button<0?0:this.values.button,this.values.button=this.values.button>1?1:this.values.button,r.pressed||1===this.values.button?this.values.state=pt.ComponentState.PRESSED:(r.touched||this.values.button>pt.ButtonTouchThreshold)&&(this.values.state=pt.ComponentState.TOUCHED)}void 0!==this.gamepadIndices.xAxis&&e.axes.length>this.gamepadIndices.xAxis&&(this.values.xAxis=e.axes[this.gamepadIndices.xAxis],this.values.xAxis=this.values.xAxis<-1?-1:this.values.xAxis,this.values.xAxis=this.values.xAxis>1?1:this.values.xAxis,this.values.state===pt.ComponentState.DEFAULT&&Math.abs(this.values.xAxis)>pt.AxisTouchThreshold&&(this.values.state=pt.ComponentState.TOUCHED)),void 0!==this.gamepadIndices.yAxis&&e.axes.length>this.gamepadIndices.yAxis&&(this.values.yAxis=e.axes[this.gamepadIndices.yAxis],this.values.yAxis=this.values.yAxis<-1?-1:this.values.yAxis,this.values.yAxis=this.values.yAxis>1?1:this.values.yAxis,this.values.state===pt.ComponentState.DEFAULT&&Math.abs(this.values.yAxis)>pt.AxisTouchThreshold&&(this.values.state=pt.ComponentState.TOUCHED)),Object.values(this.visualResponses).forEach((e=>{e.updateFromComponent(this.values)}))}}class MotionController{constructor(e,r,s){if(!e)throw new Error("No xrInputSource supplied");if(!r)throw new Error("No profile supplied");this.xrInputSource=e,this.assetUrl=s,this.id=r.profileId,this.layoutDescription=r.layouts[e.handedness],this.components={},Object.keys(this.layoutDescription.components).forEach((e=>{const r=this.layoutDescription.components[e];this.components[e]=new Component(e,r)})),this.updateFromGamepad()}get gripSpace(){return this.xrInputSource.gripSpace}get targetRaySpace(){return this.xrInputSource.targetRaySpace}get data(){const e=[];return Object.values(this.components).forEach((r=>{e.push(r.data)})),e}updateFromGamepad(){Object.values(this.components).forEach((e=>{e.updateFromGamepad(this.xrInputSource.gamepad)}))}}class XRControllerModel extends B{constructor(){super(),this.motionController=null,this.envMap=null}setEnvironmentMap(e){return this.envMap==e||(this.envMap=e,this.traverse((e=>{e.isMesh&&(e.material.envMap=this.envMap,e.material.needsUpdate=!0)}))),this}updateMatrixWorld(e){super.updateMatrixWorld(e),this.motionController&&(this.motionController.updateFromGamepad(),Object.values(this.motionController.components).forEach((e=>{Object.values(e.visualResponses).forEach((e=>{const{valueNode:r,minNode:s,maxNode:l,value:u,valueNodeProperty:h}=e;r&&(h===pt.VisualResponseProperty.VISIBILITY?r.visible=u:h===pt.VisualResponseProperty.TRANSFORM&&(r.quaternion.slerpQuaternions(s.quaternion,l.quaternion,u),r.position.lerpVectors(s.position,l.position,u)))}))})))}}function addAssetSceneToControllerModel(e,r){!function(e,r){Object.values(e.components).forEach((e=>{const{type:s,touchPointNodeName:l,visualResponses:u}=e;if(s===pt.ComponentType.TOUCHPAD)if(e.touchPointNode=r.getObjectByName(l),e.touchPointNode){const r=new ke(.001),s=new C({color:255}),l=new re(r,s);e.touchPointNode.add(l)}else console.warn("Could not find touch dot, "+e.touchPointNodeName+", in touchpad component "+e.id);Object.values(u).forEach((e=>{const{valueNodeName:s,minNodeName:l,maxNodeName:u,valueNodeProperty:h}=e;if(h===pt.VisualResponseProperty.TRANSFORM){if(e.minNode=r.getObjectByName(l),e.maxNode=r.getObjectByName(u),!e.minNode)return void console.warn(`Could not find ${l} in the model`);if(!e.maxNode)return void console.warn(`Could not find ${u} in the model`)}e.valueNode=r.getObjectByName(s),e.valueNode||console.warn(`Could not find ${s} in the model`)}))}))}(e.motionController,r),e.envMap&&r.traverse((r=>{r.isMesh&&(r.material.envMap=e.envMap,r.material.needsUpdate=!0)})),e.add(r)}const mt="https://cdn.jsdelivr.net/npm/@webxr-input-profiles/assets@1.0/dist/profiles/generic-hand/";class XRHandMeshModel{constructor(e,r,s,l,u=null){this.xrInputSource=r,this.handModel=e,this.bones=[],this._fingertips=[],this._phalanxProximals=[],this._palmTriangleVectors=[new F,new F,new F],this._palmTriangleBones=[],this._palmTriangle=new Fe,this.isPinching=!1,this.isGrabbing=!1,this.palmDirection=new F,null===u&&(u=new GLTFLoader).setPath(s||mt),u.load(`${l}.glb`,(e=>{const r=e.scene.children[0];this.handModel.add(r),this.assetUrl=mt+`${l}.glb`;const s=r.getObjectByProperty("type","SkinnedMesh");s.frustumCulled=!1,s.castShadow=!0,s.receiveShadow=!0;["wrist","thumb-metacarpal","thumb-phalanx-proximal","thumb-phalanx-distal","thumb-tip","index-finger-metacarpal","index-finger-phalanx-proximal","index-finger-phalanx-intermediate","index-finger-phalanx-distal","index-finger-tip","middle-finger-metacarpal","middle-finger-phalanx-proximal","middle-finger-phalanx-intermediate","middle-finger-phalanx-distal","middle-finger-tip","ring-finger-metacarpal","ring-finger-phalanx-proximal","ring-finger-phalanx-intermediate","ring-finger-phalanx-distal","ring-finger-tip","pinky-finger-metacarpal","pinky-finger-phalanx-proximal","pinky-finger-phalanx-intermediate","pinky-finger-phalanx-distal","pinky-finger-tip"].forEach((e=>{const s=r.getObjectByName(e);void 0!==s?s.jointName=e:console.warn(`Couldn't find ${e} in ${l} hand mesh`),this.bones.push(s)}));for(let e of[4,9,14,19,24])this._fingertips.push(this.bones[e]);for(let e of[2,6,11,16,21])this._phalanxProximals.push(this.bones[e]);this._palmTriangleBones.push(this.bones[5]),this._palmTriangleBones.push(this.bones[6]),this._palmTriangleBones.push(this.bones[10]),"left"==l&&this._palmTriangleBones.reverse()}))}_updateGestures(){let e=this.bones[0];if(!e)return;let r=!0,s=e.position;for(let e=2;e<5;e++){let l=this._fingertips[e].position,u=this._phalanxProximals[e].position;if(l.distanceTo(s)>u.distanceTo(s)){r=!1;break}}this.isGrabbing=r;let l=this.bones[4],u=this.bones[9],h=l.position.distanceTo(u.position);this.isPinching?h>.025&&(this.isPinching=!1):h<.015&&(this.isPinching=!0);for(let e=0;e<3;e++)this._palmTriangleBones[e].getWorldPosition(this._palmTriangleVectors[e]);this._palmTriangle.setFromPointsAndIndices(this._palmTriangleVectors,0,1,2),this._palmTriangle.getNormal(this.palmDirection)}updateMesh(e,r,s){if(!s)return;s=s.clone().invert();let l=0;for(let u of this.xrInputSource.hand.values()){let h=this.bones[l],p=e.getJointPose(u,r);h&&p&&(h.matrix.fromArray(p.transform.matrix).premultiply(s),h.matrix.decompose(h.position,h.rotation,h.scale)),l++}this._updateGestures()}}class XRHandModel extends B{constructor(e){super(),this.controller=e,this.motionController=null,this.envMap=null,this.mesh=null}}const vt=new class{constructor(e=null){this.gltfLoader=e,this.path="https://cdn.jsdelivr.net/npm/@webxr-input-profiles/assets@1.0/dist/profiles",this._assetCache={},this.gltfLoader||(this.gltfLoader=new GLTFLoader)}createControllerModel(e){const r=new XRControllerModel;let s=null;if("tracked-pointer"===e.targetRayMode&&e.gamepad)return fetchProfile(e,this.path,"generic-trigger").then((({profile:l,assetPath:u})=>{r.motionController=new MotionController(e,l,u);const h=this._assetCache[r.motionController.assetUrl];if(h)s=h.scene.clone(),addAssetSceneToControllerModel(r,s);else{if(!this.gltfLoader)throw new Error("GLTFLoader not set.");this.gltfLoader.setPath(""),this.gltfLoader.load(r.motionController.assetUrl,(e=>{this._assetCache[r.motionController.assetUrl]=e,s=e.scene.clone(),addAssetSceneToControllerModel(r,s)}),null,(()=>{throw new Error("Asset "+r.motionController.assetUrl+" missing or malformed.")}))}})).catch((e=>{console.warn(e)})),r}},yt=new class{constructor(){this.path=null}setPath(e){return this.path=e,this}createHandModel(e){let r=e;const s=new XRHandModel;return r.hand&&!s.motionController&&(s.xrInputSource=r,s.motionController=new XRHandMeshModel(s,r,this.path,r.handedness)),s}};let xt=new class{init(e,r,s){this._container=e,this._renderer=r,this._renderer.domElement.tabIndex="1",this._xrInputDevices={};for(let e in Ye)this._xrInputDevices[e]={};this._pointerPosition=new I,this._pointerPressed=!1,this._keysPressed=new Set,this._keyCodesPressed=new Set,this._screenTouched=!1,this._joystickAngle=0,this._joystickDistance=0,this._container.style.position="relative",this._createExtraControls(),this._addEventListeners(s)}_addEventListeners(e){if("XR"==e)this._renderer.xr.addEventListener("sessionstart",(()=>{this._onXRSessionStart()})),this._renderer.xr.addEventListener("sessionend",(()=>{this._onXRSessionEnd()}));else if("POINTER"==e)this._renderer.domElement.addEventListener("keydown",(e=>{this._keysPressed.add(e.key),this._keyCodesPressed.add(e.code)})),this._renderer.domElement.addEventListener("keyup",(e=>{this._keysPressed.delete(e.key),this._keyCodesPressed.delete(e.code)})),window.addEventListener("blur",(()=>{this._keysPressed.clear(),this._keyCodesPressed.clear()})),this._renderer.domElement.addEventListener("mousedown",(()=>{this._pointerPressed=!0})),this._renderer.domElement.addEventListener("mouseup",(()=>{this._pointerPressed=!1})),this._renderer.domElement.addEventListener("mousemove",(e=>{let r=e.target.getBoundingClientRect();this._pointerPosition.x=(e.clientX-r.left)/this._renderer.domElement.clientWidth*2-1,this._pointerPosition.y=-(e.clientY-r.top)/this._renderer.domElement.clientHeight*2+1})),this._container.addEventListener("mouseup",(()=>{this._renderer.domElement.focus()}));else if("TOUCH"==e){this._renderer.domElement.addEventListener("touchstart",(()=>{this._screenTouched=!0;let e=event.target.getBoundingClientRect();this._pointerPosition.x=(event.touches[0].clientX-e.left)/this._renderer.domElement.clientWidth*2-1,this._pointerPosition.y=-(event.touches[0].clientY-e.top)/this._renderer.domElement.clientHeight*2+1})),this._renderer.domElement.addEventListener("touchend",(()=>{this._screenTouched=!1})),this._renderer.domElement.addEventListener("touchmove",(e=>{let r=e.target.getBoundingClientRect();this._pointerPosition.x=(e.touches[0].clientX-r.left)/this._renderer.domElement.clientWidth*2-1,this._pointerPosition.y=-(e.touches[0].clientY-r.top)/this._renderer.domElement.clientHeight*2+1}));let e=0;document.addEventListener("touchend",(function(r){let s=(new Date).getTime();s-e<=300&&r.preventDefault(),e=s}),!1)}}_onXRSessionStart(){this._session=this._renderer.xr.getSession(),this._session.oninputsourceschange=e=>{this._onXRInputSourceChange(e)};let e=this._session.inputSources;for(let r=0;r<e.length;r++)this._addXRInputSource(e[r])}_onXRSessionEnd(){this._session.oninputsourcechange=null,this._session=null;for(let e in this._xrInputDevices)for(let r in this._xrInputDevices[e])delete this._xrInputDevices[e][r].inputSource}_onXRInputSourceChange(e){for(let r=0;r<e.removed.length;r++)this._deleteXRInputSource(e.removed[r]);for(let r=0;r<e.added.length;r++)this._addXRInputSource(e.added[r])}_addXRInputSource(e){let r=null!=e.hand?Ye.HAND:Ye.CONTROLLER,s=e.handedness.toUpperCase();if(s in Ke){let l=this._xrInputDevices[r][s];if(l||(l={controllers:{}},this._xrInputDevices[r][s]=l,e.targetRaySpace&&(l.controllers.targetRay=new B),e.gripSpace&&(l.controllers.grip=new B)),l.inputSource=e,l.model){let r=l.model.motionController;r&&(r.xrInputSource=e)}else r==Ye.HAND?l.model=yt.createHandModel(e):r==Ye.CONTROLLER&&(l.model=vt.createControllerModel(e,"mesh"));this._xrControllerParent&&(this._xrControllerParent.add(l.controllers.targetRay),this._xrControllerParent.add(l.controllers.grip),l.controllers.grip.add(l.model))}}_deleteXRInputSource(e){let r=null!=e.hand?Ye.HAND:Ye.CONTROLLER,s=e.handedness.toUpperCase(),l=this._getXRInputDevice(r,s);l?.inputSource&&delete this._xrInputDevices[r][s].inputSource,l?.controllers&&this._xrControllerParent&&(this._xrControllerParent.remove(l.controllers.targetRay),this._xrControllerParent.remove(l.controllers.grip))}_getXRInputDevice(e,r){return this._xrInputDevices[e]?this._xrInputDevices[e][r]:null}getXRInputSource(e,r){let s=this._getXRInputDevice(e,r);return s?s.inputSource:null}getXRGamepad(e){let r=Ye.CONTROLLER,s=this.getXRInputSource(r,e);return s?s.gamepad:null}getXRController(e,r,s){let l=this._getXRInputDevice(e,r);return l?l.controllers[s]:null}getXRControllerModel(e,r){let s=this._getXRInputDevice(e,r);return s?s.model:null}setXRControllerModel(e,r,s){let l=this._getXRInputDevice(e,r);return!!l&&(l.model&&l.controllers.grip.remove(l.model),l.model=s,l.controllers.grip.add(s),!0)}enableXRControllerManagement(e){this._xrControllerParent=e}disableXRControllerManagement(){this._xrControllerParent=null}getPointerPosition(){return this._pointerPosition}isPointerPressed(){return this._pointerPressed}isKeyPressed(e){return this._keysPressed.has(e)}isKeyCodePressed(e){return this._keyCodesPressed.has(e)}isScreenTouched(){return this._screenTouched}getJoystickAngle(){return this._joystickAngle}getJoystickDistance(){return this._joystickDistance}_createExtraControls(){this._extraControls={},this._extraControlsDiv=document.createElement("div"),this._extraControlsDiv.style.position="absolute",this._extraControlsDiv.style.top="10px",this._extraControlsDiv.style.right="10px",this._container.appendChild(this._extraControlsDiv)}createJoystick(){let e=document.createElement("div");e.style.position="absolute",e.style.width="100px",e.style.height="100px",e.style.left="10px",e.style.bottom="10px",this._container.appendChild(e);let r={zone:e,mode:"static",position:{left:"50%",top:"50%"}},s=nipplejs.create(r).get(0);s.on("move",((e,r)=>{this._joystickAngle=r.angle.radian,this._joystickDistance=Math.min(r.force,1)})),s.on("end",(()=>{this._joystickDistance=0}))}addExtraControlsButton(e,r){let s=document.createElement("button");return s.id=e,s.innerText=r,s.style.borderWidth="1px",s.style.borderStyle="solid",s.style.borderColor="#fff",s.style.borderRadius="4px",s.style.background="rgba(0,0,0,0.5)",s.style.padding="12px",s.style.color="#fff",s.style.font="normal 13px sans-serif",s.style.marginLeft="5px",s.style.opacity="0.75",s.style.width="70px",this._extraControlsDiv.appendChild(s),this._extraControls[e]=s,s}getExtraControlsButton(e){return this._extraControls[e]}hideExtraControlsButton(e){let r=this._extraControls[e];r&&(r.style.display="none")}showExtraControlsButton(e){let r=this._extraControls[e];r&&(r.style.display="inline-block")}_updateXRController(e,r,s){let l=s.inputSource,u=s.controllers;if(l){let h=e.getPose(l.targetRaySpace,r);null!=h&&(u.targetRay.matrix.fromArray(h.transform.matrix),u.targetRay.matrix.decompose(u.targetRay.position,u.targetRay.rotation,u.targetRay.scale));let p=e.getPose(l.gripSpace,r);if(null!=p&&(u.grip.matrix.fromArray(p.transform.matrix),u.grip.matrix.decompose(u.grip.position,u.grip.rotation,u.grip.scale)),l.hand&&s.model){let l=s.model.motionController;l&&l.updateMesh(e,r,u.grip.matrix)}}}update(e){if(null==e)return;let r=this._renderer.xr.getReferenceSpace();for(let s in this._xrInputDevices)for(let l in this._xrInputDevices[s])this._updateXRController(e,r,this._xrInputDevices[s][l])}};class InteractableHandler{constructor(){this._interactables=new Set,this._hoveredInteractables=new Map,this._selectedInteractables=new Map,this._tool=null,this._toolHandlers={}}_setupXRSubscription(){qe.addUpdateListener((e=>{for(let[e,r]of this._hoveredInteractables)r&&r.removeHoveredBy(e),this._hoveredInteractables.delete(e);for(let[r,s]of this._selectedInteractables){if(!s)continue;let l=0;e&&(l+=s.getActionsLength(e)),this._tool&&(l+=s.getActionsLength(this._tool)),l&&(s.removeSelectedBy(r),this._selectedInteractables.delete(r))}this._tool=e}))}init(e){"XR"==e?(this.update=this._updateForXR,this._setupXRSubscription()):"POINTER"==e?this.update=this._updateForPointer:"TOUCH"==e&&(this.update=this._updateForMobile)}registerToolHandler(e,r){this._toolHandlers[e]=r}addInteractable(e){this._interactables.add(e)}addInteractables(e){e.forEach((e=>{this._interactables.add(e)}))}removeInteractable(e){this._interactables.delete(e),e.reset()}removeInteractables(e){e.forEach((e=>{this._interactables.delete(e),e.reset()}))}reset(){this._interactables.forEach((e=>{e.reset()})),this._interactables=new Set,this._hoveredInteractables=new Map,this._selectedInteractables=new Map}update(){}}let bt=new class extends InteractableHandler{constructor(){super()}init(r,s){super.init(r),this._scene=s,this._sphere=new e.Sphere,this._box3=new e.Box3}_getBoundingSphere(e){return e?(this._box3.setFromObject(e).getBoundingSphere(this._sphere),this._sphere):null}_isXRControllerPressed(e,r){if(e==Ye.HAND){let s=xt.getXRControllerModel(e,r);return null!=s?.motionController?.isGrabbing}{let e=xt.getXRGamepad(r);return null!=e?.buttons&&e.buttons[1].pressed}}_scopeInteractables(e,r){let s=e.boundingSphere;if(null!=s)for(let l of r){if((0!=l.children.size&&this._scopeInteractables(e,l.children),null!=l.getObject()&&!l.isOnlyGroup())&&l.intersectsSphere(s)){let r=l.distanceToSphere(s);r<e.closestPointDistance&&(e.closestPointDistance=r,e.closestInteractable=l)}}}_updateInteractables(e){let r=e.option,s=e.isPressed;this._scopeInteractables(e,this._interactables);let l=this._hoveredInteractables.get(r),u=this._selectedInteractables.get(r),h=e.closestInteractable;h?s?u||l!=h||(h.addSelectedBy(r),this._selectedInteractables.set(r,h),h.removeHoveredBy(r),this._hoveredInteractables.delete(r)):(l!=h&&(l&&l.removeHoveredBy(r),h.addHoveredBy(r),this._hoveredInteractables.set(r,h)),u&&(u.removeSelectedBy(r),this._selectedInteractables.delete(r))):s||(l&&(l.removeHoveredBy(r),this._hoveredInteractables.delete(r)),u&&(u.removeSelectedBy(r),this._selectedInteractables.delete(r)))}_updateForXR(){for(let e in Ke){let r=!1;for(let s of[Ye.HAND,Ye.CONTROLLER]){let l=xt.getXRController(s,e,"grip"),u=xt.getXRControllerModel(s,e);if(!l)continue;let h,p,m=isDescendant(this._scene,l);if(m&&(s==Ye.CONTROLLER?r=!0:r&&(m=!1)),m){h=isDescendant(l,u)?this._getBoundingSphere(u):this._getBoundingSphere(l),p=this._isXRControllerPressed(s,e)}let v={option:l,boundingSphere:h,isPressed:p,closestPointDistance:Number.MAX_SAFE_INTEGER},x=!1;this._toolHandlers[this._tool]&&(x=this._toolHandlers[this._tool](v)),x||this._updateInteractables(v)}}}_updateForPointer(){}_updateForMobile(){}};const _t=new e.Vector3;let Tt=new class extends InteractableHandler{constructor(){super(),this._cursors={},this._emptyClickListeners={},this._wasPressed=new Map}init(e,r,s,l,u){super.init(e),this._deviceType=e,this._renderer=r,this._scene=s,this._camera=l,this._cameraFocus=u||l}addEmptyClickListener(e){let r=uuidv4();return this._emptyClickListeners[r]=e,r}_getXRCursor(r){if(this._cursors[r])return this._cursors[r];let s=document.createElement("canvas");s.width=64,s.height=64;let l=s.getContext("2d");l.beginPath(),l.arc(32,32,29,0,2*Math.PI),l.lineWidth=5,l.stroke(),l.fillStyle="white",l.fill();let u=new e.SpriteMaterial({map:new e.CanvasTexture(s),depthTest:!1,sizeAttenuation:!1});for(let r in Ke){let s=new e.Sprite(u);s.scale.set(.015,.015,.015),s.visible=!1,s.renderOrder=1/0,this._cursors[r]=s,this._scene.add(s)}return this._cursors[r]}_getRaycaster(){this._raycaster||(this._raycaster=new e.Raycaster);let r=xt.getPointerPosition();return this._raycaster.setFromCamera(r,this._camera),this._raycaster}_getXRRaycaster(r){return r.raycaster||(r.raycaster=new e.Raycaster),r.getWorldPosition(r.raycaster.ray.origin),r.getWorldDirection(r.raycaster.ray.direction).negate().normalize(),r.raycaster}_isControllerPressed(e){if(e==Ke.LEFT||e==Ke.RIGHT){let r=xt.getXRGamepad(e);return null!=r&&r.buttons[0].pressed}return"POINTER"==e?xt.isPointerPressed():"MOBILE"==e?xt.isScreenTouched():void 0}_isXRControllerPressed(e,r){if(e==Ye.HAND){let s=xt.getXRControllerModel(e,r);return null!=s?.motionController?.isPinching}{let e=xt.getXRGamepad(r);return null!=e?.buttons&&e.buttons[0].pressed}}_squashInteractables(e,r,s){for(let l of r){let r=l.getObject();r&&!l.isOnlyGroup()&&s.push(r),0!=l.children.size&&this._squashInteractables(e,l.children,s)}}_getObjectInteractable(e){for(;null!=e;){if(e.pointerInteractable)return e.pointerInteractable;e=e.parent}}_raycastInteractables(e,r){let s=e.raycaster;if(!s)return;s.firstHitOnly=!0,s.params.Line.threshold=.01;let l=[];this._squashInteractables(e.option,r,l);let u=s.intersectObjects(l);for(let r of u){let s=this._getObjectInteractable(r.object);if(!s)continue;let l=r.distance,u=l;if("XR"!=this._deviceType&&(this._cameraFocus.getWorldPosition(_t),u=r.point.distanceTo(_t)),s.isWithinReach(u))return e.closestPointDistance=l,e.closestPoint=r.point,e.closestInteractable=s,void(e.userDistance=u)}}_updateInteractables(e){let r=e.option,s=e.isPressed,l=this._hoveredInteractables.get(r),u=this._selectedInteractables.get(r),h=e.closestInteractable,p=e.userDistance;if(h&&!h.isOnlyGroup())s?u?u==h&&u.triggerDraggableActions(r,e.closestPoint,p):l==h&&(h.addSelectedBy(r,e.closestPoint,p),this._selectedInteractables.set(r,h),h.removeHoveredBy(r),this._hoveredInteractables.delete(r)):(l!=h&&(l&&l.removeHoveredBy(r),h.addHoveredBy(r,e.closestPoint,p),this._hoveredInteractables.set(r,h)),u&&(u.removeSelectedBy(r),this._selectedInteractables.delete(r)));else if(!s){if(this._wasPressed.get(r)&&!l&&!u)for(let e in this._emptyClickListeners)this._emptyClickListeners[e](r);u&&(u.removeSelectedBy(r),this._selectedInteractables.delete(r)),l&&(l.removeHoveredBy(r),this._hoveredInteractables.delete(r))}this._wasPressed.set(r,s)}_updateInteractablesMobile(e){let r=e.option,s=e.isPressed,l=this._selectedInteractables.get(r);if(this._mobileWasTouched){if(!l)return void(this._mobileWasTouched=s);this._raycastInteractables(e,this._interactables);let u=e.userDistance,h=e.closestInteractable;s?l==h&&l.triggerDraggableActions(r,e.closestPoint,u):(this._mobileWasTouched=!1,h==l&&l.triggerActions(r,e.closestPoint,u),l.removeSelectedBy(r))}else if(s){this._mobileWasTouched=!0,this._raycastInteractables(e,this._interactables);let s=e.userDistance,l=e.closestInteractable;l&&(l.addSelectedBy(r,e.closestPoint,s),this._selectedInteractables.set(r,l))}}_updateCursor(e){let r=e.cursor;r&&(null!=e.closestPoint?(r.position.copy(e.closestPoint),r.visible||(r.visible=!0)):r.visible&&(r.visible=!1))}_updateForXR(){for(let e in Ke){let r=!1;for(let s of[Ye.HAND,Ye.CONTROLLER]){let l=xt.getXRController(s,e,"grip");if(!l)continue;let u,h,p=isDescendant(this._scene,l);if(p&&(s==Ye.CONTROLLER?r=!0:r&&(p=!1)),p){let r=xt.getXRController(s,e,"targetRay");u=this._getXRRaycaster(r),h=this._isXRControllerPressed(s,e)}let m={option:l,raycaster:u,isPressed:h,closestPoint:null,closestPointDistance:Number.MAX_SAFE_INTEGER,cursor:p?this._getXRCursor(e):null,userDistance:Number.MAX_SAFE_INTEGER},v=!1;this._toolHandlers[this._tool]&&(v=this._toolHandlers[this._tool](m)),v||(this._raycastInteractables(m,this._interactables),this._updateInteractables(m)),this._updateCursor(m)}}}_updateForPointer(){let e={option:"POINTER",raycaster:this._getRaycaster(),isPressed:this._isControllerPressed("POINTER"),closestPoint:null,closestPointDistance:Number.MAX_SAFE_INTEGER,userDistance:Number.MAX_SAFE_INTEGER},r=!1;this._toolHandlers[this._tool]&&(r=this._toolHandlers[this._tool](e)),r||(this._raycastInteractables(e,this._interactables),this._updateInteractables(e));let s=this._renderer.domElement.style;this._hoveredInteractables.get("POINTER")?s.cursor||(s.cursor="pointer"):"pointer"==s.cursor&&(s.cursor="")}_updateForMobile(){let e={option:"MOBILE",raycaster:this._getRaycaster(),isPressed:this._isControllerPressed("MOBILE"),closestPoint:null,closestPointDistance:Number.MAX_SAFE_INTEGER,userDistance:Number.MAX_SAFE_INTEGER};if(this._toolHandlers[this._tool]){if(this._toolHandlers[this._tool](e))return}this._updateInteractablesMobile(e)}};function workerBootstrap(){var e=Object.create(null);function registerModule(r,s){var l=r.id,u=r.name,h=r.dependencies;void 0===h&&(h=[]);var p=r.init;void 0===p&&(p=function(){});var m=r.getTransferables;if(void 0===m&&(m=null),!e[l])try{h=h.map((function(r){return r&&r.isWorkerModule&&(registerModule(r,(function(e){if(e instanceof Error)throw e})),r=e[r.id].value),r})),p=rehydrate("<"+u+">.init",p),m&&(m=rehydrate("<"+u+">.getTransferables",m));var v=null;"function"==typeof p?v=p.apply(void 0,h):console.error("worker module init function failed to rehydrate"),e[l]={id:l,value:v,getTransferables:m},s(v)}catch(e){e&&e.noLog||console.error(e),s(e)}}function rehydrate(e,r){var s=void 0;self.troikaDefine=function(e){return s=e};var l=URL.createObjectURL(new Blob(["/** "+e.replace(/\*/g,"")+" **/\n\ntroikaDefine(\n"+r+"\n)"],{type:"application/javascript"}));try{importScripts(l)}catch(e){console.error(e)}return URL.revokeObjectURL(l),delete self.troikaDefine,s}self.addEventListener("message",(function(r){var s=r.data,l=s.messageId,u=s.action,h=s.data;try{"registerModule"===u&&registerModule(h,(function(e){e instanceof Error?postMessage({messageId:l,success:!1,error:e.message}):postMessage({messageId:l,success:!0,result:{isCallable:"function"==typeof e}})})),"callModule"===u&&function(r,s){var l,u=r.id,h=r.args;e[u]&&"function"==typeof e[u].value||s(new Error("Worker module "+u+": not found or its 'init' did not return a function"));try{var p=(l=e[u]).value.apply(l,h);p&&"function"==typeof p.then?p.then(handleResult,(function(e){return s(e instanceof Error?e:new Error(""+e))})):handleResult(p)}catch(e){s(e)}function handleResult(r){try{var l=e[u].getTransferables&&e[u].getTransferables(r);l&&Array.isArray(l)&&l.length||(l=void 0),s(r,l)}catch(e){console.error(e),s(e)}}}(h,(function(e,r){e instanceof Error?postMessage({messageId:l,success:!1,error:e.message}):postMessage({messageId:l,success:!0,result:e},r||void 0)}))}catch(e){postMessage({messageId:l,success:!1,error:e.stack})}}))}var supportsWorkers=function(){var e=!1;if("undefined"!=typeof window&&void 0!==window.document)try{new Worker(URL.createObjectURL(new Blob([""],{type:"application/javascript"}))).terminate(),e=!0}catch(e){"undefined"!=typeof process&&"test"===process.env.NODE_ENV||console.log("Troika createWorkerModule: web workers not allowed; falling back to main thread execution. Cause: ["+e.message+"]")}return supportsWorkers=function(){return e},e},St=0,At=0,wt=!1,Ct=Object.create(null),Rt=Object.create(null),Et=Object.create(null);function defineWorkerModule(e){if(!(e&&"function"==typeof e.init||wt))throw new Error("requires `options.init` function");var r=e.dependencies,s=e.init,l=e.getTransferables,u=e.workerId;if(!supportsWorkers())return function(e){var moduleFunc=function(){for(var e=[],r=arguments.length;r--;)e[r]=arguments[r];return moduleFunc._getInitResult().then((function(r){if("function"==typeof r)return r.apply(void 0,e);throw new Error("Worker module function was called but `init` did not return a callable function")}))};return moduleFunc._getInitResult=function(){var r=e.dependencies,s=e.init;r=Array.isArray(r)?r.map((function(e){return e&&e._getInitResult?e._getInitResult():e})):[];var l=Promise.all(r).then((function(e){return s.apply(null,e)}));return moduleFunc._getInitResult=function(){return l},l},moduleFunc}(e);null==u&&(u="#default");var h="workerModule"+ ++St,p=e.name||h,m=null;function moduleFunc(){for(var e=[],r=arguments.length;r--;)e[r]=arguments[r];if(!m){m=callWorker(u,"registerModule",moduleFunc.workerModuleData);var unregister=function(){m=null,Rt[u].delete(unregister)};(Rt[u]||(Rt[u]=new Set)).add(unregister)}return m.then((function(r){if(r.isCallable)return callWorker(u,"callModule",{id:h,args:e});throw new Error("Worker module function was called but `init` did not return a callable function")}))}return r=r&&r.map((function(e){return"function"!=typeof e||e.workerModuleData||(wt=!0,e=defineWorkerModule({workerId:u,name:"<"+p+"> function dependency: "+e.name,init:"function(){return (\n"+stringifyFunction(e)+"\n)}"}),wt=!1),e&&e.workerModuleData&&(e=e.workerModuleData),e})),moduleFunc.workerModuleData={isWorkerModule:!0,id:h,name:p,dependencies:r,init:stringifyFunction(s),getTransferables:l&&stringifyFunction(l)},moduleFunc}function stringifyFunction(e){var r=e.toString();return!/^function/.test(r)&&/^\w+\s*\(/.test(r)&&(r="function "+r),r}function callWorker(e,r,s){return new Promise((function(l,u){var h=++At;Et[h]=function(e){e.success?l(e.result):u(new Error("Error in worker "+r+" call: "+e.error))},function(e){var r=Ct[e];if(!r){var s=stringifyFunction(workerBootstrap);(r=Ct[e]=new Worker(URL.createObjectURL(new Blob(["/** Worker Module Bootstrap: "+e.replace(/\*/g,"")+" **/\n\n;("+s+")()"],{type:"application/javascript"})))).onmessage=function(e){var r=e.data,s=r.messageId,l=Et[s];if(!l)throw new Error("WorkerModule response with empty or unknown messageId");delete Et[s],l(r)}}return r}(e).postMessage({messageId:h,action:r,data:s})}))}function SDFGenerator(){var e=function(e){function pointOnCubicBezier(e,r,s,l,u,h,p,m,v,x){var b=1-v;x.x=b*b*b*e+3*b*b*v*s+3*b*v*v*u+v*v*v*p,x.y=b*b*b*r+3*b*b*v*l+3*b*v*v*h+v*v*v*m}function forEachPathCommand(e,r){for(var s,l,u,h,p,m=/([MLQCZ])([^MLQCZ]*)/g;s=m.exec(e);){var v=s[2].replace(/^\s*|\s*$/g,"").split(/[,\s]+/).map((function(e){return parseFloat(e)}));switch(s[1]){case"M":h=l=v[0],p=u=v[1];break;case"L":v[0]===h&&v[1]===p||r("L",h,p,h=v[0],p=v[1]);break;case"Q":r("Q",h,p,h=v[2],p=v[3],v[0],v[1]);break;case"C":r("C",h,p,h=v[4],p=v[5],v[0],v[1],v[2],v[3]);break;case"Z":h===l&&p===u||r("L",h,p,l,u)}}}function pathToLineSegments(e,r,s){void 0===s&&(s=16);var l={x:0,y:0};forEachPathCommand(e,(function(e,u,h,p,m,v,x,b,_){switch(e){case"L":r(u,h,p,m);break;case"Q":for(var S=u,A=h,C=1;C<s;C++)F=h,D=x,G=m,j=void 0,j=1-(B=C/(s-1)),(N=l).x=j*j*u+2*j*B*v+B*B*p,N.y=j*j*F+2*j*B*D+B*B*G,r(S,A,l.x,l.y),S=l.x,A=l.y;break;case"C":for(var R=u,E=h,I=1;I<s;I++)pointOnCubicBezier(u,h,v,x,b,_,p,m,I/(s-1),l),r(R,E,l.x,l.y),R=l.x,E=l.y}var F,D,G,B,N,j}))}var r="precision highp float;attribute vec2 aUV;varying vec2 vUV;void main(){vUV=aUV;gl_Position=vec4(mix(vec2(-1.0),vec2(1.0),aUV),0.0,1.0);}",s="precision highp float;uniform sampler2D tex;varying vec2 vUV;void main(){gl_FragColor=texture2D(tex,vUV);}",l=new WeakMap,u={premultipliedAlpha:!1,preserveDrawingBuffer:!0,antialias:!1,depth:!1};function withWebGLContext(e,r){var s=e.getContext?e.getContext("webgl",u):e,h=l.get(s);if(!h){var p="undefined"!=typeof WebGL2RenderingContext&&s instanceof WebGL2RenderingContext,m={},v={},x={},b=-1,_=[];function getExtension(e){var r=m[e];if(!r&&!(r=m[e]=s.getExtension(e)))throw new Error(e+" not supported");return r}function compileShader(e,r){var l=s.createShader(r);return s.shaderSource(l,e),s.compileShader(l),l}function withProgram(e,r,l,u){if(!v[e]){var h={},m={},x=s.createProgram();s.attachShader(x,compileShader(r,s.VERTEX_SHADER)),s.attachShader(x,compileShader(l,s.FRAGMENT_SHADER)),s.linkProgram(x),v[e]={program:x,transaction:function(e){s.useProgram(x),e({setUniform:function(e,r){for(var l=[],u=arguments.length-2;u-- >0;)l[u]=arguments[u+2];var h=m[r]||(m[r]=s.getUniformLocation(x,r));s["uniform"+e].apply(s,[h].concat(l))},setAttribute:function(e,r,l,u,m){var v=h[e];v||(v=h[e]={buf:s.createBuffer(),loc:s.getAttribLocation(x,e),data:null}),s.bindBuffer(s.ARRAY_BUFFER,v.buf),s.vertexAttribPointer(v.loc,r,s.FLOAT,!1,0,0),s.enableVertexAttribArray(v.loc),p?s.vertexAttribDivisor(v.loc,u):getExtension("ANGLE_instanced_arrays").vertexAttribDivisorANGLE(v.loc,u),m!==v.data&&(s.bufferData(s.ARRAY_BUFFER,m,l),v.data=m)}})}}}v[e].transaction(u)}function withTexture(e,r){b++;try{s.activeTexture(s.TEXTURE0+b);var l=x[e];l||(l=x[e]=s.createTexture(),s.bindTexture(s.TEXTURE_2D,l),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,s.NEAREST),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,s.NEAREST)),s.bindTexture(s.TEXTURE_2D,l),r(l,b)}finally{b--}}function withTextureFramebuffer(e,r,l){var u=s.createFramebuffer();_.push(u),s.bindFramebuffer(s.FRAMEBUFFER,u),s.activeTexture(s.TEXTURE0+r),s.bindTexture(s.TEXTURE_2D,e),s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_2D,e,0);try{l(u)}finally{s.deleteFramebuffer(u),s.bindFramebuffer(s.FRAMEBUFFER,_[--_.length-1]||null)}}function handleContextLoss(){m={},v={},x={},b=-1,_.length=0}s.canvas.addEventListener("webglcontextlost",(function(e){handleContextLoss(),e.preventDefault()}),!1),l.set(s,h={gl:s,isWebGL2:p,getExtension:getExtension,withProgram:withProgram,withTexture:withTexture,withTextureFramebuffer:withTextureFramebuffer,handleContextLoss:handleContextLoss})}r(h)}function renderImageData(e,l,u,h,p,m,v,x){void 0===v&&(v=15),void 0===x&&(x=null),withWebGLContext(e,(function(e){var b=e.gl,_=e.withProgram;(0,e.withTexture)("copy",(function(e,S){b.texImage2D(b.TEXTURE_2D,0,b.RGBA,p,m,0,b.RGBA,b.UNSIGNED_BYTE,l),_("copy",r,s,(function(e){var r=e.setUniform;(0,e.setAttribute)("aUV",2,b.STATIC_DRAW,0,new Float32Array([0,0,2,0,0,2])),r("1i","image",S),b.bindFramebuffer(b.FRAMEBUFFER,x||null),b.disable(b.BLEND),b.colorMask(8&v,4&v,2&v,1&v),b.viewport(u,h,p,m),b.scissor(u,h,p,m),b.drawArrays(b.TRIANGLES,0,3)}))}))}))}var h=Object.freeze({__proto__:null,withWebGLContext:withWebGLContext,renderImageData:renderImageData,resizeWebGLCanvasWithoutClearing:function(e,r,s){var l=e.width,u=e.height;withWebGLContext(e,(function(h){var p=h.gl,m=new Uint8Array(l*u*4);p.readPixels(0,0,l,u,p.RGBA,p.UNSIGNED_BYTE,m),e.width=r,e.height=s,renderImageData(p,m,0,0,l,u)}))}});function generate$2(e,r,s,l,u,h){void 0===h&&(h=1);var p=new Uint8Array(e*r),m=l[2]-l[0],v=l[3]-l[1],x=[];pathToLineSegments(s,(function(e,r,s,l){x.push({x1:e,y1:r,x2:s,y2:l,minX:Math.min(e,s),minY:Math.min(r,l),maxX:Math.max(e,s),maxY:Math.max(r,l)})})),x.sort((function(e,r){return e.maxX-r.maxX}));for(var b=0;b<e;b++)for(var _=0;_<r;_++){var S=findNearestSignedDistance(l[0]+m*(b+.5)/e,l[1]+v*(_+.5)/r),A=Math.pow(1-Math.abs(S)/u,h)/2;S<0&&(A=1-A),A=Math.max(0,Math.min(255,Math.round(255*A))),p[_*e+b]=A}return p;function findNearestSignedDistance(e,r){for(var s=1/0,l=1/0,u=x.length;u--;){var h=x[u];if(h.maxX+l<=e)break;if(e+l>h.minX&&r-l<h.maxY&&r+l>h.minY){var p=absSquareDistanceToLineSegment(e,r,h.x1,h.y1,h.x2,h.y2);p<s&&(s=p,l=Math.sqrt(s))}}return function(e,r){for(var s=0,l=x.length;l--;){var u=x[l];if(u.maxX<=e)break;u.y1>r!=u.y2>r&&e<(u.x2-u.x1)*(r-u.y1)/(u.y2-u.y1)+u.x1&&(s+=u.y1<u.y2?1:-1)}return 0!==s}(e,r)&&(l=-l),l}}function generateIntoCanvas$2(e,r,s,l,u,h,p,m,v,x){void 0===h&&(h=1),void 0===m&&(m=0),void 0===v&&(v=0),void 0===x&&(x=0),generateIntoFramebuffer$1(e,r,s,l,u,h,p,null,m,v,x)}function generateIntoFramebuffer$1(e,r,s,l,u,h,p,m,v,x,b){void 0===h&&(h=1),void 0===v&&(v=0),void 0===x&&(x=0),void 0===b&&(b=0);for(var _=generate$2(e,r,s,l,u,h),S=new Uint8Array(4*_.length),A=0;A<_.length;A++)S[4*A+b]=_[A];renderImageData(p,S,v,x,e,r,1<<3-b,m)}function absSquareDistanceToLineSegment(e,r,s,l,u,h){var p=u-s,m=h-l,v=p*p+m*m,x=v?Math.max(0,Math.min(1,((e-s)*p+(r-l)*m)/v)):0,b=e-(s+x*p),_=r-(l+x*m);return b*b+_*_}var p=Object.freeze({__proto__:null,generate:generate$2,generateIntoCanvas:generateIntoCanvas$2,generateIntoFramebuffer:generateIntoFramebuffer$1}),m="precision highp float;uniform vec4 uGlyphBounds;attribute vec2 aUV;attribute vec4 aLineSegment;varying vec4 vLineSegment;varying vec2 vGlyphXY;void main(){vLineSegment=aLineSegment;vGlyphXY=mix(uGlyphBounds.xy,uGlyphBounds.zw,aUV);gl_Position=vec4(mix(vec2(-1.0),vec2(1.0),aUV),0.0,1.0);}",v="precision highp float;uniform vec4 uGlyphBounds;uniform float uMaxDistance;uniform float uExponent;varying vec4 vLineSegment;varying vec2 vGlyphXY;float absDistToSegment(vec2 point,vec2 lineA,vec2 lineB){vec2 lineDir=lineB-lineA;float lenSq=dot(lineDir,lineDir);float t=lenSq==0.0 ? 0.0 : clamp(dot(point-lineA,lineDir)/lenSq,0.0,1.0);vec2 linePt=lineA+t*lineDir;return distance(point,linePt);}void main(){vec4 seg=vLineSegment;vec2 p=vGlyphXY;float dist=absDistToSegment(p,seg.xy,seg.zw);float val=pow(1.0-clamp(dist/uMaxDistance,0.0,1.0),uExponent)*0.5;bool crossing=(seg.y>p.y!=seg.w>p.y)&&(p.x<(seg.z-seg.x)*(p.y-seg.y)/(seg.w-seg.y)+seg.x);bool crossingUp=crossing&&vLineSegment.y<vLineSegment.w;gl_FragColor=vec4(crossingUp ? 1.0/255.0 : 0.0,crossing&&!crossingUp ? 1.0/255.0 : 0.0,0.0,val);}",x="precision highp float;uniform sampler2D tex;varying vec2 vUV;void main(){vec4 color=texture2D(tex,vUV);bool inside=color.r!=color.g;float val=inside ? 1.0-color.a : color.a;gl_FragColor=vec4(val);}",b=new Float32Array([0,0,2,0,0,2]),_=null,S=!1,A={},C=new WeakMap;function validateSupport(e){if(!S&&!isSupported(e))throw new Error("WebGL generation not supported")}function generate$1(e,r,s,l,u,h,p){if(void 0===h&&(h=1),void 0===p&&(p=null),!p&&!(p=_)){var m="function"==typeof OffscreenCanvas?new OffscreenCanvas(1,1):"undefined"!=typeof document?document.createElement("canvas"):null;if(!m)throw new Error("OffscreenCanvas or DOM canvas not supported");p=_=m.getContext("webgl",{depth:!1})}validateSupport(p);var v=new Uint8Array(e*r*4);withWebGLContext(p,(function(p){var m=p.gl,x=p.withTexture,b=p.withTextureFramebuffer;x("readable",(function(p,x){m.texImage2D(m.TEXTURE_2D,0,m.RGBA,e,r,0,m.RGBA,m.UNSIGNED_BYTE,null),b(p,x,(function(p){generateIntoFramebuffer(e,r,s,l,u,h,m,p,0,0,0),m.readPixels(0,0,e,r,m.RGBA,m.UNSIGNED_BYTE,v)}))}))}));for(var x=new Uint8Array(e*r),b=0,S=0;b<v.length;b+=4)x[S++]=v[b];return x}function generateIntoCanvas$1(e,r,s,l,u,h,p,m,v,x){void 0===h&&(h=1),void 0===m&&(m=0),void 0===v&&(v=0),void 0===x&&(x=0),generateIntoFramebuffer(e,r,s,l,u,h,p,null,m,v,x)}function generateIntoFramebuffer(e,s,l,u,h,p,_,S,A,C,R){void 0===p&&(p=1),void 0===A&&(A=0),void 0===C&&(C=0),void 0===R&&(R=0),validateSupport(_);var E=[];pathToLineSegments(l,(function(e,r,s,l){E.push(e,r,s,l)})),E=new Float32Array(E),withWebGLContext(_,(function(l){var _=l.gl,I=l.isWebGL2,F=l.getExtension,D=l.withProgram,G=l.withTexture,B=l.withTextureFramebuffer,N=l.handleContextLoss;if(G("rawDistances",(function(l,G){e===l._lastWidth&&s===l._lastHeight||_.texImage2D(_.TEXTURE_2D,0,_.RGBA,l._lastWidth=e,l._lastHeight=s,0,_.RGBA,_.UNSIGNED_BYTE,null),D("main",m,v,(function(r){var m=r.setAttribute,v=r.setUniform,x=!I&&F("ANGLE_instanced_arrays"),S=!I&&F("EXT_blend_minmax");m("aUV",2,_.STATIC_DRAW,0,b),m("aLineSegment",4,_.DYNAMIC_DRAW,1,E),v.apply(void 0,["4f","uGlyphBounds"].concat(u)),v("1f","uMaxDistance",h),v("1f","uExponent",p),B(l,G,(function(r){_.enable(_.BLEND),_.colorMask(!0,!0,!0,!0),_.viewport(0,0,e,s),_.scissor(0,0,e,s),_.blendFunc(_.ONE,_.ONE),_.blendEquationSeparate(_.FUNC_ADD,I?_.MAX:S.MAX_EXT),_.clear(_.COLOR_BUFFER_BIT),I?_.drawArraysInstanced(_.TRIANGLES,0,3,E.length/4):x.drawArraysInstancedANGLE(_.TRIANGLES,0,3,E.length/4)}))})),D("post",r,x,(function(r){r.setAttribute("aUV",2,_.STATIC_DRAW,0,b),r.setUniform("1i","tex",G),_.bindFramebuffer(_.FRAMEBUFFER,S),_.disable(_.BLEND),_.colorMask(0===R,1===R,2===R,3===R),_.viewport(A,C,e,s),_.scissor(A,C,e,s),_.drawArrays(_.TRIANGLES,0,3)}))})),_.isContextLost())throw N(),new Error("webgl context lost")}))}function isSupported(e){var r=e&&e!==_?e.canvas||e:A,s=C.get(r);if(void 0===s){S=!0;var l=null;try{var u=[97,106,97,61,99,137,118,80,80,118,137,99,61,97,106,97],h=generate$1(4,4,"M8,8L16,8L24,24L16,24Z",[0,0,32,32],24,1,e);(s=h&&u.length===h.length&&h.every((function(e,r){return e===u[r]})))||(l="bad trial run results",console.info(u,h))}catch(e){s=!1,l=e.message}l&&console.warn("WebGL SDF generation not supported:",l),S=!1,C.set(r,s)}return s}var R=Object.freeze({__proto__:null,generate:generate$1,generateIntoCanvas:generateIntoCanvas$1,generateIntoFramebuffer:generateIntoFramebuffer,isSupported:isSupported});return e.forEachPathCommand=forEachPathCommand,e.generate=function(e,r,s,l,u,h){void 0===u&&(u=Math.max(l[2]-l[0],l[3]-l[1])/2),void 0===h&&(h=1);try{return generate$1.apply(R,arguments)}catch(e){return console.info("WebGL SDF generation failed, falling back to JS",e),generate$2.apply(p,arguments)}},e.generateIntoCanvas=function(e,r,s,l,u,h,m,v,x,b){void 0===u&&(u=Math.max(l[2]-l[0],l[3]-l[1])/2),void 0===h&&(h=1),void 0===v&&(v=0),void 0===x&&(x=0),void 0===b&&(b=0);try{return generateIntoCanvas$1.apply(R,arguments)}catch(e){return console.info("WebGL SDF generation failed, falling back to JS",e),generateIntoCanvas$2.apply(p,arguments)}},e.javascript=p,e.pathToLineSegments=pathToLineSegments,e.webgl=R,e.webglUtils=h,Object.defineProperty(e,"__esModule",{value:!0}),e}({});return e}const It=/\bvoid\s+main\s*\(\s*\)\s*{/g;function expandShaderIncludes(e){return e.replace(/^[ \t]*#include +<([\w\d./]+)>/gm,(function(e,r){let s=Oe[r];return s?expandShaderIncludes(s):e}))}const Ut=[];for(let e=0;e<256;e++)Ut[e]=(e<16?"0":"")+e.toString(16);const kt=Object.assign||function(){let e=arguments[0];for(let r=1,s=arguments.length;r<s;r++){let s=arguments[r];if(s)for(let r in s)Object.prototype.hasOwnProperty.call(s,r)&&(e[r]=s[r])}return e},Ft=Date.now(),Mt=new WeakMap,Lt=new Map;let Pt=1e10;function createDerivedMaterial(e,r){const s=function(e){const r=JSON.stringify(e,optionsJsonReplacer);let s=Ot.get(r);null==s&&Ot.set(r,s=++Dt);return s}
/*!
Custom build of Typr.ts (https://github.com/fredli74/Typr.ts) for use in Troika text rendering.
Original MIT license applies: https://github.com/fredli74/Typr.ts/blob/master/LICENSE
*/(r);let l=Mt.get(e);if(l||Mt.set(e,l=Object.create(null)),l[s])return new l[s];const u=`_onBeforeCompile${s}`,onBeforeCompile=function(l,h){e.onBeforeCompile.call(this,l,h);const p=this.customProgramCacheKey()+"|"+l.vertexShader+"|"+l.fragmentShader;let m=Lt[p];if(!m){const e=function(e,{vertexShader:r,fragmentShader:s},l,u){let{vertexDefs:h,vertexMainIntro:p,vertexMainOutro:m,vertexTransform:v,fragmentDefs:x,fragmentMainIntro:b,fragmentMainOutro:_,fragmentColorTransform:S,customRewriter:A,timeUniform:C}=l;h=h||"",p=p||"",m=m||"",x=x||"",b=b||"",_=_||"",(v||A)&&(r=expandShaderIncludes(r));(S||A)&&(s=expandShaderIncludes(s=s.replace(/^[ \t]*#include <((?:tonemapping|encodings|fog|premultiplied_alpha|dithering)_fragment)>/gm,"\n//!BEGIN_POST_CHUNK $1\n$&\n//!END_POST_CHUNK\n")));if(A){let e=A({vertexShader:r,fragmentShader:s});r=e.vertexShader,s=e.fragmentShader}if(S){let e=[];s=s.replace(/^\/\/!BEGIN_POST_CHUNK[^]+?^\/\/!END_POST_CHUNK/gm,(r=>(e.push(r),""))),_=`${S}\n${e.join("\n")}\n${_}`}if(C){const e=`\nuniform float ${C};\n`;h=e+h,x=e+x}v&&(h=`${h}\nvoid troikaVertexTransform${u}(inout vec3 position, inout vec3 normal, inout vec2 uv) {\n  ${v}\n}\n`,p=`\ntroika_position_${u} = vec3(position);\ntroika_normal_${u} = vec3(normal);\ntroika_uv_${u} = vec2(uv);\ntroikaVertexTransform${u}(troika_position_${u}, troika_normal_${u}, troika_uv_${u});\n${p}\n`,r=(r=`vec3 troika_position_${u};\nvec3 troika_normal_${u};\nvec2 troika_uv_${u};\n${r}\n`).replace(/\b(position|normal|uv)\b/g,((e,r,s,l)=>/\battribute\s+vec[23]\s+$/.test(l.substr(0,s))?r:`troika_${r}_${u}`)),e.map&&e.map.channel>0||(r=r.replace(/\bMAP_UV\b/g,`troika_uv_${u}`)));return r=injectIntoShaderCode(r,u,h,p,m),s=injectIntoShaderCode(s,u,x,b,_),{vertexShader:r,fragmentShader:s}}(this,l,r,s);m=Lt[p]=e}l.vertexShader=m.vertexShader,l.fragmentShader=m.fragmentShader,kt(l.uniforms,this.uniforms),r.timeUniform&&(l.uniforms[r.timeUniform]={get value(){return Date.now()-Ft}}),this[u]&&this[u](l)},DerivedMaterial=function(){return derive(r.chained?e:e.clone())},derive=function(l){const u=Object.create(l,h);return Object.defineProperty(u,"baseMaterial",{value:e}),Object.defineProperty(u,"id",{value:Pt++}),u.uuid=function(){const e=4294967295*Math.random()|0,r=4294967295*Math.random()|0,s=4294967295*Math.random()|0,l=4294967295*Math.random()|0;return(Ut[255&e]+Ut[e>>8&255]+Ut[e>>16&255]+Ut[e>>24&255]+"-"+Ut[255&r]+Ut[r>>8&255]+"-"+Ut[r>>16&15|64]+Ut[r>>24&255]+"-"+Ut[63&s|128]+Ut[s>>8&255]+"-"+Ut[s>>16&255]+Ut[s>>24&255]+Ut[255&l]+Ut[l>>8&255]+Ut[l>>16&255]+Ut[l>>24&255]).toUpperCase()}(),u.uniforms=kt({},l.uniforms,r.uniforms),u.defines=kt({},l.defines,r.defines),u.defines[`TROIKA_DERIVED_MATERIAL_${s}`]="",u.extensions=kt({},l.extensions,r.extensions),u._listeners=void 0,u},h={constructor:{value:DerivedMaterial},isDerivedMaterial:{value:!0},customProgramCacheKey:{writable:!0,configurable:!0,value:function(){return e.customProgramCacheKey()+"|"+s}},onBeforeCompile:{get:()=>onBeforeCompile,set(e){this[u]=e}},copy:{writable:!0,configurable:!0,value:function(r){return e.copy.call(this,r),e.isShaderMaterial||e.isDerivedMaterial||(kt(this.extensions,r.extensions),kt(this.defines,r.defines),kt(this.uniforms,Me.clone(r.uniforms))),this}},clone:{writable:!0,configurable:!0,value:function(){const r=new e.constructor;return derive(r).copy(this)}},getDepthMaterial:{writable:!0,configurable:!0,value:function(){let s=this._depthMaterial;return s||(s=this._depthMaterial=createDerivedMaterial(e.isDerivedMaterial?e.getDepthMaterial():new Le({depthPacking:Pe}),r),s.defines.IS_DEPTH_MATERIAL="",s.uniforms=this.uniforms),s}},getDistanceMaterial:{writable:!0,configurable:!0,value:function(){let s=this._distanceMaterial;return s||(s=this._distanceMaterial=createDerivedMaterial(e.isDerivedMaterial?e.getDistanceMaterial():new De,r),s.defines.IS_DISTANCE_MATERIAL="",s.uniforms=this.uniforms),s}},dispose:{writable:!0,configurable:!0,value(){const{_depthMaterial:r,_distanceMaterial:s}=this;r&&r.dispose(),s&&s.dispose(),e.dispose.call(this)}}};return l[s]=DerivedMaterial,new DerivedMaterial}function injectIntoShaderCode(e,r,s,l,u){return(l||u||s)&&(e=e.replace(It,`\n${s}\nvoid troikaOrigMain${r}() {`),e+=`\nvoid main() {\n  ${l}\n  troikaOrigMain${r}();\n  ${u}\n}`),e}function optionsJsonReplacer(e,r){return"uniforms"===e?void 0:"function"==typeof r?r.toString():r}let Dt=0;const Ot=new Map;const Gt=defineWorkerModule({name:"Typr Font Parser",dependencies:[function(){return"undefined"==typeof window&&(self.window=self),function(e){var r={parse:function(e){var s=r._bin,l=new Uint8Array(e);if("ttcf"==s.readASCII(l,0,4)){var u=4;s.readUshort(l,u),u+=2,s.readUshort(l,u),u+=2;var h=s.readUint(l,u);u+=4;for(var p=[],m=0;m<h;m++){var v=s.readUint(l,u);u+=4,p.push(r._readFont(l,v))}return p}return[r._readFont(l,0)]},_readFont:function(e,s){var l=r._bin,u=s;l.readFixed(e,s),s+=4;var h=l.readUshort(e,s);s+=2,l.readUshort(e,s),s+=2,l.readUshort(e,s),s+=2,l.readUshort(e,s),s+=2;for(var p=["cmap","head","hhea","maxp","hmtx","name","OS/2","post","loca","glyf","kern","CFF ","GDEF","GPOS","GSUB","SVG "],m={_data:e,_offset:u},v={},x=0;x<h;x++){var b=l.readASCII(e,s,4);s+=4,l.readUint(e,s),s+=4;var _=l.readUint(e,s);s+=4;var S=l.readUint(e,s);s+=4,v[b]={offset:_,length:S}}for(x=0;x<p.length;x++){var A=p[x];v[A]&&(m[A.trim()]=r[A.trim()].parse(e,v[A].offset,v[A].length,m))}return m},_tabOffset:function(e,s,l){for(var u=r._bin,h=u.readUshort(e,l+4),p=l+12,m=0;m<h;m++){var v=u.readASCII(e,p,4);p+=4,u.readUint(e,p),p+=4;var x=u.readUint(e,p);if(p+=4,u.readUint(e,p),p+=4,v==s)return x}return 0}};r._bin={readFixed:function(e,r){return(e[r]<<8|e[r+1])+(e[r+2]<<8|e[r+3])/65540},readF2dot14:function(e,s){return r._bin.readShort(e,s)/16384},readInt:function(e,s){return r._bin._view(e).getInt32(s)},readInt8:function(e,s){return r._bin._view(e).getInt8(s)},readShort:function(e,s){return r._bin._view(e).getInt16(s)},readUshort:function(e,s){return r._bin._view(e).getUint16(s)},readUshorts:function(e,s,l){for(var u=[],h=0;h<l;h++)u.push(r._bin.readUshort(e,s+2*h));return u},readUint:function(e,s){return r._bin._view(e).getUint32(s)},readUint64:function(e,s){return 4294967296*r._bin.readUint(e,s)+r._bin.readUint(e,s+4)},readASCII:function(e,r,s){for(var l="",u=0;u<s;u++)l+=String.fromCharCode(e[r+u]);return l},readUnicode:function(e,r,s){for(var l="",u=0;u<s;u++){var h=e[r++]<<8|e[r++];l+=String.fromCharCode(h)}return l},_tdec:"undefined"!=typeof window&&window.TextDecoder?new window.TextDecoder:null,readUTF8:function(e,s,l){var u=r._bin._tdec;return u&&0==s&&l==e.length?u.decode(e):r._bin.readASCII(e,s,l)},readBytes:function(e,r,s){for(var l=[],u=0;u<s;u++)l.push(e[r+u]);return l},readASCIIArray:function(e,r,s){for(var l=[],u=0;u<s;u++)l.push(String.fromCharCode(e[r+u]));return l},_view:function(e){return e._dataView||(e._dataView=e.buffer?new DataView(e.buffer,e.byteOffset,e.byteLength):new DataView(new Uint8Array(e).buffer))}},r._lctf={},r._lctf.parse=function(e,s,l,u,h){var p=r._bin,m={},v=s;p.readFixed(e,s),s+=4;var x=p.readUshort(e,s);s+=2;var b=p.readUshort(e,s);s+=2;var _=p.readUshort(e,s);return s+=2,m.scriptList=r._lctf.readScriptList(e,v+x),m.featureList=r._lctf.readFeatureList(e,v+b),m.lookupList=r._lctf.readLookupList(e,v+_,h),m},r._lctf.readLookupList=function(e,s,l){var u=r._bin,h=s,p=[],m=u.readUshort(e,s);s+=2;for(var v=0;v<m;v++){var x=u.readUshort(e,s);s+=2;var b=r._lctf.readLookupTable(e,h+x,l);p.push(b)}return p},r._lctf.readLookupTable=function(e,s,l){var u=r._bin,h=s,p={tabs:[]};p.ltype=u.readUshort(e,s),s+=2,p.flag=u.readUshort(e,s),s+=2;var m=u.readUshort(e,s);s+=2;for(var v=p.ltype,x=0;x<m;x++){var b=u.readUshort(e,s);s+=2;var _=l(e,v,h+b,p);p.tabs.push(_)}return p},r._lctf.numOfOnes=function(e){for(var r=0,s=0;s<32;s++)0!=(e>>>s&1)&&r++;return r},r._lctf.readClassDef=function(e,s){var l=r._bin,u=[],h=l.readUshort(e,s);if(s+=2,1==h){var p=l.readUshort(e,s);s+=2;var m=l.readUshort(e,s);s+=2;for(var v=0;v<m;v++)u.push(p+v),u.push(p+v),u.push(l.readUshort(e,s)),s+=2}if(2==h){var x=l.readUshort(e,s);for(s+=2,v=0;v<x;v++)u.push(l.readUshort(e,s)),s+=2,u.push(l.readUshort(e,s)),s+=2,u.push(l.readUshort(e,s)),s+=2}return u},r._lctf.getInterval=function(e,r){for(var s=0;s<e.length;s+=3){var l=e[s],u=e[s+1];if(e[s+2],l<=r&&r<=u)return s}return-1},r._lctf.readCoverage=function(e,s){var l=r._bin,u={};u.fmt=l.readUshort(e,s),s+=2;var h=l.readUshort(e,s);return s+=2,1==u.fmt&&(u.tab=l.readUshorts(e,s,h)),2==u.fmt&&(u.tab=l.readUshorts(e,s,3*h)),u},r._lctf.coverageIndex=function(e,s){var l=e.tab;if(1==e.fmt)return l.indexOf(s);if(2==e.fmt){var u=r._lctf.getInterval(l,s);if(-1!=u)return l[u+2]+(s-l[u])}return-1},r._lctf.readFeatureList=function(e,s){var l=r._bin,u=s,h=[],p=l.readUshort(e,s);s+=2;for(var m=0;m<p;m++){var v=l.readASCII(e,s,4);s+=4;var x=l.readUshort(e,s);s+=2;var b=r._lctf.readFeatureTable(e,u+x);b.tag=v.trim(),h.push(b)}return h},r._lctf.readFeatureTable=function(e,s){var l=r._bin,u=s,h={},p=l.readUshort(e,s);s+=2,p>0&&(h.featureParams=u+p);var m=l.readUshort(e,s);s+=2,h.tab=[];for(var v=0;v<m;v++)h.tab.push(l.readUshort(e,s+2*v));return h},r._lctf.readScriptList=function(e,s){var l=r._bin,u=s,h={},p=l.readUshort(e,s);s+=2;for(var m=0;m<p;m++){var v=l.readASCII(e,s,4);s+=4;var x=l.readUshort(e,s);s+=2,h[v.trim()]=r._lctf.readScriptTable(e,u+x)}return h},r._lctf.readScriptTable=function(e,s){var l=r._bin,u=s,h={},p=l.readUshort(e,s);s+=2,p>0&&(h.default=r._lctf.readLangSysTable(e,u+p));var m=l.readUshort(e,s);s+=2;for(var v=0;v<m;v++){var x=l.readASCII(e,s,4);s+=4;var b=l.readUshort(e,s);s+=2,h[x.trim()]=r._lctf.readLangSysTable(e,u+b)}return h},r._lctf.readLangSysTable=function(e,s){var l=r._bin,u={};l.readUshort(e,s),s+=2,u.reqFeature=l.readUshort(e,s),s+=2;var h=l.readUshort(e,s);return s+=2,u.features=l.readUshorts(e,s,h),u},r.CFF={},r.CFF.parse=function(e,s,l){var u=r._bin;(e=new Uint8Array(e.buffer,s,l))[s=0],e[++s],e[++s],e[++s],s++;var h=[];s=r.CFF.readIndex(e,s,h);for(var p=[],m=0;m<h.length-1;m++)p.push(u.readASCII(e,s+h[m],h[m+1]-h[m]));s+=h[h.length-1];var v=[];s=r.CFF.readIndex(e,s,v);var x=[];for(m=0;m<v.length-1;m++)x.push(r.CFF.readDict(e,s+v[m],s+v[m+1]));s+=v[v.length-1];var b=x[0],_=[];s=r.CFF.readIndex(e,s,_);var S=[];for(m=0;m<_.length-1;m++)S.push(u.readASCII(e,s+_[m],_[m+1]-_[m]));if(s+=_[_.length-1],r.CFF.readSubrs(e,s,b),b.CharStrings){s=b.CharStrings,_=[],s=r.CFF.readIndex(e,s,_);var A=[];for(m=0;m<_.length-1;m++)A.push(u.readBytes(e,s+_[m],_[m+1]-_[m]));b.CharStrings=A}if(b.ROS){s=b.FDArray;var C=[];for(s=r.CFF.readIndex(e,s,C),b.FDArray=[],m=0;m<C.length-1;m++){var R=r.CFF.readDict(e,s+C[m],s+C[m+1]);r.CFF._readFDict(e,R,S),b.FDArray.push(R)}s+=C[C.length-1],s=b.FDSelect,b.FDSelect=[];var E=e[s];if(s++,3!=E)throw E;var I=u.readUshort(e,s);for(s+=2,m=0;m<I+1;m++)b.FDSelect.push(u.readUshort(e,s),e[s+2]),s+=3}return b.Encoding&&(b.Encoding=r.CFF.readEncoding(e,b.Encoding,b.CharStrings.length)),b.charset&&(b.charset=r.CFF.readCharset(e,b.charset,b.CharStrings.length)),r.CFF._readFDict(e,b,S),b},r.CFF._readFDict=function(e,s,l){var u;for(var h in s.Private&&(u=s.Private[1],s.Private=r.CFF.readDict(e,u,u+s.Private[0]),s.Private.Subrs&&r.CFF.readSubrs(e,u+s.Private.Subrs,s.Private)),s)-1!=["FamilyName","FontName","FullName","Notice","version","Copyright"].indexOf(h)&&(s[h]=l[s[h]-426+35])},r.CFF.readSubrs=function(e,s,l){var u=r._bin,h=[];s=r.CFF.readIndex(e,s,h);var p,m=h.length;p=m<1240?107:m<33900?1131:32768,l.Bias=p,l.Subrs=[];for(var v=0;v<h.length-1;v++)l.Subrs.push(u.readBytes(e,s+h[v],h[v+1]-h[v]))},r.CFF.tableSE=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,0,111,112,113,114,0,115,116,117,118,119,120,121,122,0,123,0,124,125,126,127,128,129,130,131,0,132,133,0,134,135,136,137,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,138,0,139,0,0,0,0,140,141,142,143,0,0,0,0,0,144,0,0,0,145,0,0,146,147,148,149,0,0,0,0],r.CFF.glyphByUnicode=function(e,r){for(var s=0;s<e.charset.length;s++)if(e.charset[s]==r)return s;return-1},r.CFF.glyphBySE=function(e,s){return s<0||s>255?-1:r.CFF.glyphByUnicode(e,r.CFF.tableSE[s])},r.CFF.readEncoding=function(e,s,l){r._bin;var u=[".notdef"],h=e[s];if(s++,0!=h)throw"error: unknown encoding format: "+h;var p=e[s];s++;for(var m=0;m<p;m++)u.push(e[s+m]);return u},r.CFF.readCharset=function(e,s,l){var u=r._bin,h=[".notdef"],p=e[s];if(s++,0==p)for(var m=0;m<l;m++){var v=u.readUshort(e,s);s+=2,h.push(v)}else{if(1!=p&&2!=p)throw"error: format: "+p;for(;h.length<l;){v=u.readUshort(e,s),s+=2;var x=0;for(1==p?(x=e[s],s++):(x=u.readUshort(e,s),s+=2),m=0;m<=x;m++)h.push(v),v++}}return h},r.CFF.readIndex=function(e,s,l){var u=r._bin,h=u.readUshort(e,s)+1,p=e[s+=2];if(s++,1==p)for(var m=0;m<h;m++)l.push(e[s+m]);else if(2==p)for(m=0;m<h;m++)l.push(u.readUshort(e,s+2*m));else if(3==p)for(m=0;m<h;m++)l.push(16777215&u.readUint(e,s+3*m-1));else if(1!=h)throw"unsupported offset size: "+p+", count: "+h;return(s+=h*p)-1},r.CFF.getCharString=function(e,s,l){var u=r._bin,h=e[s],p=e[s+1];e[s+2],e[s+3],e[s+4];var m=1,v=null,x=null;h<=20&&(v=h,m=1),12==h&&(v=100*h+p,m=2),21<=h&&h<=27&&(v=h,m=1),28==h&&(x=u.readShort(e,s+1),m=3),29<=h&&h<=31&&(v=h,m=1),32<=h&&h<=246&&(x=h-139,m=1),247<=h&&h<=250&&(x=256*(h-247)+p+108,m=2),251<=h&&h<=254&&(x=256*-(h-251)-p-108,m=2),255==h&&(x=u.readInt(e,s+1)/65535,m=5),l.val=null!=x?x:"o"+v,l.size=m},r.CFF.readCharString=function(e,s,l){for(var u=s+l,h=r._bin,p=[];s<u;){var m=e[s],v=e[s+1];e[s+2],e[s+3],e[s+4];var x=1,b=null,_=null;m<=20&&(b=m,x=1),12==m&&(b=100*m+v,x=2),19!=m&&20!=m||(b=m,x=2),21<=m&&m<=27&&(b=m,x=1),28==m&&(_=h.readShort(e,s+1),x=3),29<=m&&m<=31&&(b=m,x=1),32<=m&&m<=246&&(_=m-139,x=1),247<=m&&m<=250&&(_=256*(m-247)+v+108,x=2),251<=m&&m<=254&&(_=256*-(m-251)-v-108,x=2),255==m&&(_=h.readInt(e,s+1)/65535,x=5),p.push(null!=_?_:"o"+b),s+=x}return p},r.CFF.readDict=function(e,s,l){for(var u=r._bin,h={},p=[];s<l;){var m=e[s],v=e[s+1];e[s+2],e[s+3],e[s+4];var x=1,b=null,_=null;if(28==m&&(_=u.readShort(e,s+1),x=3),29==m&&(_=u.readInt(e,s+1),x=5),32<=m&&m<=246&&(_=m-139,x=1),247<=m&&m<=250&&(_=256*(m-247)+v+108,x=2),251<=m&&m<=254&&(_=256*-(m-251)-v-108,x=2),255==m)throw _=u.readInt(e,s+1)/65535,x=5,"unknown number";if(30==m){var S=[];for(x=1;;){var A=e[s+x];x++;var C=A>>4,R=15&A;if(15!=C&&S.push(C),15!=R&&S.push(R),15==R)break}for(var E="",I=[0,1,2,3,4,5,6,7,8,9,".","e","e-","reserved","-","endOfNumber"],F=0;F<S.length;F++)E+=I[S[F]];_=parseFloat(E)}m<=21&&(b=["version","Notice","FullName","FamilyName","Weight","FontBBox","BlueValues","OtherBlues","FamilyBlues","FamilyOtherBlues","StdHW","StdVW","escape","UniqueID","XUID","charset","Encoding","CharStrings","Private","Subrs","defaultWidthX","nominalWidthX"][m],x=1,12==m&&(b=["Copyright","isFixedPitch","ItalicAngle","UnderlinePosition","UnderlineThickness","PaintType","CharstringType","FontMatrix","StrokeWidth","BlueScale","BlueShift","BlueFuzz","StemSnapH","StemSnapV","ForceBold",0,0,"LanguageGroup","ExpansionFactor","initialRandomSeed","SyntheticBase","PostScript","BaseFontName","BaseFontBlend",0,0,0,0,0,0,"ROS","CIDFontVersion","CIDFontRevision","CIDFontType","CIDCount","UIDBase","FDArray","FDSelect","FontName"][v],x=2)),null!=b?(h[b]=1==p.length?p[0]:p,p=[]):p.push(_),s+=x}return h},r.cmap={},r.cmap.parse=function(e,s,l){e=new Uint8Array(e.buffer,s,l),s=0;var u=r._bin,h={};u.readUshort(e,s),s+=2;var p=u.readUshort(e,s);s+=2;var m=[];h.tables=[];for(var v=0;v<p;v++){var x=u.readUshort(e,s);s+=2;var b=u.readUshort(e,s);s+=2;var _=u.readUint(e,s);s+=4;var S="p"+x+"e"+b,A=m.indexOf(_);if(-1==A){var C;A=h.tables.length,m.push(_);var R=u.readUshort(e,_);0==R?C=r.cmap.parse0(e,_):4==R?C=r.cmap.parse4(e,_):6==R?C=r.cmap.parse6(e,_):12==R?C=r.cmap.parse12(e,_):console.debug("unknown format: "+R,x,b,_),h.tables.push(C)}if(null!=h[S])throw"multiple tables for one platform+encoding";h[S]=A}return h},r.cmap.parse0=function(e,s){var l=r._bin,u={};u.format=l.readUshort(e,s),s+=2;var h=l.readUshort(e,s);s+=2,l.readUshort(e,s),s+=2,u.map=[];for(var p=0;p<h-6;p++)u.map.push(e[s+p]);return u},r.cmap.parse4=function(e,s){var l=r._bin,u=s,h={};h.format=l.readUshort(e,s),s+=2;var p=l.readUshort(e,s);s+=2,l.readUshort(e,s),s+=2;var m=l.readUshort(e,s);s+=2;var v=m/2;h.searchRange=l.readUshort(e,s),s+=2,h.entrySelector=l.readUshort(e,s),s+=2,h.rangeShift=l.readUshort(e,s),s+=2,h.endCount=l.readUshorts(e,s,v),s+=2*v,s+=2,h.startCount=l.readUshorts(e,s,v),s+=2*v,h.idDelta=[];for(var x=0;x<v;x++)h.idDelta.push(l.readShort(e,s)),s+=2;for(h.idRangeOffset=l.readUshorts(e,s,v),s+=2*v,h.glyphIdArray=[];s<u+p;)h.glyphIdArray.push(l.readUshort(e,s)),s+=2;return h},r.cmap.parse6=function(e,s){var l=r._bin,u={};u.format=l.readUshort(e,s),s+=2,l.readUshort(e,s),s+=2,l.readUshort(e,s),s+=2,u.firstCode=l.readUshort(e,s),s+=2;var h=l.readUshort(e,s);s+=2,u.glyphIdArray=[];for(var p=0;p<h;p++)u.glyphIdArray.push(l.readUshort(e,s)),s+=2;return u},r.cmap.parse12=function(e,s){var l=r._bin,u={};u.format=l.readUshort(e,s),s+=2,s+=2,l.readUint(e,s),s+=4,l.readUint(e,s),s+=4;var h=l.readUint(e,s);s+=4,u.groups=[];for(var p=0;p<h;p++){var m=s+12*p,v=l.readUint(e,m+0),x=l.readUint(e,m+4),b=l.readUint(e,m+8);u.groups.push([v,x,b])}return u},r.glyf={},r.glyf.parse=function(e,r,s,l){for(var u=[],h=0;h<l.maxp.numGlyphs;h++)u.push(null);return u},r.glyf._parseGlyf=function(e,s){var l=r._bin,u=e._data,h=r._tabOffset(u,"glyf",e._offset)+e.loca[s];if(e.loca[s]==e.loca[s+1])return null;var p={};if(p.noc=l.readShort(u,h),h+=2,p.xMin=l.readShort(u,h),h+=2,p.yMin=l.readShort(u,h),h+=2,p.xMax=l.readShort(u,h),h+=2,p.yMax=l.readShort(u,h),h+=2,p.xMin>=p.xMax||p.yMin>=p.yMax)return null;if(p.noc>0){p.endPts=[];for(var m=0;m<p.noc;m++)p.endPts.push(l.readUshort(u,h)),h+=2;var v=l.readUshort(u,h);if(h+=2,u.length-h<v)return null;p.instructions=l.readBytes(u,h,v),h+=v;var x=p.endPts[p.noc-1]+1;for(p.flags=[],m=0;m<x;m++){var b=u[h];if(h++,p.flags.push(b),0!=(8&b)){var _=u[h];h++;for(var S=0;S<_;S++)p.flags.push(b),m++}}for(p.xs=[],m=0;m<x;m++){var A=0!=(2&p.flags[m]),C=0!=(16&p.flags[m]);A?(p.xs.push(C?u[h]:-u[h]),h++):C?p.xs.push(0):(p.xs.push(l.readShort(u,h)),h+=2)}for(p.ys=[],m=0;m<x;m++)A=0!=(4&p.flags[m]),C=0!=(32&p.flags[m]),A?(p.ys.push(C?u[h]:-u[h]),h++):C?p.ys.push(0):(p.ys.push(l.readShort(u,h)),h+=2);var R=0,E=0;for(m=0;m<x;m++)R+=p.xs[m],E+=p.ys[m],p.xs[m]=R,p.ys[m]=E}else{var I;p.parts=[];do{I=l.readUshort(u,h),h+=2;var F={m:{a:1,b:0,c:0,d:1,tx:0,ty:0},p1:-1,p2:-1};if(p.parts.push(F),F.glyphIndex=l.readUshort(u,h),h+=2,1&I){var D=l.readShort(u,h);h+=2;var G=l.readShort(u,h);h+=2}else D=l.readInt8(u,h),h++,G=l.readInt8(u,h),h++;2&I?(F.m.tx=D,F.m.ty=G):(F.p1=D,F.p2=G),8&I?(F.m.a=F.m.d=l.readF2dot14(u,h),h+=2):64&I?(F.m.a=l.readF2dot14(u,h),h+=2,F.m.d=l.readF2dot14(u,h),h+=2):128&I&&(F.m.a=l.readF2dot14(u,h),h+=2,F.m.b=l.readF2dot14(u,h),h+=2,F.m.c=l.readF2dot14(u,h),h+=2,F.m.d=l.readF2dot14(u,h),h+=2)}while(32&I);if(256&I){var B=l.readUshort(u,h);for(h+=2,p.instr=[],m=0;m<B;m++)p.instr.push(u[h]),h++}}return p},r.GDEF={},r.GDEF.parse=function(e,s,l,u){var h=s;s+=4;var p=r._bin.readUshort(e,s);return{glyphClassDef:0===p?null:r._lctf.readClassDef(e,h+p)}},r.GPOS={},r.GPOS.parse=function(e,s,l,u){return r._lctf.parse(e,s,l,u,r.GPOS.subt)},r.GPOS.subt=function(e,s,l,u){var h=r._bin,p=l,m={};if(m.fmt=h.readUshort(e,l),l+=2,1==s||2==s||3==s||7==s||8==s&&m.fmt<=2){var v=h.readUshort(e,l);l+=2,m.coverage=r._lctf.readCoverage(e,v+p)}if(1==s&&1==m.fmt){var x=h.readUshort(e,l);l+=2,0!=x&&(m.pos=r.GPOS.readValueRecord(e,l,x))}else if(2==s&&m.fmt>=1&&m.fmt<=2){x=h.readUshort(e,l),l+=2;var b=h.readUshort(e,l);l+=2;var _=r._lctf.numOfOnes(x),S=r._lctf.numOfOnes(b);if(1==m.fmt){m.pairsets=[];var A=h.readUshort(e,l);l+=2;for(var C=0;C<A;C++){var R=p+h.readUshort(e,l);l+=2;var E=h.readUshort(e,R);R+=2;for(var I=[],F=0;F<E;F++){var D=h.readUshort(e,R);R+=2,0!=x&&(X=r.GPOS.readValueRecord(e,R,x),R+=2*_),0!=b&&(W=r.GPOS.readValueRecord(e,R,b),R+=2*S),I.push({gid2:D,val1:X,val2:W})}m.pairsets.push(I)}}if(2==m.fmt){var G=h.readUshort(e,l);l+=2;var B=h.readUshort(e,l);l+=2;var N=h.readUshort(e,l);l+=2;var j=h.readUshort(e,l);for(l+=2,m.classDef1=r._lctf.readClassDef(e,p+G),m.classDef2=r._lctf.readClassDef(e,p+B),m.matrix=[],C=0;C<N;C++){var H=[];for(F=0;F<j;F++){var X=null,W=null;0!=x&&(X=r.GPOS.readValueRecord(e,l,x),l+=2*_),0!=b&&(W=r.GPOS.readValueRecord(e,l,b),l+=2*S),H.push({val1:X,val2:W})}m.matrix.push(H)}}}else if(4==s&&1==m.fmt)m.markCoverage=r._lctf.readCoverage(e,h.readUshort(e,l)+p),m.baseCoverage=r._lctf.readCoverage(e,h.readUshort(e,l+2)+p),m.markClassCount=h.readUshort(e,l+4),m.markArray=r.GPOS.readMarkArray(e,h.readUshort(e,l+6)+p),m.baseArray=r.GPOS.readBaseArray(e,h.readUshort(e,l+8)+p,m.markClassCount);else if(6==s&&1==m.fmt)m.mark1Coverage=r._lctf.readCoverage(e,h.readUshort(e,l)+p),m.mark2Coverage=r._lctf.readCoverage(e,h.readUshort(e,l+2)+p),m.markClassCount=h.readUshort(e,l+4),m.mark1Array=r.GPOS.readMarkArray(e,h.readUshort(e,l+6)+p),m.mark2Array=r.GPOS.readBaseArray(e,h.readUshort(e,l+8)+p,m.markClassCount);else{if(9==s&&1==m.fmt){var z=h.readUshort(e,l);l+=2;var V=h.readUint(e,l);if(l+=4,9==u.ltype)u.ltype=z;else if(u.ltype!=z)throw"invalid extension substitution";return r.GPOS.subt(e,u.ltype,p+V)}console.debug("unsupported GPOS table LookupType",s,"format",m.fmt)}return m},r.GPOS.readValueRecord=function(e,s,l){var u=r._bin,h=[];return h.push(1&l?u.readShort(e,s):0),s+=1&l?2:0,h.push(2&l?u.readShort(e,s):0),s+=2&l?2:0,h.push(4&l?u.readShort(e,s):0),s+=4&l?2:0,h.push(8&l?u.readShort(e,s):0),s+=8&l?2:0,h},r.GPOS.readBaseArray=function(e,s,l){var u=r._bin,h=[],p=s,m=u.readUshort(e,s);s+=2;for(var v=0;v<m;v++){for(var x=[],b=0;b<l;b++)x.push(r.GPOS.readAnchorRecord(e,p+u.readUshort(e,s))),s+=2;h.push(x)}return h},r.GPOS.readMarkArray=function(e,s){var l=r._bin,u=[],h=s,p=l.readUshort(e,s);s+=2;for(var m=0;m<p;m++){var v=r.GPOS.readAnchorRecord(e,l.readUshort(e,s+2)+h);v.markClass=l.readUshort(e,s),u.push(v),s+=4}return u},r.GPOS.readAnchorRecord=function(e,s){var l=r._bin,u={};return u.fmt=l.readUshort(e,s),u.x=l.readShort(e,s+2),u.y=l.readShort(e,s+4),u},r.GSUB={},r.GSUB.parse=function(e,s,l,u){return r._lctf.parse(e,s,l,u,r.GSUB.subt)},r.GSUB.subt=function(e,s,l,u){var h=r._bin,p=l,m={};if(m.fmt=h.readUshort(e,l),l+=2,1!=s&&2!=s&&4!=s&&5!=s&&6!=s)return null;if(1==s||2==s||4==s||5==s&&m.fmt<=2||6==s&&m.fmt<=2){var v=h.readUshort(e,l);l+=2,m.coverage=r._lctf.readCoverage(e,p+v)}if(1==s&&m.fmt>=1&&m.fmt<=2){if(1==m.fmt)m.delta=h.readShort(e,l),l+=2;else if(2==m.fmt){var x=h.readUshort(e,l);l+=2,m.newg=h.readUshorts(e,l,x),l+=2*m.newg.length}}else if(2==s&&1==m.fmt){x=h.readUshort(e,l),l+=2,m.seqs=[];for(var b=0;b<x;b++){var _=h.readUshort(e,l)+p;l+=2;var S=h.readUshort(e,_);m.seqs.push(h.readUshorts(e,_+2,S))}}else if(4==s)for(m.vals=[],x=h.readUshort(e,l),l+=2,b=0;b<x;b++){var A=h.readUshort(e,l);l+=2,m.vals.push(r.GSUB.readLigatureSet(e,p+A))}else if(5==s&&2==m.fmt){if(2==m.fmt){var C=h.readUshort(e,l);l+=2,m.cDef=r._lctf.readClassDef(e,p+C),m.scset=[];var R=h.readUshort(e,l);for(l+=2,b=0;b<R;b++){var E=h.readUshort(e,l);l+=2,m.scset.push(0==E?null:r.GSUB.readSubClassSet(e,p+E))}}}else if(6==s&&3==m.fmt){if(3==m.fmt){for(b=0;b<3;b++){x=h.readUshort(e,l),l+=2;for(var I=[],F=0;F<x;F++)I.push(r._lctf.readCoverage(e,p+h.readUshort(e,l+2*F)));l+=2*x,0==b&&(m.backCvg=I),1==b&&(m.inptCvg=I),2==b&&(m.ahedCvg=I)}x=h.readUshort(e,l),l+=2,m.lookupRec=r.GSUB.readSubstLookupRecords(e,l,x)}}else{if(7==s&&1==m.fmt){var D=h.readUshort(e,l);l+=2;var G=h.readUint(e,l);if(l+=4,9==u.ltype)u.ltype=D;else if(u.ltype!=D)throw"invalid extension substitution";return r.GSUB.subt(e,u.ltype,p+G)}console.debug("unsupported GSUB table LookupType",s,"format",m.fmt)}return m},r.GSUB.readSubClassSet=function(e,s){var l=r._bin.readUshort,u=s,h=[],p=l(e,s);s+=2;for(var m=0;m<p;m++){var v=l(e,s);s+=2,h.push(r.GSUB.readSubClassRule(e,u+v))}return h},r.GSUB.readSubClassRule=function(e,s){var l=r._bin.readUshort,u={},h=l(e,s),p=l(e,s+=2);s+=2,u.input=[];for(var m=0;m<h-1;m++)u.input.push(l(e,s)),s+=2;return u.substLookupRecords=r.GSUB.readSubstLookupRecords(e,s,p),u},r.GSUB.readSubstLookupRecords=function(e,s,l){for(var u=r._bin.readUshort,h=[],p=0;p<l;p++)h.push(u(e,s),u(e,s+2)),s+=4;return h},r.GSUB.readChainSubClassSet=function(e,s){var l=r._bin,u=s,h=[],p=l.readUshort(e,s);s+=2;for(var m=0;m<p;m++){var v=l.readUshort(e,s);s+=2,h.push(r.GSUB.readChainSubClassRule(e,u+v))}return h},r.GSUB.readChainSubClassRule=function(e,s){for(var l=r._bin,u={},h=["backtrack","input","lookahead"],p=0;p<h.length;p++){var m=l.readUshort(e,s);s+=2,1==p&&m--,u[h[p]]=l.readUshorts(e,s,m),s+=2*u[h[p]].length}return m=l.readUshort(e,s),s+=2,u.subst=l.readUshorts(e,s,2*m),s+=2*u.subst.length,u},r.GSUB.readLigatureSet=function(e,s){var l=r._bin,u=s,h=[],p=l.readUshort(e,s);s+=2;for(var m=0;m<p;m++){var v=l.readUshort(e,s);s+=2,h.push(r.GSUB.readLigature(e,u+v))}return h},r.GSUB.readLigature=function(e,s){var l=r._bin,u={chain:[]};u.nglyph=l.readUshort(e,s),s+=2;var h=l.readUshort(e,s);s+=2;for(var p=0;p<h-1;p++)u.chain.push(l.readUshort(e,s)),s+=2;return u},r.head={},r.head.parse=function(e,s,l){var u=r._bin,h={};return u.readFixed(e,s),s+=4,h.fontRevision=u.readFixed(e,s),s+=4,u.readUint(e,s),s+=4,u.readUint(e,s),s+=4,h.flags=u.readUshort(e,s),s+=2,h.unitsPerEm=u.readUshort(e,s),s+=2,h.created=u.readUint64(e,s),s+=8,h.modified=u.readUint64(e,s),s+=8,h.xMin=u.readShort(e,s),s+=2,h.yMin=u.readShort(e,s),s+=2,h.xMax=u.readShort(e,s),s+=2,h.yMax=u.readShort(e,s),s+=2,h.macStyle=u.readUshort(e,s),s+=2,h.lowestRecPPEM=u.readUshort(e,s),s+=2,h.fontDirectionHint=u.readShort(e,s),s+=2,h.indexToLocFormat=u.readShort(e,s),s+=2,h.glyphDataFormat=u.readShort(e,s),s+=2,h},r.hhea={},r.hhea.parse=function(e,s,l){var u=r._bin,h={};return u.readFixed(e,s),s+=4,h.ascender=u.readShort(e,s),s+=2,h.descender=u.readShort(e,s),s+=2,h.lineGap=u.readShort(e,s),s+=2,h.advanceWidthMax=u.readUshort(e,s),s+=2,h.minLeftSideBearing=u.readShort(e,s),s+=2,h.minRightSideBearing=u.readShort(e,s),s+=2,h.xMaxExtent=u.readShort(e,s),s+=2,h.caretSlopeRise=u.readShort(e,s),s+=2,h.caretSlopeRun=u.readShort(e,s),s+=2,h.caretOffset=u.readShort(e,s),s+=2,s+=8,h.metricDataFormat=u.readShort(e,s),s+=2,h.numberOfHMetrics=u.readUshort(e,s),s+=2,h},r.hmtx={},r.hmtx.parse=function(e,s,l,u){for(var h=r._bin,p={aWidth:[],lsBearing:[]},m=0,v=0,x=0;x<u.maxp.numGlyphs;x++)x<u.hhea.numberOfHMetrics&&(m=h.readUshort(e,s),s+=2,v=h.readShort(e,s),s+=2),p.aWidth.push(m),p.lsBearing.push(v);return p},r.kern={},r.kern.parse=function(e,s,l,u){var h=r._bin,p=h.readUshort(e,s);if(s+=2,1==p)return r.kern.parseV1(e,s-2,l,u);var m=h.readUshort(e,s);s+=2;for(var v={glyph1:[],rval:[]},x=0;x<m;x++){s+=2,l=h.readUshort(e,s),s+=2;var b=h.readUshort(e,s);s+=2;var _=b>>>8;if(0!=(_&=15))throw"unknown kern table format: "+_;s=r.kern.readFormat0(e,s,v)}return v},r.kern.parseV1=function(e,s,l,u){var h=r._bin;h.readFixed(e,s),s+=4;var p=h.readUint(e,s);s+=4;for(var m={glyph1:[],rval:[]},v=0;v<p;v++){h.readUint(e,s),s+=4;var x=h.readUshort(e,s);s+=2,h.readUshort(e,s),s+=2;var b=x>>>8;if(0!=(b&=15))throw"unknown kern table format: "+b;s=r.kern.readFormat0(e,s,m)}return m},r.kern.readFormat0=function(e,s,l){var u=r._bin,h=-1,p=u.readUshort(e,s);s+=2,u.readUshort(e,s),s+=2,u.readUshort(e,s),s+=2,u.readUshort(e,s),s+=2;for(var m=0;m<p;m++){var v=u.readUshort(e,s);s+=2;var x=u.readUshort(e,s);s+=2;var b=u.readShort(e,s);s+=2,v!=h&&(l.glyph1.push(v),l.rval.push({glyph2:[],vals:[]}));var _=l.rval[l.rval.length-1];_.glyph2.push(x),_.vals.push(b),h=v}return s},r.loca={},r.loca.parse=function(e,s,l,u){var h=r._bin,p=[],m=u.head.indexToLocFormat,v=u.maxp.numGlyphs+1;if(0==m)for(var x=0;x<v;x++)p.push(h.readUshort(e,s+(x<<1))<<1);if(1==m)for(x=0;x<v;x++)p.push(h.readUint(e,s+(x<<2)));return p},r.maxp={},r.maxp.parse=function(e,s,l){var u=r._bin,h={},p=u.readUint(e,s);return s+=4,h.numGlyphs=u.readUshort(e,s),s+=2,65536==p&&(h.maxPoints=u.readUshort(e,s),s+=2,h.maxContours=u.readUshort(e,s),s+=2,h.maxCompositePoints=u.readUshort(e,s),s+=2,h.maxCompositeContours=u.readUshort(e,s),s+=2,h.maxZones=u.readUshort(e,s),s+=2,h.maxTwilightPoints=u.readUshort(e,s),s+=2,h.maxStorage=u.readUshort(e,s),s+=2,h.maxFunctionDefs=u.readUshort(e,s),s+=2,h.maxInstructionDefs=u.readUshort(e,s),s+=2,h.maxStackElements=u.readUshort(e,s),s+=2,h.maxSizeOfInstructions=u.readUshort(e,s),s+=2,h.maxComponentElements=u.readUshort(e,s),s+=2,h.maxComponentDepth=u.readUshort(e,s),s+=2),h},r.name={},r.name.parse=function(e,s,l){var u=r._bin,h={};u.readUshort(e,s),s+=2;var p=u.readUshort(e,s);s+=2,u.readUshort(e,s);for(var m,v=["copyright","fontFamily","fontSubfamily","ID","fullName","version","postScriptName","trademark","manufacturer","designer","description","urlVendor","urlDesigner","licence","licenceURL","---","typoFamilyName","typoSubfamilyName","compatibleFull","sampleText","postScriptCID","wwsFamilyName","wwsSubfamilyName","lightPalette","darkPalette"],x=s+=2,b=0;b<p;b++){var _=u.readUshort(e,s);s+=2;var S=u.readUshort(e,s);s+=2;var A=u.readUshort(e,s);s+=2;var C=u.readUshort(e,s);s+=2;var R=u.readUshort(e,s);s+=2;var E=u.readUshort(e,s);s+=2;var I,F=v[C],D=x+12*p+E;if(0==_)I=u.readUnicode(e,D,R/2);else if(3==_&&0==S)I=u.readUnicode(e,D,R/2);else if(0==S)I=u.readASCII(e,D,R);else if(1==S)I=u.readUnicode(e,D,R/2);else if(3==S)I=u.readUnicode(e,D,R/2);else{if(1!=_)throw"unknown encoding "+S+", platformID: "+_;I=u.readASCII(e,D,R),console.debug("reading unknown MAC encoding "+S+" as ASCII")}var G="p"+_+","+A.toString(16);null==h[G]&&(h[G]={}),h[G][void 0!==F?F:C]=I,h[G]._lang=A}for(var B in h)if(null!=h[B].postScriptName&&1033==h[B]._lang)return h[B];for(var B in h)if(null!=h[B].postScriptName&&0==h[B]._lang)return h[B];for(var B in h)if(null!=h[B].postScriptName&&3084==h[B]._lang)return h[B];for(var B in h)if(null!=h[B].postScriptName)return h[B];for(var B in h){m=B;break}return console.debug("returning name table with languageID "+h[m]._lang),h[m]},r["OS/2"]={},r["OS/2"].parse=function(e,s,l){var u=r._bin.readUshort(e,s);s+=2;var h={};if(0==u)r["OS/2"].version0(e,s,h);else if(1==u)r["OS/2"].version1(e,s,h);else if(2==u||3==u||4==u)r["OS/2"].version2(e,s,h);else{if(5!=u)throw"unknown OS/2 table version: "+u;r["OS/2"].version5(e,s,h)}return h},r["OS/2"].version0=function(e,s,l){var u=r._bin;return l.xAvgCharWidth=u.readShort(e,s),s+=2,l.usWeightClass=u.readUshort(e,s),s+=2,l.usWidthClass=u.readUshort(e,s),s+=2,l.fsType=u.readUshort(e,s),s+=2,l.ySubscriptXSize=u.readShort(e,s),s+=2,l.ySubscriptYSize=u.readShort(e,s),s+=2,l.ySubscriptXOffset=u.readShort(e,s),s+=2,l.ySubscriptYOffset=u.readShort(e,s),s+=2,l.ySuperscriptXSize=u.readShort(e,s),s+=2,l.ySuperscriptYSize=u.readShort(e,s),s+=2,l.ySuperscriptXOffset=u.readShort(e,s),s+=2,l.ySuperscriptYOffset=u.readShort(e,s),s+=2,l.yStrikeoutSize=u.readShort(e,s),s+=2,l.yStrikeoutPosition=u.readShort(e,s),s+=2,l.sFamilyClass=u.readShort(e,s),s+=2,l.panose=u.readBytes(e,s,10),s+=10,l.ulUnicodeRange1=u.readUint(e,s),s+=4,l.ulUnicodeRange2=u.readUint(e,s),s+=4,l.ulUnicodeRange3=u.readUint(e,s),s+=4,l.ulUnicodeRange4=u.readUint(e,s),s+=4,l.achVendID=[u.readInt8(e,s),u.readInt8(e,s+1),u.readInt8(e,s+2),u.readInt8(e,s+3)],s+=4,l.fsSelection=u.readUshort(e,s),s+=2,l.usFirstCharIndex=u.readUshort(e,s),s+=2,l.usLastCharIndex=u.readUshort(e,s),s+=2,l.sTypoAscender=u.readShort(e,s),s+=2,l.sTypoDescender=u.readShort(e,s),s+=2,l.sTypoLineGap=u.readShort(e,s),s+=2,l.usWinAscent=u.readUshort(e,s),s+=2,l.usWinDescent=u.readUshort(e,s),s+2},r["OS/2"].version1=function(e,s,l){var u=r._bin;return s=r["OS/2"].version0(e,s,l),l.ulCodePageRange1=u.readUint(e,s),s+=4,l.ulCodePageRange2=u.readUint(e,s),s+4},r["OS/2"].version2=function(e,s,l){var u=r._bin;return s=r["OS/2"].version1(e,s,l),l.sxHeight=u.readShort(e,s),s+=2,l.sCapHeight=u.readShort(e,s),s+=2,l.usDefault=u.readUshort(e,s),s+=2,l.usBreak=u.readUshort(e,s),s+=2,l.usMaxContext=u.readUshort(e,s),s+2},r["OS/2"].version5=function(e,s,l){var u=r._bin;return s=r["OS/2"].version2(e,s,l),l.usLowerOpticalPointSize=u.readUshort(e,s),s+=2,l.usUpperOpticalPointSize=u.readUshort(e,s),s+2},r.post={},r.post.parse=function(e,s,l){var u=r._bin,h={};return h.version=u.readFixed(e,s),s+=4,h.italicAngle=u.readFixed(e,s),s+=4,h.underlinePosition=u.readShort(e,s),s+=2,h.underlineThickness=u.readShort(e,s),s+=2,h},null==r&&(r={}),null==r.U&&(r.U={}),r.U.codeToGlyph=function(e,r){var s=e.cmap,l=-1;if(null!=s.p0e4?l=s.p0e4:null!=s.p3e1?l=s.p3e1:null!=s.p1e0?l=s.p1e0:null!=s.p0e3&&(l=s.p0e3),-1==l)throw"no familiar platform and encoding!";var u=s.tables[l];if(0==u.format)return r>=u.map.length?0:u.map[r];if(4==u.format){for(var h=-1,p=0;p<u.endCount.length;p++)if(r<=u.endCount[p]){h=p;break}return-1==h||u.startCount[h]>r?0:65535&(0!=u.idRangeOffset[h]?u.glyphIdArray[r-u.startCount[h]+(u.idRangeOffset[h]>>1)-(u.idRangeOffset.length-h)]:r+u.idDelta[h])}if(12==u.format){if(r>u.groups[u.groups.length-1][1])return 0;for(p=0;p<u.groups.length;p++){var m=u.groups[p];if(m[0]<=r&&r<=m[1])return m[2]+(r-m[0])}return 0}throw"unknown cmap table format "+u.format},r.U.glyphToPath=function(e,s){var l={cmds:[],crds:[]};if(e.SVG&&e.SVG.entries[s]){var u=e.SVG.entries[s];return null==u?l:("string"==typeof u&&(u=r.SVG.toPath(u),e.SVG.entries[s]=u),u)}if(e.CFF){var h={x:0,y:0,stack:[],nStems:0,haveWidth:!1,width:e.CFF.Private?e.CFF.Private.defaultWidthX:0,open:!1},p=e.CFF,m=e.CFF.Private;if(p.ROS){for(var v=0;p.FDSelect[v+2]<=s;)v+=2;m=p.FDArray[p.FDSelect[v+1]].Private}r.U._drawCFF(e.CFF.CharStrings[s],h,p,m,l)}else e.glyf&&r.U._drawGlyf(s,e,l);return l},r.U._drawGlyf=function(e,s,l){var u=s.glyf[e];null==u&&(u=s.glyf[e]=r.glyf._parseGlyf(s,e)),null!=u&&(u.noc>-1?r.U._simpleGlyph(u,l):r.U._compoGlyph(u,s,l))},r.U._simpleGlyph=function(e,s){for(var l=0;l<e.noc;l++){for(var u=0==l?0:e.endPts[l-1]+1,h=e.endPts[l],p=u;p<=h;p++){var m=p==u?h:p-1,v=p==h?u:p+1,x=1&e.flags[p],b=1&e.flags[m],_=1&e.flags[v],S=e.xs[p],A=e.ys[p];if(p==u)if(x){if(!b){r.U.P.moveTo(s,S,A);continue}r.U.P.moveTo(s,e.xs[m],e.ys[m])}else b?r.U.P.moveTo(s,e.xs[m],e.ys[m]):r.U.P.moveTo(s,(e.xs[m]+S)/2,(e.ys[m]+A)/2);x?b&&r.U.P.lineTo(s,S,A):_?r.U.P.qcurveTo(s,S,A,e.xs[v],e.ys[v]):r.U.P.qcurveTo(s,S,A,(S+e.xs[v])/2,(A+e.ys[v])/2)}r.U.P.closePath(s)}},r.U._compoGlyph=function(e,s,l){for(var u=0;u<e.parts.length;u++){var h={cmds:[],crds:[]},p=e.parts[u];r.U._drawGlyf(p.glyphIndex,s,h);for(var m=p.m,v=0;v<h.crds.length;v+=2){var x=h.crds[v],b=h.crds[v+1];l.crds.push(x*m.a+b*m.b+m.tx),l.crds.push(x*m.c+b*m.d+m.ty)}for(v=0;v<h.cmds.length;v++)l.cmds.push(h.cmds[v])}},r.U._getGlyphClass=function(e,s){var l=r._lctf.getInterval(s,e);return-1==l?0:s[l+2]},r.U._applySubs=function(e,s,l,u){for(var h=e.length-s-1,p=0;p<l.tabs.length;p++)if(null!=l.tabs[p]){var m,v=l.tabs[p];if(!v.coverage||-1!=(m=r._lctf.coverageIndex(v.coverage,e[s])))if(1==l.ltype)e[s],1==v.fmt?e[s]=e[s]+v.delta:e[s]=v.newg[m];else if(4==l.ltype)for(var x=v.vals[m],b=0;b<x.length;b++){var _=x[b],S=_.chain.length;if(!(S>h)){for(var A=!0,C=0,R=0;R<S;R++){for(;-1==e[s+C+(1+R)];)C++;_.chain[R]!=e[s+C+(1+R)]&&(A=!1)}if(A){for(e[s]=_.nglyph,R=0;R<S+C;R++)e[s+R+1]=-1;break}}}else if(5==l.ltype&&2==v.fmt)for(var E=r._lctf.getInterval(v.cDef,e[s]),I=v.cDef[E+2],F=v.scset[I],D=0;D<F.length;D++){var G=F[D],B=G.input;if(!(B.length>h)){for(A=!0,R=0;R<B.length;R++){var N=r._lctf.getInterval(v.cDef,e[s+1+R]);if(-1==E&&v.cDef[N+2]!=B[R]){A=!1;break}}if(A){var j=G.substLookupRecords;for(b=0;b<j.length;b+=2)j[b],j[b+1]}}}else if(6==l.ltype&&3==v.fmt){if(!r.U._glsCovered(e,v.backCvg,s-v.backCvg.length))continue;if(!r.U._glsCovered(e,v.inptCvg,s))continue;if(!r.U._glsCovered(e,v.ahedCvg,s+v.inptCvg.length))continue;var H=v.lookupRec;for(D=0;D<H.length;D+=2){E=H[D];var X=u[H[D+1]];r.U._applySubs(e,s+E,X,u)}}}},r.U._glsCovered=function(e,s,l){for(var u=0;u<s.length;u++)if(-1==r._lctf.coverageIndex(s[u],e[l+u]))return!1;return!0},r.U.glyphsToPath=function(e,s,l){for(var u={cmds:[],crds:[]},h=0,p=0;p<s.length;p++){var m=s[p];if(-1!=m){for(var v=p<s.length-1&&-1!=s[p+1]?s[p+1]:0,x=r.U.glyphToPath(e,m),b=0;b<x.crds.length;b+=2)u.crds.push(x.crds[b]+h),u.crds.push(x.crds[b+1]);for(l&&u.cmds.push(l),b=0;b<x.cmds.length;b++)u.cmds.push(x.cmds[b]);l&&u.cmds.push("X"),h+=e.hmtx.aWidth[m],p<s.length-1&&(h+=r.U.getPairAdjustment(e,m,v))}}return u},r.U.P={},r.U.P.moveTo=function(e,r,s){e.cmds.push("M"),e.crds.push(r,s)},r.U.P.lineTo=function(e,r,s){e.cmds.push("L"),e.crds.push(r,s)},r.U.P.curveTo=function(e,r,s,l,u,h,p){e.cmds.push("C"),e.crds.push(r,s,l,u,h,p)},r.U.P.qcurveTo=function(e,r,s,l,u){e.cmds.push("Q"),e.crds.push(r,s,l,u)},r.U.P.closePath=function(e){e.cmds.push("Z")},r.U._drawCFF=function(e,s,l,u,h){for(var p=s.stack,m=s.nStems,v=s.haveWidth,x=s.width,b=s.open,_=0,S=s.x,A=s.y,C=0,R=0,E=0,I=0,F=0,D=0,G=0,B=0,N=0,j=0,H={val:0,size:0};_<e.length;){r.CFF.getCharString(e,_,H);var X=H.val;if(_+=H.size,"o1"==X||"o18"==X)p.length%2!=0&&!v&&(x=p.shift()+u.nominalWidthX),m+=p.length>>1,p.length=0,v=!0;else if("o3"==X||"o23"==X)p.length%2!=0&&!v&&(x=p.shift()+u.nominalWidthX),m+=p.length>>1,p.length=0,v=!0;else if("o4"==X)p.length>1&&!v&&(x=p.shift()+u.nominalWidthX,v=!0),b&&r.U.P.closePath(h),A+=p.pop(),r.U.P.moveTo(h,S,A),b=!0;else if("o5"==X)for(;p.length>0;)S+=p.shift(),A+=p.shift(),r.U.P.lineTo(h,S,A);else if("o6"==X||"o7"==X)for(var W=p.length,z="o6"==X,V=0;V<W;V++){var q=p.shift();z?S+=q:A+=q,z=!z,r.U.P.lineTo(h,S,A)}else if("o8"==X||"o24"==X){W=p.length;for(var $=0;$+6<=W;)C=S+p.shift(),R=A+p.shift(),E=C+p.shift(),I=R+p.shift(),S=E+p.shift(),A=I+p.shift(),r.U.P.curveTo(h,C,R,E,I,S,A),$+=6;"o24"==X&&(S+=p.shift(),A+=p.shift(),r.U.P.lineTo(h,S,A))}else{if("o11"==X)break;if("o1234"==X||"o1235"==X||"o1236"==X||"o1237"==X)"o1234"==X&&(R=A,E=(C=S+p.shift())+p.shift(),j=I=R+p.shift(),D=I,B=A,S=(G=(F=(N=E+p.shift())+p.shift())+p.shift())+p.shift(),r.U.P.curveTo(h,C,R,E,I,N,j),r.U.P.curveTo(h,F,D,G,B,S,A)),"o1235"==X&&(C=S+p.shift(),R=A+p.shift(),E=C+p.shift(),I=R+p.shift(),N=E+p.shift(),j=I+p.shift(),F=N+p.shift(),D=j+p.shift(),G=F+p.shift(),B=D+p.shift(),S=G+p.shift(),A=B+p.shift(),p.shift(),r.U.P.curveTo(h,C,R,E,I,N,j),r.U.P.curveTo(h,F,D,G,B,S,A)),"o1236"==X&&(C=S+p.shift(),R=A+p.shift(),E=C+p.shift(),j=I=R+p.shift(),D=I,G=(F=(N=E+p.shift())+p.shift())+p.shift(),B=D+p.shift(),S=G+p.shift(),r.U.P.curveTo(h,C,R,E,I,N,j),r.U.P.curveTo(h,F,D,G,B,S,A)),"o1237"==X&&(C=S+p.shift(),R=A+p.shift(),E=C+p.shift(),I=R+p.shift(),N=E+p.shift(),j=I+p.shift(),F=N+p.shift(),D=j+p.shift(),G=F+p.shift(),B=D+p.shift(),Math.abs(G-S)>Math.abs(B-A)?S=G+p.shift():A=B+p.shift(),r.U.P.curveTo(h,C,R,E,I,N,j),r.U.P.curveTo(h,F,D,G,B,S,A));else if("o14"==X){if(p.length>0&&!v&&(x=p.shift()+l.nominalWidthX,v=!0),4==p.length){var K=p.shift(),Y=p.shift(),J=p.shift(),Q=p.shift(),Z=r.CFF.glyphBySE(l,J),ee=r.CFF.glyphBySE(l,Q);r.U._drawCFF(l.CharStrings[Z],s,l,u,h),s.x=K,s.y=Y,r.U._drawCFF(l.CharStrings[ee],s,l,u,h)}b&&(r.U.P.closePath(h),b=!1)}else if("o19"==X||"o20"==X)p.length%2!=0&&!v&&(x=p.shift()+u.nominalWidthX),m+=p.length>>1,p.length=0,v=!0,_+=m+7>>3;else if("o21"==X)p.length>2&&!v&&(x=p.shift()+u.nominalWidthX,v=!0),A+=p.pop(),S+=p.pop(),b&&r.U.P.closePath(h),r.U.P.moveTo(h,S,A),b=!0;else if("o22"==X)p.length>1&&!v&&(x=p.shift()+u.nominalWidthX,v=!0),S+=p.pop(),b&&r.U.P.closePath(h),r.U.P.moveTo(h,S,A),b=!0;else if("o25"==X){for(;p.length>6;)S+=p.shift(),A+=p.shift(),r.U.P.lineTo(h,S,A);C=S+p.shift(),R=A+p.shift(),E=C+p.shift(),I=R+p.shift(),S=E+p.shift(),A=I+p.shift(),r.U.P.curveTo(h,C,R,E,I,S,A)}else if("o26"==X)for(p.length%2&&(S+=p.shift());p.length>0;)C=S,R=A+p.shift(),S=E=C+p.shift(),A=(I=R+p.shift())+p.shift(),r.U.P.curveTo(h,C,R,E,I,S,A);else if("o27"==X)for(p.length%2&&(A+=p.shift());p.length>0;)R=A,E=(C=S+p.shift())+p.shift(),I=R+p.shift(),S=E+p.shift(),A=I,r.U.P.curveTo(h,C,R,E,I,S,A);else if("o10"==X||"o29"==X){var te="o10"==X?u:l;if(0==p.length)console.debug("error: empty stack");else{var re=p.pop(),ne=te.Subrs[re+te.Bias];s.x=S,s.y=A,s.nStems=m,s.haveWidth=v,s.width=x,s.open=b,r.U._drawCFF(ne,s,l,u,h),S=s.x,A=s.y,m=s.nStems,v=s.haveWidth,x=s.width,b=s.open}}else if("o30"==X||"o31"==X){var se=p.length,oe=($=0,"o31"==X);for($+=se-(W=-3&se);$<W;)oe?(R=A,E=(C=S+p.shift())+p.shift(),A=(I=R+p.shift())+p.shift(),W-$==5?(S=E+p.shift(),$++):S=E,oe=!1):(C=S,R=A+p.shift(),E=C+p.shift(),I=R+p.shift(),S=E+p.shift(),W-$==5?(A=I+p.shift(),$++):A=I,oe=!0),r.U.P.curveTo(h,C,R,E,I,S,A),$+=4}else{if("o"==(X+"").charAt(0))throw console.debug("Unknown operation: "+X,e),X;p.push(X)}}}s.x=S,s.y=A,s.nStems=m,s.haveWidth=v,s.width=x,s.open=b};var s=r,l={Typr:s};return e.Typr=s,e.default=l,Object.defineProperty(e,"__esModule",{value:!0}),e}({}).Typr}
/*!
Custom bundle of woff2otf (https://github.com/arty-name/woff2otf) with fflate
(https://github.com/101arrowz/fflate) for use in Troika text rendering. 
Original licenses apply: 
- fflate: https://github.com/101arrowz/fflate/blob/master/LICENSE (MIT)
- woff2otf.js: https://github.com/arty-name/woff2otf/blob/master/woff2otf.js (Apache2)
*/,function(){return function(e){var r=Uint8Array,s=Uint16Array,l=Uint32Array,u=new r([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),h=new r([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),p=new r([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),f=function(e,r){for(var u=new s(31),h=0;h<31;++h)u[h]=r+=1<<e[h-1];var p=new l(u[30]);for(h=1;h<30;++h)for(var m=u[h];m<u[h+1];++m)p[m]=m-u[h]<<5|h;return[u,p]},m=f(u,2),v=m[0],x=m[1];v[28]=258,x[258]=28;for(var b=f(h,0)[0],_=new s(32768),S=0;S<32768;++S){var A=(43690&S)>>>1|(21845&S)<<1;A=(61680&(A=(52428&A)>>>2|(13107&A)<<2))>>>4|(3855&A)<<4,_[S]=((65280&A)>>>8|(255&A)<<8)>>>1}var w=function(e,r,l){for(var u=e.length,h=0,p=new s(r);h<u;++h)++p[e[h]-1];var m,v=new s(r);for(h=0;h<r;++h)v[h]=v[h-1]+p[h-1]<<1;if(l){m=new s(1<<r);var x=15-r;for(h=0;h<u;++h)if(e[h])for(var b=h<<4|e[h],S=r-e[h],A=v[e[h]-1]++<<S,C=A|(1<<S)-1;A<=C;++A)m[_[A]>>>x]=b}else for(m=new s(u),h=0;h<u;++h)e[h]&&(m[h]=_[v[e[h]-1]++]>>>15-e[h]);return m},C=new r(288);for(S=0;S<144;++S)C[S]=8;for(S=144;S<256;++S)C[S]=9;for(S=256;S<280;++S)C[S]=7;for(S=280;S<288;++S)C[S]=8;var R=new r(32);for(S=0;S<32;++S)R[S]=5;var E=w(C,9,1),I=w(R,5,1),y=function(e){for(var r=e[0],s=1;s<e.length;++s)e[s]>r&&(r=e[s]);return r},L=function(e,r,s){var l=r/8|0;return(e[l]|e[l+1]<<8)>>(7&r)&s},U=function(e,r){var s=r/8|0;return(e[s]|e[s+1]<<8|e[s+2]<<16)>>(7&r)},F=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],T=function(e,r,s){var l=new Error(r||F[e]);if(l.code=e,Error.captureStackTrace&&Error.captureStackTrace(l,T),!s)throw l;return l},O=function(e,m,x){var _=e.length;if(!_||x&&!x.l&&_<5)return m||new r(0);var S=!m||x,A=!x||x.i;x||(x={}),m||(m=new r(3*_));var C,d=function(e){var s=m.length;if(e>s){var l=new r(Math.max(2*s,e));l.set(m),m=l}},R=x.f||0,F=x.p||0,D=x.b||0,G=x.l,B=x.d,N=x.m,j=x.n,H=8*_;do{if(!G){x.f=R=L(e,F,1);var X=L(e,F+1,3);if(F+=3,!X){var W=e[(te=((C=F)/8|0)+(7&C&&1)+4)-4]|e[te-3]<<8,z=te+W;if(z>_){A&&T(0);break}S&&d(D+W),m.set(e.subarray(te,z),D),x.b=D+=W,x.p=F=8*z;continue}if(1==X)G=E,B=I,N=9,j=5;else if(2==X){var V=L(e,F,31)+257,q=L(e,F+10,15)+4,$=V+L(e,F+5,31)+1;F+=14;for(var K=new r($),Y=new r(19),J=0;J<q;++J)Y[p[J]]=L(e,F+3*J,7);F+=3*q;var Q=y(Y),Z=(1<<Q)-1,ee=w(Y,Q,1);for(J=0;J<$;){var te,re=ee[L(e,F,Z)];if(F+=15&re,(te=re>>>4)<16)K[J++]=te;else{var ne=0,se=0;for(16==te?(se=3+L(e,F,3),F+=2,ne=K[J-1]):17==te?(se=3+L(e,F,7),F+=3):18==te&&(se=11+L(e,F,127),F+=7);se--;)K[J++]=ne}}var oe=K.subarray(0,V),ae=K.subarray(V);N=y(oe),j=y(ae),G=w(oe,N,1),B=w(ae,j,1)}else T(1);if(F>H){A&&T(0);break}}S&&d(D+131072);for(var ie=(1<<N)-1,le=(1<<j)-1,ce=F;;ce=F){var ue=(ne=G[U(e,F)&ie])>>>4;if((F+=15&ne)>H){A&&T(0);break}if(ne||T(2),ue<256)m[D++]=ue;else{if(256==ue){ce=F,G=null;break}var he=ue-254;if(ue>264){var de=u[J=ue-257];he=L(e,F,(1<<de)-1)+v[J],F+=de}var fe=B[U(e,F)&le],pe=fe>>>4;if(fe||T(3),F+=15&fe,ae=b[pe],pe>3&&(de=h[pe],ae+=U(e,F)&(1<<de)-1,F+=de),F>H){A&&T(0);break}S&&d(D+131072);for(var ge=D+he;D<ge;D+=4)m[D]=m[D-ae],m[D+1]=m[D+1-ae],m[D+2]=m[D+2-ae],m[D+3]=m[D+3-ae];D=ge}}x.l=G,x.p=ce,x.b=D,G&&(R=1,x.m=N,x.d=B,x.n=j)}while(!R);return D==m.length?m:function(e,u,h){(null==u||u<0)&&(u=0),(null==h||h>e.length)&&(h=e.length);var p=new(e instanceof s?s:e instanceof l?l:r)(h-u);return p.set(e.subarray(u,h)),p}(m,0,D)},D=new r(0),G="undefined"!=typeof TextDecoder&&new TextDecoder;try{G.decode(D,{stream:!0})}catch(e){}return e.convert_streams=function(e){var r=new DataView(e),s=0;function t(){var e=r.getUint16(s);return s+=2,e}function a(){var e=r.getUint32(s);return s+=4,e}function i(e){A.setUint16(C,e),C+=2}function o(e){A.setUint32(C,e),C+=4}for(var l={signature:a(),flavor:a(),length:a(),numTables:t(),reserved:t(),totalSfntSize:a(),majorVersion:t(),minorVersion:t(),metaOffset:a(),metaLength:a(),metaOrigLength:a(),privOffset:a(),privLength:a()},u=0;Math.pow(2,u)<=l.numTables;)u++;u--;for(var h=16*Math.pow(2,u),p=16*l.numTables-h,m=12,v=[],x=0;x<l.numTables;x++)v.push({tag:a(),offset:a(),compLength:a(),origLength:a(),origChecksum:a()}),m+=16;var b,_=new Uint8Array(12+16*v.length+v.reduce((function(e,r){return e+r.origLength+4}),0)),S=_.buffer,A=new DataView(S),C=0;return o(l.flavor),i(l.numTables),i(h),i(u),i(p),v.forEach((function(e){o(e.tag),o(e.origChecksum),o(m),o(e.origLength),e.outOffset=m,(m+=e.origLength)%4!=0&&(m+=4-m%4)})),v.forEach((function(r){var s,l=e.slice(r.offset,r.offset+r.compLength);if(r.compLength!=r.origLength){var u=new Uint8Array(r.origLength);s=new Uint8Array(l,2),O(s,u)}else u=new Uint8Array(l);_.set(u,r.outOffset);var h=0;(m=r.outOffset+r.origLength)%4!=0&&(h=4-m%4),_.set(new Uint8Array(h).buffer,r.outOffset+r.origLength),b=m+h})),S.slice(0,b)},Object.defineProperty(e,"__esModule",{value:!0}),e}({}).convert_streams},function(e,r){const s={M:2,L:2,Q:4,C:6,Z:0},l={C:"18g,ca,368,1kz",D:"17k,6,2,2+4,5+c,2+6,2+1,10+1,9+f,j+11,2+1,a,2,2+1,15+2,3,j+2,6+3,2+8,2,2,2+1,w+a,4+e,3+3,2,3+2,3+5,23+w,2f+4,3,2+9,2,b,2+3,3,1k+9,6+1,3+1,2+2,2+d,30g,p+y,1,1+1g,f+x,2,sd2+1d,jf3+4,f+3,2+4,2+2,b+3,42,2,4+2,2+1,2,3,t+1,9f+w,2,el+2,2+g,d+2,2l,2+1,5,3+1,2+1,2,3,6,16wm+1v",R:"17m+3,2,2,6+3,m,15+2,2+2,h+h,13,3+8,2,2,3+1,2,p+1,x,5+4,5,a,2,2,3,u,c+2,g+1,5,2+1,4+1,5j,6+1,2,b,2+2,f,2+1,1s+2,2,3+1,7,1ez0,2,2+1,4+4,b,4,3,b,42,2+2,4,3,2+1,2,o+3,ae,ep,x,2o+2,3+1,3,5+1,6",L:"x9u,jff,a,fd,jv",T:"4t,gj+33,7o+4,1+1,7c+18,2,2+1,2+1,2,21+a,2,1b+k,h,2u+6,3+5,3+1,2+3,y,2,v+q,2k+a,1n+8,a,p+3,2+8,2+2,2+4,18+2,3c+e,2+v,1k,2,5+7,5,4+6,b+1,u,1n,5+3,9,l+1,r,3+1,1m,5+1,5+1,3+2,4,v+1,4,c+1,1m,5+4,2+1,5,l+1,n+5,2,1n,3,2+3,9,8+1,c+1,v,1q,d,1f,4,1m+2,6+2,2+3,8+1,c+1,u,1n,3,7,6+1,l+1,t+1,1m+1,5+3,9,l+1,u,21,8+2,2,2j,3+6,d+7,2r,3+8,c+5,23+1,s,2,2,1k+d,2+4,2+1,6+a,2+z,a,2v+3,2+5,2+1,3+1,q+1,5+2,h+3,e,3+1,7,g,jk+2,qb+2,u+2,u+1,v+1,1t+1,2+6,9,3+a,a,1a+2,3c+1,z,3b+2,5+1,a,7+2,64+1,3,1n,2+6,2,2,3+7,7+9,3,1d+d,1,1+1,1s+3,1d,2+4,2,6,15+8,d+1,x+3,3+1,2+2,1l,2+1,4,2+2,1n+7,3+1,49+2,2+c,2+6,5,7,4+1,5j+1l,2+4,ek,3+1,r+4,1e+4,6+5,2p+c,1+3,1,1+2,1+b,2db+2,3y,2p+v,ff+3,30+1,n9x,1+2,2+9,x+1,29+1,7l,4,5,q+1,6,48+1,r+h,e,13+7,q+a,1b+2,1d,3+3,3+1,14,1w+5,3+1,3+1,d,9,1c,1g,2+2,3+1,6+1,2,17+1,9,6n,3,5,fn5,ki+f,h+f,5s,6y+2,ea,6b,46+4,1af+2,2+1,6+3,15+2,5,4m+1,fy+3,as+1,4a+a,4x,1j+e,1l+2,1e+3,3+1,1y+2,11+4,2+7,1r,d+1,1h+8,b+3,3,2o+2,3,2+1,7,4h,4+7,m+1,1m+1,4,12+6,4+4,5g+7,3+2,2,o,2d+5,2,5+1,2+1,6n+3,7+1,2+1,s+1,2e+7,3,2+1,2z,2,3+5,2,2u+2,3+3,2+4,78+8,2+1,75+1,2,5,41+3,3+1,5,x+9,15+5,3+3,9,a+5,3+2,1b+c,2+1,bb+6,2+5,2,2b+l,3+6,2+1,2+1,3f+5,4,2+1,2+6,2,21+1,4,2,9o+1,470+8,at4+4,1o+6,t5,1s+3,2a,f5l+1,2+3,43o+2,a+7,1+7,3+6,v+3,45+2,1j0+1i,5+1d,9,f,n+4,2+e,11t+6,2+g,3+6,2+1,2+4,7a+6,c6+3,15t+6,32+6,1,gzau,v+2n,3l+6n"},u=1,h=2,p=4,m=8,v=16,x=32;let b;function getCharJoiningType(e){if(!b){const e={R:h,L:u,D:p,C:v,U:x,T:m};b=new Map;for(let r in l){let s=0;l[r].split(",").forEach((l=>{let[u,h]=l.split("+");u=parseInt(u,36),h=h?parseInt(h,36):0,b.set(s+=u,e[r]);for(let l=h;l--;)b.set(++s,e[r])}))}}return b.get(e)||x}const _=1,S=2,A=3,C=4,R=[null,"isol","init","fina","medi"];function detectJoiningForms(e){const r=new Uint8Array(e.length);let s=x,l=_,b=-1;for(let R=0;R<e.length;R++){const E=e.codePointAt(R);let I=0|getCharJoiningType(E),F=_;I&m||(s&(u|p|v)?I&(h|p|v)?(F=A,l!==_&&l!==A||r[b]++):I&(u|x)&&(l!==S&&l!==C||r[b]--):s&(h|x)&&(l!==S&&l!==C||r[b]--),l=r[R]=F,s=I,b=R,E>65535&&R++)}return r}function getGlyphClass(r,s){const l=r.GDEF&&r.GDEF.glyphClassDef;return l?e.U._getGlyphClass(s,l):0}function firstNum(...e){for(let r=0;r<e.length;r++)if("number"==typeof e[r])return e[r]}function wrapFontObj(r){const l=Object.create(null),u=r["OS/2"],h=r.hhea,p=r.head.unitsPerEm,m=firstNum(u&&u.sTypoAscender,h&&h.ascender,p),v={unitsPerEm:p,ascender:m,descender:firstNum(u&&u.sTypoDescender,h&&h.descender,0),capHeight:firstNum(u&&u.sCapHeight,m),xHeight:firstNum(u&&u.sxHeight,m),lineGap:firstNum(u&&u.sTypoLineGap,h&&h.lineGap),supportsCodePoint:s=>e.U.codeToGlyph(r,s)>0,forEachGlyph(u,h,p,m){let x=0;const b=1/v.unitsPerEm*h,_=function(r,s){const l=[];for(let u=0;u<s.length;u++){const h=s.codePointAt(u);h>65535&&u++,l.push(e.U.codeToGlyph(r,h))}const u=r.GSUB;if(u){const{lookupList:r,featureList:h}=u;let p;const m=/^(rlig|liga|mset|isol|init|fina|medi|half|pres|blws|ccmp)$/,v=[];h.forEach((u=>{if(m.test(u.tag))for(let h=0;h<u.tab.length;h++){if(v[u.tab[h]])continue;v[u.tab[h]]=!0;const m=r[u.tab[h]],x=/^(isol|init|fina|medi)$/.test(u.tag);x&&!p&&(p=detectJoiningForms(s));for(let s=0;s<l.length;s++)p&&x&&R[p[s]]!==u.tag||e.U._applySubs(l,s,m,r)}}))}return l}(r,u);let S=0;const A=function(r,s){const l=new Int16Array(3*s.length);let u=0;for(;u<s.length;u++){const h=s[u];if(-1===h)continue;l[3*u+2]=r.hmtx.aWidth[h];const p=r.GPOS;if(p){const m=p.lookupList;for(let p=0;p<m.length;p++){const v=m[p];for(let p=0;p<v.tabs.length;p++){const m=v.tabs[p];if(1===v.ltype){if(-1!==e._lctf.coverageIndex(m.coverage,h)&&m.pos){applyValueRecord(m.pos,u);break}}else if(2===v.ltype){let r=null,l=getPrevGlyphIndex();if(-1!==l){const p=e._lctf.coverageIndex(m.coverage,s[l]);if(-1!==p){if(1===m.fmt){const e=m.pairsets[p];for(let s=0;s<e.length;s++)e[s].gid2===h&&(r=e[s])}else if(2===m.fmt){const u=e.U._getGlyphClass(s[l],m.classDef1),p=e.U._getGlyphClass(h,m.classDef2);r=m.matrix[u][p]}if(r){r.val1&&applyValueRecord(r.val1,l),r.val2&&applyValueRecord(r.val2,u);break}}}}else if(4===v.ltype){const r=e._lctf.coverageIndex(m.markCoverage,h);if(-1!==r){const h=getPrevGlyphIndex(isBaseGlyph),p=-1===h?-1:e._lctf.coverageIndex(m.baseCoverage,s[h]);if(-1!==p){const e=m.markArray[r],s=m.baseArray[p][e.markClass];l[3*u]=s.x-e.x+l[3*h]-l[3*h+2],l[3*u+1]=s.y-e.y+l[3*h+1];break}}}else if(6===v.ltype){const p=e._lctf.coverageIndex(m.mark1Coverage,h);if(-1!==p){const h=getPrevGlyphIndex();if(-1!==h){const v=s[h];if(3===getGlyphClass(r,v)){const r=e._lctf.coverageIndex(m.mark2Coverage,v);if(-1!==r){const e=m.mark1Array[p],s=m.mark2Array[r][e.markClass];l[3*u]=s.x-e.x+l[3*h]-l[3*h+2],l[3*u+1]=s.y-e.y+l[3*h+1];break}}}}}}}}else if(r.kern&&!r.cff){const e=getPrevGlyphIndex();if(-1!==e){const u=r.kern.glyph1.indexOf(s[e]);if(-1!==u){const s=r.kern.rval[u].glyph2.indexOf(h);-1!==s&&(l[3*e+2]+=r.kern.rval[u].vals[s])}}}}return l;function getPrevGlyphIndex(e){for(let r=u-1;r>=0;r--)if(-1!==s[r]&&(!e||e(s[r])))return r;return-1}function isBaseGlyph(e){return 1===getGlyphClass(r,e)}function applyValueRecord(e,r){for(let s=0;s<3;s++)l[3*r+s]+=e[s]||0}}(r,_);return _.forEach(((v,_)=>{if(-1!==v){let u=l[v];if(!u){const{cmds:h,crds:p}=e.U.glyphToPath(r,v);let m,x,b,_,S="",A=0;for(let e=0,r=h.length;e<r;e++){const r=s[h[e]];S+=h[e];for(let e=1;e<=r;e++)S+=(e>1?",":"")+p[A++]}if(p.length){m=x=1/0,b=_=-1/0;for(let e=0,r=p.length;e<r;e+=2){let r=p[e],s=p[e+1];r<m&&(m=r),s<x&&(x=s),r>b&&(b=r),s>_&&(_=s)}}else m=b=x=_=0;u=l[v]={index:v,advanceWidth:r.hmtx.aWidth[v],xMin:m,yMin:x,xMax:b,yMax:_,path:S}}m.call(null,u,x+A[3*_]*b,A[3*_+1]*b,S),x+=A[3*_+2]*b,p&&(x+=p*h)}S+=u.codePointAt(S)>65535?2:1})),x}};return v}return function(s){const l=new Uint8Array(s,0,4),u=e._bin.readASCII(l,0,4);if("wOFF"===u)s=r(s);else if("wOF2"===u)throw new Error("woff2 fonts not supported");return wrapFontObj(e.parse(s)[0])}}],init:(e,r,s)=>s(e(),r())});
/*!
Custom bundle of @unicode-font-resolver/client v1.0.2 (https://github.com/lojjic/unicode-font-resolver)
for use in Troika text rendering. 
Original MIT license applies
*/const Bt=defineWorkerModule({name:"FontResolver",dependencies:[function(e,r){const s=Object.create(null),l=Object.create(null);function loadFont(r,u){let h=s[r];h?u(h):l[r]?l[r].push(u):(l[r]=[u],function(r,s){const onError=e=>{console.error(`Failure loading font ${r}`,e)};try{const l=new XMLHttpRequest;l.open("get",r,!0),l.responseType="arraybuffer",l.onload=function(){if(l.status>=400)onError(new Error(l.statusText));else if(l.status>0)try{const u=e(l.response);u.src=r,s(u)}catch(e){onError(e)}},l.onerror=onError,l.send()}catch(e){onError(e)}}(r,(e=>{e.src=r,s[r]=e,l[r].forEach((r=>r(e))),delete l[r]})))}return function(e,l,{lang:u,fonts:h=[],style:p="normal",weight:m="normal",unicodeFontsURL:v}={}){const x=new Uint8Array(e.length),b=[];e.length||allDone();const _=new Map,S=[];if("italic"!==p&&(p="normal"),"number"!=typeof m&&(m="bold"===m?700:400),h&&!Array.isArray(h)&&(h=[h]),(h=h.slice().filter((e=>!e.lang||e.lang.test(u))).reverse()).length){const r=1,l=2;let u=0;!function resolveUserFonts(p=0){for(let m=p,v=e.length;m<v;m++){const p=e.codePointAt(m);if(u===r&&b[x[m-1]].supportsCodePoint(p)||/\s/.test(e[m]))x[m]=x[m-1],u===l&&(S[S.length-1][1]=m);else for(let e=x[m],v=h.length;e<=v;e++)if(e===v){(u===l?S[S.length-1]:S[S.length]=[m,m])[1]=m,u=l}else{x[m]=e;const{src:l,unicodeRange:v}=h[e];if(!v||isCodeInRanges(p,v)){const e=s[l];if(!e)return void loadFont(l,(()=>{resolveUserFonts(m)}));if(e.supportsCodePoint(p)){let s=_.get(e);"number"!=typeof s&&(s=b.length,b.push(e),_.set(e,s)),x[m]=s,u=r;break}}}p>65535&&m+1<v&&(x[m+1]=x[m],m++,u===l&&(S[S.length-1][1]=m))}resolveFallbacks()}()}else S.push([0,e.length-1]),resolveFallbacks();function resolveFallbacks(){if(S.length){const s=S.map((r=>e.substring(r[0],r[1]+1))).join("\n");r.getFontsForString(s,{lang:u||void 0,style:p,weight:m,dataUrl:v}).then((({fontUrls:e,chars:r})=>{const s=b.length;let l=0;S.forEach((e=>{for(let u=0,h=e[1]-e[0];u<=h;u++)x[e[0]+u]=r[l++]+s;l++}));let u=0;e.forEach(((r,l)=>{loadFont(r,(r=>{b[l+s]=r,++u===e.length&&allDone()}))}))}))}else allDone()}function allDone(){l({chars:x,fonts:b})}function isCodeInRanges(e,r){for(let s=0;s<r.length;s++){const[l,u=l]=r[s];if(l<=e&&e<=u)return!0}return!1}}},Gt,function(){return function(e){var n=function(){this.buckets=new Map};n.prototype.add=function(e){var r=e>>5;this.buckets.set(r,(this.buckets.get(r)||0)|1<<(31&e))},n.prototype.has=function(e){var r=this.buckets.get(e>>5);return void 0!==r&&0!=(r&1<<(31&e))},n.prototype.serialize=function(){var e=[];return this.buckets.forEach((function(r,s){e.push((+s).toString(36)+":"+r.toString(36))})),e.join(",")},n.prototype.deserialize=function(e){var r=this;this.buckets.clear(),e.split(",").forEach((function(e){var s=e.split(":");r.buckets.set(parseInt(s[0],36),parseInt(s[1],36))}))};var r=Math.pow(2,8),s=r-1,l=~s;function a(e){var s=function(e){return e&l}(e).toString(16),u=function(e){return(e&l)+r-1}(e).toString(16);return"codepoint-index/plane"+(e>>16)+"/"+s+"-"+u+".json"}function i(e,r){var l=e&s,u=r.codePointAt(l/6|0);return 0!=((u=(u||48)-48)&1<<l%6)}function c(e,r){!function(e,r){var s;(s=e,s.replace(/U\+/gi,"").replace(/^,+|,+$/g,"").split(/,+/).map((function(e){return e.split("-").map((function(e){return parseInt(e.trim(),16)}))}))).forEach((function(e){var s=e[0],l=e[1];void 0===l&&(l=s),r(s,l)}))}(e,(function(e,s){for(var l=e;l<=s;l++)r(l)}))}var u={},h={},p=new WeakMap,m="https://cdn.jsdelivr.net/gh/lojjic/unicode-font-resolver@v1.0.1/packages/data";function d(e){var r=p.get(e);return r||(r=new n,c(e.ranges,(function(e){return r.add(e)})),p.set(e,r)),r}var v,x=new Map;function g(e,r,s){return e[r]?r:e[s]?s:function(e){for(var r in e)return r}(e)}function w(e,r){var s=r;if(!e.includes(s)){s=1/0;for(var l=0;l<e.length;l++)Math.abs(e[l]-r)<Math.abs(s-r)&&(s=e[l])}return s}function k(e){return v||(v=new Set,c("9-D,20,85,A0,1680,2000-200A,2028-202F,205F,3000",(function(e){v.add(e)}))),v.has(e)}return e.CodePointSet=n,e.clearCache=function(){u={},h={}},e.getFontsForString=function(e,r){void 0===r&&(r={});var s,l=r.lang;void 0===l&&(l=/\p{Script=Hangul}/u.test(s=e)?"ko":/\p{Script=Hiragana}|\p{Script=Katakana}/u.test(s)?"ja":"en");var p=r.category;void 0===p&&(p="sans-serif");var v=r.style;void 0===v&&(v="normal");var b=r.weight;void 0===b&&(b=400);var _=(r.dataUrl||m).replace(/\/$/g,""),S=new Map,A=new Uint8Array(e.length),C={},R={},E=new Array(e.length),I=new Map,F=!1;function M(e){var r=x.get(e);return r||(r=fetch(_+"/"+e).then((function(e){if(!e.ok)throw new Error(e.statusText);return e.json().then((function(e){if(!Array.isArray(e)||1!==e[0])throw new Error("Incorrect schema version; need 1, got "+e[0]);return e[1]}))})).catch((function(r){if(_!==m)return F||(console.error('unicode-font-resolver: Failed loading from dataUrl "'+_+'", trying default CDN. '+r.message),F=!0),_=m,x.delete(e),M(e);throw r})),x.set(e,r)),r}for(var P=function(r){var s=e.codePointAt(r),l=a(s);E[r]=l,u[l]||I.has(l)||I.set(l,M(l).then((function(e){u[l]=e}))),s>65535&&(r++,D=r)},D=0;D<e.length;D++)P(D);return Promise.all(I.values()).then((function(){I.clear();for(var n=function(s){var p=e.codePointAt(s),m=null,v=u[E[s]],x=void 0;for(var b in v){var _=R[b];if(void 0===_&&(_=R[b]=new RegExp(b).test(l||"en")),_){for(var S in x=b,v[b])if(i(p,v[b][S])){m=S;break}break}}if(!m)e:for(var A in v)if(A!==x)for(var C in v[A])if(i(p,v[A][C])){m=C;break e}m||(console.debug("No font coverage for U+"+p.toString(16)),m="latin"),E[s]=m,h[m]||I.has(m)||I.set(m,M("font-meta/"+m+".json").then((function(e){h[m]=e}))),p>65535&&(s++,r=s)},r=0;r<e.length;r++)n(r);return Promise.all(I.values())})).then((function(){for(var r,s=null,l=0;l<e.length;l++){var u=e.codePointAt(l);if(s&&(k(u)||d(s).has(u)))A[l]=A[l-1];else{s=h[E[l]];var m=C[s.id];if(!m){var x=s.typeforms,R=g(x,p,"sans-serif"),I=g(x[R],v,"normal"),F=w(null===(r=x[R])||void 0===r?void 0:r[I],b);m=C[s.id]=_+"/font-files/"+s.id+"/"+R+"."+I+"."+F+".woff"}var D=S.get(m);null==D&&(D=S.size,S.set(m,D)),A[l]=D}u>65535&&(l++,A[l]=A[l-1])}return{fontUrls:Array.from(S.keys()),chars:A}}))},Object.defineProperty(e,"__esModule",{value:!0}),e}({})}],init:(e,r,s)=>e(r,s())});const now=()=>(self.performance||Date).now(),Nt=SDFGenerator();let jt;const Ht=[];let Xt=0;function nextChunk(){const e=now();for(;Ht.length&&now()-e<5;)Ht.shift()();Xt=Ht.length?setTimeout(nextChunk,0):0}const generateSDF_GL=(...e)=>new Promise(((r,s)=>{Ht.push((()=>{const l=now();try{Nt.webgl.generateIntoCanvas(...e),r({timing:now()-l})}catch(e){s(e)}})),Xt||(Xt=setTimeout(nextChunk,0))})),Wt=4,zt=2e3,Vt={};let qt=0;function generateSDF_JS_Worker(e,r,s,l,u,h,p,m,v,x){const b="TroikaTextSDFGenerator_JS_"+qt++%Wt;let _=Vt[b];return _||(_=Vt[b]={workerModule:defineWorkerModule({name:b,workerId:b,dependencies:[SDFGenerator,now],init(e,r){const s=e().javascript.generate;return function(...e){const l=r();return{textureData:s(...e),timing:r()-l}}},getTransferables:e=>[e.textureData.buffer]}),requests:0,idleTimer:null}),_.requests++,clearTimeout(_.idleTimer),_.workerModule(e,r,s,l,u,h).then((({textureData:s,timing:l})=>{const u=now(),h=new Uint8Array(4*s.length);for(let e=0;e<s.length;e++)h[4*e+x]=s[e];return Nt.webglUtils.renderImageData(p,h,m,v,e,r,1<<3-x),l+=now()-u,0==--_.requests&&(_.idleTimer=setTimeout((()=>{!function(e){Rt[e]&&Rt[e].forEach((function(e){e()})),Ct[e]&&(Ct[e].terminate(),delete Ct[e])}(b)}),zt)),{timing:l}}))}const $t=Nt.webglUtils.resizeWebGLCanvasWithoutClearing,Kt={defaultFontURL:null,unicodeFontsURL:null,sdfGlyphSize:64,sdfMargin:1/16,sdfExponent:9,textureWidth:2048},Yt=new x;let Jt=!1;function now$1(){return(self.performance||Date).now()}const Qt=Object.create(null);function getTextRenderInfo(e,r){Jt=!0,e=assign({},e);const s=now$1(),{defaultFontURL:l}=Kt,u=[];if(l&&u.push({label:"default",src:toAbsoluteURL(l)}),e.font&&u.push({label:"user",src:toAbsoluteURL(e.font)}),e.font=u,e.text=""+e.text,e.sdfGlyphSize=e.sdfGlyphSize||Kt.sdfGlyphSize,e.unicodeFontsURL=e.unicodeFontsURL||Kt.unicodeFontsURL,null!=e.colorRanges){let r={};for(let s in e.colorRanges)if(e.colorRanges.hasOwnProperty(s)){let l=e.colorRanges[s];"number"!=typeof l&&(l=Yt.set(l).getHex()),r[s]=l}e.colorRanges=r}Object.freeze(e);const{textureWidth:h,sdfExponent:p}=Kt,{sdfGlyphSize:m}=e,v=h/m*4;let x=Qt[m];if(!x){const e=document.createElement("canvas");e.width=h,e.height=256*m/v,x=Qt[m]={glyphCount:0,sdfGlyphSize:m,sdfCanvas:e,sdfTexture:new Ae(e,void 0,void 0,void 0,z,z),contextLost:!1,glyphsByFont:new Map},x.sdfTexture.generateMipmaps=!1,function(e){const r=e.sdfCanvas;r.addEventListener("webglcontextlost",(r=>{console.log("Context Lost",r),r.preventDefault(),e.contextLost=!0})),r.addEventListener("webglcontextrestored",(r=>{console.log("Context Restored",r),e.contextLost=!1;const s=[];e.glyphsByFont.forEach((r=>{r.forEach((r=>{s.push(generateGlyphSDF(r,e,!0))}))})),Promise.all(s).then((()=>{safariPre15Workaround(e),e.sdfTexture.needsUpdate=!0}))}))}(x)}const{sdfTexture:b,sdfCanvas:_}=x;tr(e).then((l=>{const{glyphIds:u,glyphFontIndices:S,fontData:A,glyphPositions:C,fontSize:R,timings:E}=l,I=[],F=new Float32Array(4*u.length);let D=0,G=0;const B=now$1(),N=A.map((e=>{let r=x.glyphsByFont.get(e.src);return r||x.glyphsByFont.set(e.src,r=new Map),r}));u.forEach(((e,r)=>{const s=S[r],{src:h,unitsPerEm:p}=A[s];let v=N[s].get(e);if(!v){const{path:r,pathBounds:u}=l.glyphData[h][e],p=Math.max(u[2]-u[0],u[3]-u[1])/m*(Kt.sdfMargin*m+.5),b=x.glyphCount++,_=[u[0]-p,u[1]-p,u[2]+p,u[3]+p];N[s].set(e,v={path:r,atlasIndex:b,sdfViewBox:_}),I.push(v)}const{sdfViewBox:b}=v,_=C[G++],E=C[G++],B=R/p;F[D++]=_+b[0]*B,F[D++]=E+b[1]*B,F[D++]=_+b[2]*B,F[D++]=E+b[3]*B,u[r]=v.atlasIndex})),E.quads=(E.quads||0)+(now$1()-B);const j=now$1();E.sdf={};const H=_.height,X=Math.ceil(x.glyphCount/v),W=Math.pow(2,Math.ceil(Math.log2(X*m)));W>H&&(console.info(`Increasing SDF texture size ${H}->${W}`),$t(_,h,W),b.dispose()),Promise.all(I.map((r=>generateGlyphSDF(r,x,e.gpuAccelerateSDF).then((({timing:e})=>{E.sdf[r.atlasIndex]=e}))))).then((()=>{I.length&&!x.contextLost&&(safariPre15Workaround(x),b.needsUpdate=!0),E.sdfTotal=now$1()-j,E.total=now$1()-s,r(Object.freeze({parameters:e,sdfTexture:b,sdfGlyphSize:m,sdfExponent:p,glyphBounds:F,glyphAtlasIndices:u,glyphColors:l.glyphColors,caretPositions:l.caretPositions,chunkedBounds:l.chunkedBounds,ascender:l.ascender,descender:l.descender,lineHeight:l.lineHeight,capHeight:l.capHeight,xHeight:l.xHeight,topBaseline:l.topBaseline,blockBounds:l.blockBounds,visibleBounds:l.visibleBounds,timings:l.timings}))}))})),Promise.resolve().then((()=>{var e;x.contextLost||(e=_)._warm||(Nt.webgl.isSupported(e),e._warm=!0)}))}function generateGlyphSDF({path:e,atlasIndex:r,sdfViewBox:s},{sdfGlyphSize:l,sdfCanvas:u,contextLost:h},p){if(h)return Promise.resolve({timing:-1});const{textureWidth:m,sdfExponent:v}=Kt,x=Math.max(s[2]-s[0],s[3]-s[1]),b=Math.floor(r/4);return function(e,r,s,l,u,h,p,m,v,x,b=!0){return b?generateSDF_GL(e,r,s,l,u,h,p,m,v,x).then(null,(b=>(jt||(console.warn("WebGL SDF generation failed, falling back to JS",b),jt=!0),generateSDF_JS_Worker(e,r,s,l,u,h,p,m,v,x)))):generateSDF_JS_Worker(e,r,s,l,u,h,p,m,v,x)}(l,l,e,s,x,v,u,b%(m/l)*l,Math.floor(b/(m/l))*l,r%4,p)}function assign(e,r){for(let s in r)r.hasOwnProperty(s)&&(e[s]=r[s]);return e}let Zt;function toAbsoluteURL(e){return Zt||(Zt="undefined"==typeof document?{}:document.createElement("a")),Zt.href=e,Zt.href}function safariPre15Workaround(e){if("function"!=typeof createImageBitmap){console.info("Safari<15: applying SDF canvas workaround");const{sdfCanvas:r,sdfTexture:s}=e,{width:l,height:u}=r,h=e.sdfCanvas.getContext("webgl");let p=s.image.data;p&&p.length===l*u*4||(p=new Uint8Array(l*u*4),s.image={width:l,height:u,data:p},s.flipY=!1,s.isDataTexture=!0),h.readPixels(0,0,l,u,h.RGBA,h.UNSIGNED_BYTE,p)}}const er=defineWorkerModule({name:"Typesetter",dependencies:[function(e,r){const s=1/0,l=/[\u00AD\u034F\u061C\u115F-\u1160\u17B4-\u17B5\u180B-\u180E\u200B-\u200F\u202A-\u202E\u2060-\u206F\u3164\uFE00-\uFE0F\uFEFF\uFFA0\uFFF0-\uFFF8]/,u="[^\\S\\u00A0]",h=new RegExp(`${u}|[\\-\\u007C\\u00AD\\u2010\\u2012-\\u2014\\u2027\\u2056\\u2E17\\u2E40]`);function typeset({text:p="",font:m,lang:v,sdfGlyphSize:x=64,fontSize:b=400,fontWeight:_=1,fontStyle:S="normal",letterSpacing:A=0,lineHeight:C="normal",maxWidth:R=s,direction:E,textAlign:I="left",textIndent:F=0,whiteSpace:D="normal",overflowWrap:G="normal",anchorX:B=0,anchorY:N=0,metricsOnly:j=!1,unicodeFontsURL:H,preResolvedFonts:X=null,includeCaretPositions:W=!1,chunkedBoundsSize:z=8192,colorRanges:V=null},q){const $=now(),K={fontLoad:0,typesetting:0};p.indexOf("\r")>-1&&(console.info("Typesetter: got text with \\r chars; normalizing to \\n"),p=p.replace(/\r\n/g,"\n").replace(/\r/g,"\n")),b=+b,A=+A,R=+R,C=C||"normal",F=+F,function({text:r,lang:s,fonts:l,style:u,weight:h,preResolvedFonts:p,unicodeFontsURL:m},v){const onResolved=({chars:e,fonts:r})=>{let s,l;const u=[];for(let h=0;h<e.length;h++)e[h]!==l?(l=e[h],u.push(s={start:h,end:h,fontObj:r[e[h]]})):s.end=h;v(u)};p?onResolved(p):e(r,onResolved,{lang:s,fonts:l,style:u,weight:h,unicodeFontsURL:m})}({text:p,lang:v,style:S,weight:_,fonts:"string"==typeof m?[{src:m}]:m,unicodeFontsURL:H,preResolvedFonts:X},(e=>{K.fontLoad=now()-$;const m=isFinite(R);let v=null,x=null,_=null,S=null,H=null,X=null,Y=null,J=null,Q=0,Z=0,ee="nowrap"!==D;const te=new Map,re=now();let ne=F,se=0,oe=new TextLine;const ae=[oe];e.forEach((e=>{const{fontObj:r}=e,{ascender:s,descender:v,unitsPerEm:x,lineGap:_,capHeight:S,xHeight:E}=r;let I=te.get(r);if(!I){const e=b/x,l="normal"===C?(s-v+_)*e:C*b,u=(l-(s-v)*e)/2,h=Math.min(l,(s-v)*e),p=(s+v)/2*e+h/2;I={index:te.size,src:r.src,fontObj:r,fontSizeMult:e,unitsPerEm:x,ascender:s*e,descender:v*e,capHeight:S*e,xHeight:E*e,lineHeight:l,baseline:-u-s*e,caretTop:(s+v)/2*e+h/2,caretBottom:p-h},te.set(r,I)}const{fontSizeMult:D}=I,B=p.slice(e.start,e.end+1);let N,j;r.forEachGlyph(B,b,A,((r,s,v,x)=>{s+=se,x+=e.start,N=s,j=r;const _=p.charAt(x),S=r.advanceWidth*D,C=oe.count;let E;if("isEmpty"in r||(r.isWhitespace=!!_&&new RegExp(u).test(_),r.canBreakAfter=!!_&&h.test(_),r.isEmpty=r.xMin===r.xMax||r.yMin===r.yMax||l.test(_)),r.isWhitespace||r.isEmpty||Z++,ee&&m&&!r.isWhitespace&&s+S+ne>R&&C){if(oe.glyphAt(C-1).glyphObj.canBreakAfter)E=new TextLine,ne=-s;else for(let e=C;e--;){if(0===e&&"break-word"===G){E=new TextLine,ne=-s;break}if(oe.glyphAt(e).glyphObj.canBreakAfter){E=oe.splitAt(e+1);const r=E.glyphAt(0).x;ne-=r;for(let e=E.count;e--;)E.glyphAt(e).x-=r;break}}E&&(oe.isSoftWrapped=!0,oe=E,ae.push(oe),Q=R)}let B=oe.glyphAt(oe.count);B.glyphObj=r,B.x=s+ne,B.y=v,B.width=S,B.charIndex=x,B.fontData=I,"\n"===_&&(oe=new TextLine,ae.push(oe),ne=-(s+S+A*b)+F)})),se=N+j.advanceWidth*D+A*b}));let ie=0;ae.forEach((e=>{let r=!0;for(let s=e.count;s--;){const l=e.glyphAt(s);r&&!l.glyphObj.isWhitespace&&(e.width=l.x+l.width,e.width>Q&&(Q=e.width),r=!1);let{lineHeight:u,capHeight:h,xHeight:p,baseline:m}=l.fontData;u>e.lineHeight&&(e.lineHeight=u);const v=m-e.baseline;v<0&&(e.baseline+=v,e.cap+=v,e.ex+=v),e.cap=Math.max(e.cap,e.baseline+h),e.ex=Math.max(e.ex,e.baseline+p)}e.baseline-=ie,e.cap-=ie,e.ex-=ie,ie+=e.lineHeight}));let le=0,ce=0;if(B&&("number"==typeof B?le=-B:"string"==typeof B&&(le=-Q*("left"===B?0:"center"===B?.5:"right"===B?1:parsePercent(B)))),N&&("number"==typeof N?ce=-N:"string"==typeof N&&(ce="top"===N?0:"top-baseline"===N?-ae[0].baseline:"top-cap"===N?-ae[0].cap:"top-ex"===N?-ae[0].ex:"middle"===N?ie/2:"bottom"===N?ie:"bottom-baseline"===N?ae[ae.length-1].baseline:parsePercent(N)*ie)),!j){const e=r.getEmbeddingLevels(p,E);v=new Uint16Array(Z),x=new Uint8Array(Z),_=new Float32Array(2*Z),S={},Y=[s,s,-s,-s],J=[],W&&(X=new Float32Array(4*p.length)),V&&(H=new Uint8Array(3*Z));let l,u,h=0,m=-1,b=-1;if(ae.forEach(((A,C)=>{let{count:R,width:E}=A;if(R>0){let C=0;for(let e=R;e--&&A.glyphAt(e).glyphObj.isWhitespace;)C++;let F=0,D=0;if("center"===I)F=(Q-E)/2;else if("right"===I)F=Q-E;else if("justify"===I&&A.isSoftWrapped){let e=0;for(let r=R-C;r--;)A.glyphAt(r).glyphObj.isWhitespace&&e++;D=(Q-E)/e}if(D||F){let e=0;for(let r=0;r<R;r++){let s=A.glyphAt(r);const l=s.glyphObj;s.x+=F+e,0!==D&&l.isWhitespace&&r<R-C&&(e+=D,s.width+=D)}}const G=r.getReorderSegments(p,e,A.glyphAt(0).charIndex,A.glyphAt(A.count-1).charIndex);for(let e=0;e<G.length;e++){const[r,s]=G[e];let l=1/0,u=-1/0;for(let e=0;e<R;e++)if(A.glyphAt(e).charIndex>=r){let r=e,h=e;for(;h<R;h++){let e=A.glyphAt(h);if(e.charIndex>s)break;h<R-C&&(l=Math.min(l,e.x),u=Math.max(u,e.x+e.width))}for(let e=r;e<h;e++){const r=A.glyphAt(e);r.x=u-(r.x+r.width-l)}break}}let B;const setGlyphObj=e=>B=e;for(let C=0;C<R;C++){const R=A.glyphAt(C);B=R.glyphObj;const E=B.index,I=1&e.levels[R.charIndex];if(I){const e=r.getMirroredCharacter(p[R.charIndex]);e&&R.fontData.fontObj.forEachGlyph(e,0,0,setGlyphObj)}if(W){const{charIndex:e,fontData:r}=R,s=R.x+le,l=R.x+R.width+le;X[4*e]=I?l:s,X[4*e+1]=I?s:l,X[4*e+2]=A.baseline+r.caretBottom+ce,X[4*e+3]=A.baseline+r.caretTop+ce;const u=e-m;u>1&&fillLigatureCaretPositions(X,m,u),m=e}if(V){const{charIndex:e}=R;for(;e>b;)b++,V.hasOwnProperty(b)&&(u=V[b])}if(!B.isWhitespace&&!B.isEmpty){const e=h++,{fontSizeMult:r,src:p,index:m}=R.fontData,b=S[p]||(S[p]={});b[E]||(b[E]={path:B.path,pathBounds:[B.xMin,B.yMin,B.xMax,B.yMax]});const C=R.x+le,I=R.y+A.baseline+ce;_[2*e]=C,_[2*e+1]=I;const F=C+B.xMin*r,D=I+B.yMin*r,G=C+B.xMax*r,N=I+B.yMax*r;F<Y[0]&&(Y[0]=F),D<Y[1]&&(Y[1]=D),G>Y[2]&&(Y[2]=G),N>Y[3]&&(Y[3]=N),e%z==0&&(l={start:e,end:e,rect:[s,s,-s,-s]},J.push(l)),l.end++;const j=l.rect;if(F<j[0]&&(j[0]=F),D<j[1]&&(j[1]=D),G>j[2]&&(j[2]=G),N>j[3]&&(j[3]=N),v[e]=E,x[e]=m,V){const r=3*e;H[r]=u>>16&255,H[r+1]=u>>8&255,H[r+2]=255&u}}}}})),X){const e=p.length-m;e>1&&fillLigatureCaretPositions(X,m,e)}}const ue=[];te.forEach((({index:e,src:r,unitsPerEm:s,ascender:l,descender:u,lineHeight:h,capHeight:p,xHeight:m})=>{ue[e]={src:r,unitsPerEm:s,ascender:l,descender:u,lineHeight:h,capHeight:p,xHeight:m}})),K.typesetting=now()-re,q({glyphIds:v,glyphFontIndices:x,glyphPositions:_,glyphData:S,fontData:ue,caretPositions:X,glyphColors:H,chunkedBounds:J,fontSize:b,topBaseline:ce+ae[0].baseline,blockBounds:[le,ce-ie,le+Q,ce],visibleBounds:Y,timings:K})}))}function parsePercent(e){let r=e.match(/^([\d.]+)%$/),s=r?parseFloat(r[1]):NaN;return isNaN(s)?0:s/100}function fillLigatureCaretPositions(e,r,s){const l=e[4*r],u=e[4*r+1],h=e[4*r+2],p=e[4*r+3],m=(u-l)/s;for(let u=0;u<s;u++){const s=4*(r+u);e[s]=l+m*u,e[s+1]=l+m*(u+1),e[s+2]=h,e[s+3]=p}}function now(){return(self.performance||Date).now()}function TextLine(){this.data=[]}const p=["glyphObj","x","y","width","charIndex","fontData"];return TextLine.prototype={width:0,lineHeight:0,baseline:0,cap:0,ex:0,isSoftWrapped:!1,get count(){return Math.ceil(this.data.length/p.length)},glyphAt(e){let r=TextLine.flyweight;return r.data=this.data,r.index=e,r},splitAt(e){let r=new TextLine;return r.data=this.data.splice(e*p.length),r}},TextLine.flyweight=p.reduce(((e,r,s,l)=>(Object.defineProperty(e,r,{get(){return this.data[this.index*p.length+s]},set(e){this.data[this.index*p.length+s]=e}}),e)),{data:null,index:0}),{typeset:typeset,measure:function(e,r){typeset({...e,metricsOnly:!0},(e=>{const[s,l,u,h]=e.blockBounds;r({width:u-s,height:h-l})}))}}},Bt,function(){return function(e){var r={R:"13k,1a,2,3,3,2+1j,ch+16,a+1,5+2,2+n,5,a,4,6+16,4+3,h+1b,4mo,179q,2+9,2+11,2i9+7y,2+68,4,3+4,5+13,4+3,2+4k,3+29,8+cf,1t+7z,w+17,3+3m,1t+3z,16o1+5r,8+30,8+mc,29+1r,29+4v,75+73",EN:"1c+9,3d+1,6,187+9,513,4+5,7+9,sf+j,175h+9,qw+q,161f+1d,4xt+a,25i+9",ES:"17,2,6dp+1,f+1,av,16vr,mx+1,4o,2",ET:"z+2,3h+3,b+1,ym,3e+1,2o,p4+1,8,6u,7c,g6,1wc,1n9+4,30+1b,2n,6d,qhx+1,h0m,a+1,49+2,63+1,4+1,6bb+3,12jj",AN:"16o+5,2j+9,2+1,35,ed,1ff2+9,87+u",CS:"18,2+1,b,2u,12k,55v,l,17v0,2,3,53,2+1,b",B:"a,3,f+2,2v,690",S:"9,2,k",WS:"c,k,4f4,1vk+a,u,1j,335",ON:"x+1,4+4,h+5,r+5,r+3,z,5+3,2+1,2+1,5,2+2,3+4,o,w,ci+1,8+d,3+d,6+8,2+g,39+1,9,6+1,2,33,b8,3+1,3c+1,7+1,5r,b,7h+3,sa+5,2,3i+6,jg+3,ur+9,2v,ij+1,9g+9,7+a,8m,4+1,49+x,14u,2+2,c+2,e+2,e+2,e+1,i+n,e+e,2+p,u+2,e+2,36+1,2+3,2+1,b,2+2,6+5,2,2,2,h+1,5+4,6+3,3+f,16+2,5+3l,3+81,1y+p,2+40,q+a,m+13,2r+ch,2+9e,75+hf,3+v,2+2w,6e+5,f+6,75+2a,1a+p,2+2g,d+5x,r+b,6+3,4+o,g,6+1,6+2,2k+1,4,2j,5h+z,1m+1,1e+f,t+2,1f+e,d+3,4o+3,2s+1,w,535+1r,h3l+1i,93+2,2s,b+1,3l+x,2v,4g+3,21+3,kz+1,g5v+1,5a,j+9,n+v,2,3,2+8,2+1,3+2,2,3,46+1,4+4,h+5,r+5,r+a,3h+2,4+6,b+4,78,1r+24,4+c,4,1hb,ey+6,103+j,16j+c,1ux+7,5+g,fsh,jdq+1t,4,57+2e,p1,1m,1m,1m,1m,4kt+1,7j+17,5+2r,d+e,3+e,2+e,2+10,m+4,w,1n+5,1q,4z+5,4b+rb,9+c,4+c,4+37,d+2g,8+b,l+b,5+1j,9+9,7+13,9+t,3+1,27+3c,2+29,2+3q,d+d,3+4,4+2,6+6,a+o,8+6,a+2,e+6,16+42,2+1i",BN:"0+8,6+d,2s+5,2+p,e,4m9,1kt+2,2b+5,5+5,17q9+v,7k,6p+8,6+1,119d+3,440+7,96s+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+75,6p+2rz,1ben+1,1ekf+1,1ekf+1",NSM:"lc+33,7o+6,7c+18,2,2+1,2+1,2,21+a,1d+k,h,2u+6,3+5,3+1,2+3,10,v+q,2k+a,1n+8,a,p+3,2+8,2+2,2+4,18+2,3c+e,2+v,1k,2,5+7,5,4+6,b+1,u,1n,5+3,9,l+1,r,3+1,1m,5+1,5+1,3+2,4,v+1,4,c+1,1m,5+4,2+1,5,l+1,n+5,2,1n,3,2+3,9,8+1,c+1,v,1q,d,1f,4,1m+2,6+2,2+3,8+1,c+1,u,1n,g+1,l+1,t+1,1m+1,5+3,9,l+1,u,21,8+2,2,2j,3+6,d+7,2r,3+8,c+5,23+1,s,2,2,1k+d,2+4,2+1,6+a,2+z,a,2v+3,2+5,2+1,3+1,q+1,5+2,h+3,e,3+1,7,g,jk+2,qb+2,u+2,u+1,v+1,1t+1,2+6,9,3+a,a,1a+2,3c+1,z,3b+2,5+1,a,7+2,64+1,3,1n,2+6,2,2,3+7,7+9,3,1d+g,1s+3,1d,2+4,2,6,15+8,d+1,x+3,3+1,2+2,1l,2+1,4,2+2,1n+7,3+1,49+2,2+c,2+6,5,7,4+1,5j+1l,2+4,k1+w,2db+2,3y,2p+v,ff+3,30+1,n9x+3,2+9,x+1,29+1,7l,4,5,q+1,6,48+1,r+h,e,13+7,q+a,1b+2,1d,3+3,3+1,14,1w+5,3+1,3+1,d,9,1c,1g,2+2,3+1,6+1,2,17+1,9,6n,3,5,fn5,ki+f,h+f,r2,6b,46+4,1af+2,2+1,6+3,15+2,5,4m+1,fy+3,as+1,4a+a,4x,1j+e,1l+2,1e+3,3+1,1y+2,11+4,2+7,1r,d+1,1h+8,b+3,3,2o+2,3,2+1,7,4h,4+7,m+1,1m+1,4,12+6,4+4,5g+7,3+2,2,o,2d+5,2,5+1,2+1,6n+3,7+1,2+1,s+1,2e+7,3,2+1,2z,2,3+5,2,2u+2,3+3,2+4,78+8,2+1,75+1,2,5,41+3,3+1,5,x+5,3+1,15+5,3+3,9,a+5,3+2,1b+c,2+1,bb+6,2+5,2d+l,3+6,2+1,2+1,3f+5,4,2+1,2+6,2,21+1,4,2,9o+1,f0c+4,1o+6,t5,1s+3,2a,f5l+1,43t+2,i+7,3+6,v+3,45+2,1j0+1i,5+1d,9,f,n+4,2+e,11t+6,2+g,3+6,2+1,2+4,7a+6,c6+3,15t+6,32+6,gzhy+6n",AL:"16w,3,2,e+1b,z+2,2+2s,g+1,8+1,b+m,2+t,s+2i,c+e,4h+f,1d+1e,1bwe+dp,3+3z,x+c,2+1,35+3y,2rm+z,5+7,b+5,dt+l,c+u,17nl+27,1t+27,4x+6n,3+d",LRO:"6ct",RLO:"6cu",LRE:"6cq",RLE:"6cr",PDF:"6cs",LRI:"6ee",RLI:"6ef",FSI:"6eg",PDI:"6eh"},s={},l={};s.L=1,l[1]="L",Object.keys(r).forEach((function(e,r){s[e]=1<<r+1,l[s[e]]=e})),Object.freeze(s);var u=s.LRI|s.RLI|s.FSI,h=s.L|s.R|s.AL,p=s.B|s.S|s.WS|s.ON|s.FSI|s.LRI|s.RLI|s.PDI,m=s.BN|s.RLE|s.LRE|s.RLO|s.LRO|s.PDF,v=s.S|s.WS|s.B|u|s.PDI|m,x=null;function getBidiCharType(e){return function(){if(!x){x=new Map;var loop=function(e){if(r.hasOwnProperty(e)){var l=0;r[e].split(",").forEach((function(r){var u=r.split("+"),h=u[0],p=u[1];h=parseInt(h,36),p=p?parseInt(p,36):0,x.set(l+=h,s[e]);for(var m=0;m<p;m++)x.set(++l,s[e])}))}};for(var e in r)loop(e)}}(),x.get(e.codePointAt(0))||s.L}var b,_,S,A={pairs:"14>1,1e>2,u>2,2wt>1,1>1,1ge>1,1wp>1,1j>1,f>1,hm>1,1>1,u>1,u6>1,1>1,+5,28>1,w>1,1>1,+3,b8>1,1>1,+3,1>3,-1>-1,3>1,1>1,+2,1s>1,1>1,x>1,th>1,1>1,+2,db>1,1>1,+3,3>1,1>1,+2,14qm>1,1>1,+1,4q>1,1e>2,u>2,2>1,+1",canonical:"6f1>-6dx,6dy>-6dx,6ec>-6ed,6ee>-6ed,6ww>2jj,-2ji>2jj,14r4>-1e7l,1e7m>-1e7l,1e7m>-1e5c,1e5d>-1e5b,1e5c>-14qx,14qy>-14qx,14vn>-1ecg,1ech>-1ecg,1edu>-1ecg,1eci>-1ecg,1eda>-1ecg,1eci>-1ecg,1eci>-168q,168r>-168q,168s>-14ye,14yf>-14ye"};function parseCharacterMap(e,r){var s,l=0,u=new Map,h=r&&new Map;return e.split(",").forEach((function visit(e){if(-1!==e.indexOf("+"))for(var p=+e;p--;)visit(s);else{s=e;var m=e.split(">"),v=m[0],x=m[1];v=String.fromCodePoint(l+=parseInt(v,36)),x=String.fromCodePoint(l+=parseInt(x,36)),u.set(v,x),r&&h.set(x,v)}})),{map:u,reverseMap:h}}function parse$1(){if(!b){var e=parseCharacterMap(A.pairs,!0),r=e.map,s=e.reverseMap;b=r,_=s,S=parseCharacterMap(A.canonical,!1).map}}function openingToClosingBracket(e){return parse$1(),b.get(e)||null}function closingToOpeningBracket(e){return parse$1(),_.get(e)||null}function getCanonicalBracket(e){return parse$1(),S.get(e)||null}var C=s.L,R=s.R,E=s.EN,I=s.ES,F=s.ET,D=s.AN,G=s.CS,B=s.B,N=s.S,j=s.ON,H=s.BN,X=s.NSM,W=s.AL,z=s.LRO,V=s.RLO,q=s.LRE,$=s.RLE,K=s.PDF,Y=s.LRI,J=s.RLI,Q=s.FSI,Z=s.PDI;var ee,te="14>1,j>2,t>2,u>2,1a>g,2v3>1,1>1,1ge>1,1wd>1,b>1,1j>1,f>1,ai>3,-2>3,+1,8>1k0,-1jq>1y7,-1y6>1hf,-1he>1h6,-1h5>1ha,-1h8>1qi,-1pu>1,6>3u,-3s>7,6>1,1>1,f>1,1>1,+2,3>1,1>1,+13,4>1,1>1,6>1eo,-1ee>1,3>1mg,-1me>1mk,-1mj>1mi,-1mg>1mi,-1md>1,1>1,+2,1>10k,-103>1,1>1,4>1,5>1,1>1,+10,3>1,1>8,-7>8,+1,-6>7,+1,a>1,1>1,u>1,u6>1,1>1,+5,26>1,1>1,2>1,2>2,8>1,7>1,4>1,1>1,+5,b8>1,1>1,+3,1>3,-2>1,2>1,1>1,+2,c>1,3>1,1>1,+2,h>1,3>1,a>1,1>1,2>1,3>1,1>1,d>1,f>1,3>1,1a>1,1>1,6>1,7>1,13>1,k>1,1>1,+19,4>1,1>1,+2,2>1,1>1,+18,m>1,a>1,1>1,lk>1,1>1,4>1,2>1,f>1,3>1,1>1,+3,db>1,1>1,+3,3>1,1>1,+2,14qm>1,1>1,+1,6>1,4j>1,j>2,t>2,u>2,2>1,+1";function getMirroredCharacter(e){return function(){if(!ee){var e=parseCharacterMap(te,!0),r=e.map;e.reverseMap.forEach((function(e,s){r.set(s,e)})),ee=r}}(),ee.get(e)||null}function getReorderSegments(e,r,s,l){var u=e.length;s=Math.max(0,null==s?0:+s),l=Math.min(u-1,null==l?u-1:+l);var h=[];return r.paragraphs.forEach((function(u){var p=Math.max(s,u.start),m=Math.min(l,u.end);if(p<m){for(var x=r.levels.slice(p,m+1),b=m;b>=p&&getBidiCharType(e[b])&v;b--)x[b]=u.level;for(var _=u.level,S=1/0,A=0;A<x.length;A++){var C=x[A];C>_&&(_=C),C<S&&(S=1|C)}for(var R=_;R>=S;R--)for(var E=0;E<x.length;E++)if(x[E]>=R){for(var I=E;E+1<x.length&&x[E+1]>=R;)E++;E>I&&h.push([I+p,E+p])}}})),h}function getReorderedIndices(e,r,s,l){for(var u=getReorderSegments(e,r,s,l),h=[],p=0;p<e.length;p++)h[p]=p;return u.forEach((function(e){for(var r=e[0],s=e[1],l=h.slice(r,s+1),u=l.length;u--;)h[s-u]=l[u]})),h}return e.closingToOpeningBracket=closingToOpeningBracket,e.getBidiCharType=getBidiCharType,e.getBidiCharTypeName=function(e){return l[getBidiCharType(e)]},e.getCanonicalBracket=getCanonicalBracket,e.getEmbeddingLevels=function(e,r){for(var s=new Uint32Array(e.length),l=0;l<e.length;l++)s[l]=getBidiCharType(e[l]);var x=new Map;function changeCharType(e,r){var l=s[e];s[e]=r,x.set(l,x.get(l)-1),l&p&&x.set(p,x.get(p)-1),x.set(r,(x.get(r)||0)+1),r&p&&x.set(p,(x.get(p)||0)+1)}for(var b=new Uint8Array(e.length),_=new Map,S=[],A=null,ee=0;ee<e.length;ee++)A||S.push(A={start:ee,end:e.length-1,level:"rtl"===r?1:"ltr"===r?0:determineAutoEmbedLevel(ee,!1)}),s[ee]&B&&(A.end=ee,A=null);for(var te=$|q|V|z|u|Z|K|B,nextEven=function(e){return e+(1&e?1:2)},nextOdd=function(e){return e+(1&e?2:1)},re=0;re<S.length;re++){var ne=[{_level:(A=S[re]).level,_override:0,_isolate:0}],se=void 0,oe=0,ae=0,ie=0;x.clear();for(var le=A.start;le<=A.end;le++){var ce=s[le];if(se=ne[ne.length-1],x.set(ce,(x.get(ce)||0)+1),ce&p&&x.set(p,(x.get(p)||0)+1),ce&te)if(ce&($|q)){b[le]=se._level;var ue=(ce===$?nextOdd:nextEven)(se._level);ue<=125&&!oe&&!ae?ne.push({_level:ue,_override:0,_isolate:0}):oe||ae++}else if(ce&(V|z)){b[le]=se._level;var he=(ce===V?nextOdd:nextEven)(se._level);he<=125&&!oe&&!ae?ne.push({_level:he,_override:ce&V?R:C,_isolate:0}):oe||ae++}else if(ce&u){ce&Q&&(ce=1===determineAutoEmbedLevel(le+1,!0)?J:Y),b[le]=se._level,se._override&&changeCharType(le,se._override);var de=(ce===J?nextOdd:nextEven)(se._level);de<=125&&0===oe&&0===ae?(ie++,ne.push({_level:de,_override:0,_isolate:1,_isolInitIndex:le})):oe++}else if(ce&Z){if(oe>0)oe--;else if(ie>0){for(ae=0;!ne[ne.length-1]._isolate;)ne.pop();var fe=ne[ne.length-1]._isolInitIndex;null!=fe&&(_.set(fe,le),_.set(le,fe)),ne.pop(),ie--}se=ne[ne.length-1],b[le]=se._level,se._override&&changeCharType(le,se._override)}else ce&K?(0===oe&&(ae>0?ae--:!se._isolate&&ne.length>1&&(ne.pop(),se=ne[ne.length-1])),b[le]=se._level):ce&B&&(b[le]=A.level);else b[le]=se._level,se._override&&ce!==H&&changeCharType(le,se._override)}for(var pe=[],ge=null,me=A.start;me<=A.end;me++){var ve=s[me];if(!(ve&m)){var ye=b[me],xe=ve&u,be=ve===Z;ge&&ye===ge._level?(ge._end=me,ge._endsWithIsolInit=xe):pe.push(ge={_start:me,_end:me,_level:ye,_startsWithPDI:be,_endsWithIsolInit:xe})}}for(var _e=[],Te=0;Te<pe.length;Te++){var Se=pe[Te];if(!Se._startsWithPDI||Se._startsWithPDI&&!_.has(Se._start)){for(var Ae=[ge=Se],we=void 0;ge&&ge._endsWithIsolInit&&null!=(we=_.get(ge._end));)for(var Ce=Te+1;Ce<pe.length;Ce++)if(pe[Ce]._start===we){Ae.push(ge=pe[Ce]);break}for(var Re=[],Ee=0;Ee<Ae.length;Ee++)for(var Ie=Ae[Ee],Ue=Ie._start;Ue<=Ie._end;Ue++)Re.push(Ue);for(var ke=b[Re[0]],Fe=A.level,Me=Re[0]-1;Me>=0;Me--)if(!(s[Me]&m)){Fe=b[Me];break}var Le=Re[Re.length-1],Pe=b[Le],De=A.level;if(!(s[Le]&u))for(var Oe=Le+1;Oe<=A.end;Oe++)if(!(s[Oe]&m)){De=b[Oe];break}_e.push({_seqIndices:Re,_sosType:Math.max(Fe,ke)%2?R:C,_eosType:Math.max(De,Pe)%2?R:C})}}for(var Ge=0;Ge<_e.length;Ge++){var Be=_e[Ge],Ne=Be._seqIndices,je=Be._sosType,He=Be._eosType,Xe=1&b[Ne[0]]?R:C;if(x.get(X))for(var We=0;We<Ne.length;We++){var ze=Ne[We];if(s[ze]&X){for(var Ve=je,qe=We-1;qe>=0;qe--)if(!(s[Ne[qe]]&m)){Ve=s[Ne[qe]];break}changeCharType(ze,Ve&(u|Z)?j:Ve)}}if(x.get(E))for(var $e=0;$e<Ne.length;$e++){var Ke=Ne[$e];if(s[Ke]&E)for(var Ye=$e-1;Ye>=-1;Ye--){var Je=-1===Ye?je:s[Ne[Ye]];if(Je&h){Je===W&&changeCharType(Ke,D);break}}}if(x.get(W))for(var Qe=0;Qe<Ne.length;Qe++){var Ze=Ne[Qe];s[Ze]&W&&changeCharType(Ze,R)}if(x.get(I)||x.get(G))for(var et=1;et<Ne.length-1;et++){var tt=Ne[et];if(s[tt]&(I|G)){for(var rt=0,nt=0,st=et-1;st>=0&&(rt=s[Ne[st]])&m;st--);for(var ot=et+1;ot<Ne.length&&(nt=s[Ne[ot]])&m;ot++);rt===nt&&(s[tt]===I?rt===E:rt&(E|D))&&changeCharType(tt,rt)}}if(x.get(E))for(var at=0;at<Ne.length;at++){var it=Ne[at];if(s[it]&E){for(var lt=at-1;lt>=0&&s[Ne[lt]]&(F|m);lt--)changeCharType(Ne[lt],E);for(at++;at<Ne.length&&s[Ne[at]]&(F|m|E);at++)s[Ne[at]]!==E&&changeCharType(Ne[at],E)}}if(x.get(F)||x.get(I)||x.get(G))for(var ct=0;ct<Ne.length;ct++){var ut=Ne[ct];if(s[ut]&(F|I|G)){changeCharType(ut,j);for(var ht=ct-1;ht>=0&&s[Ne[ht]]&m;ht--)changeCharType(Ne[ht],j);for(var dt=ct+1;dt<Ne.length&&s[Ne[dt]]&m;dt++)changeCharType(Ne[dt],j)}}if(x.get(E))for(var ft=0,pt=je;ft<Ne.length;ft++){var gt=Ne[ft],mt=s[gt];mt&E?pt===C&&changeCharType(gt,C):mt&h&&(pt=mt)}if(x.get(p)){for(var vt=R|E|D,yt=vt|C,xt=[],bt=[],_t=0;_t<Ne.length;_t++)if(s[Ne[_t]]&p){var Tt=e[Ne[_t]],St=void 0;if(null!==openingToClosingBracket(Tt)){if(!(bt.length<63))break;bt.push({char:Tt,seqIndex:_t})}else if(null!==(St=closingToOpeningBracket(Tt)))for(var At=bt.length-1;At>=0;At--){var wt=bt[At].char;if(wt===St||wt===closingToOpeningBracket(getCanonicalBracket(Tt))||openingToClosingBracket(getCanonicalBracket(wt))===Tt){xt.push([bt[At].seqIndex,_t]),bt.length=At;break}}}xt.sort((function(e,r){return e[0]-r[0]}));for(var Ct=0;Ct<xt.length;Ct++){for(var Rt=xt[Ct],Et=Rt[0],It=Rt[1],Ut=!1,kt=0,Ft=Et+1;Ft<It;Ft++){var Mt=Ne[Ft];if(s[Mt]&yt){Ut=!0;var Lt=s[Mt]&vt?R:C;if(Lt===Xe){kt=Lt;break}}}if(Ut&&!kt){kt=je;for(var Pt=Et-1;Pt>=0;Pt--){var Dt=Ne[Pt];if(s[Dt]&yt){var Ot=s[Dt]&vt?R:C;kt=Ot!==Xe?Ot:Xe;break}}}if(kt){if(s[Ne[Et]]=s[Ne[It]]=kt,kt!==Xe)for(var Gt=Et+1;Gt<Ne.length;Gt++)if(!(s[Ne[Gt]]&m)){getBidiCharType(e[Ne[Gt]])&X&&(s[Ne[Gt]]=kt);break}if(kt!==Xe)for(var Bt=It+1;Bt<Ne.length;Bt++)if(!(s[Ne[Bt]]&m)){getBidiCharType(e[Ne[Bt]])&X&&(s[Ne[Bt]]=kt);break}}}for(var Nt=0;Nt<Ne.length;Nt++)if(s[Ne[Nt]]&p){for(var jt=Nt,Ht=Nt,Xt=je,Wt=Nt-1;Wt>=0;Wt--){if(!(s[Ne[Wt]]&m)){Xt=s[Ne[Wt]]&vt?R:C;break}jt=Wt}for(var zt=He,Vt=Nt+1;Vt<Ne.length;Vt++){if(!(s[Ne[Vt]]&(p|m))){zt=s[Ne[Vt]]&vt?R:C;break}Ht=Vt}for(var qt=jt;qt<=Ht;qt++)s[Ne[qt]]=Xt===zt?Xt:Xe;Nt=Ht}}}for(var $t=A.start;$t<=A.end;$t++){var Kt=b[$t],Yt=s[$t];if(1&Kt?Yt&(C|E|D)&&b[$t]++:Yt&R?b[$t]++:Yt&(D|E)&&(b[$t]+=2),Yt&m&&(b[$t]=0===$t?A.level:b[$t-1]),$t===A.end||getBidiCharType(e[$t])&(N|B))for(var Jt=$t;Jt>=0&&getBidiCharType(e[Jt])&v;Jt--)b[Jt]=A.level}}return{levels:b,paragraphs:S};function determineAutoEmbedLevel(r,l){for(var h=r;h<e.length;h++){var p=s[h];if(p&(R|W))return 1;if(p&(B|C)||l&&p===Z)return 0;if(p&u){var m=indexOfMatchingPDI(h);h=-1===m?e.length:m}}return 0}function indexOfMatchingPDI(r){for(var l=1,h=r+1;h<e.length;h++){var p=s[h];if(p&B)break;if(p&Z){if(0==--l)return h}else p&u&&l++}return-1}},e.getMirroredCharacter=getMirroredCharacter,e.getMirroredCharactersMap=function(e,r,s,l){var u=e.length;s=Math.max(0,null==s?0:+s),l=Math.min(u-1,null==l?u-1:+l);for(var h=new Map,p=s;p<=l;p++)if(1&r[p]){var m=getMirroredCharacter(e[p]);null!==m&&h.set(p,m)}return h},e.getReorderSegments=getReorderSegments,e.getReorderedIndices=getReorderedIndices,e.getReorderedString=function(e,r,s,l){var u=getReorderedIndices(e,r,s,l),h=[].concat(e);return u.forEach((function(s,l){h[l]=(1&r.levels[s]?getMirroredCharacter(e[s]):null)||e[s]})),h.join("")},e.openingToClosingBracket=openingToClosingBracket,Object.defineProperty(e,"__esModule",{value:!0}),e}({})}],init:(e,r,s)=>e(r,s())}),tr=defineWorkerModule({name:"Typesetter",dependencies:[er],init:e=>function(r){return new Promise((s=>{e.typeset(r,s)}))},getTransferables(e){const r=[];for(let s in e)e[s]&&e[s].buffer&&r.push(e[s].buffer);return r}});const rr={};const nr="aTroikaGlyphIndex";class GlyphsGeometry extends Ge{constructor(){super(),this.detail=1,this.curveRadius=0,this.groups=[{start:0,count:1/0,materialIndex:0},{start:0,count:1/0,materialIndex:1}],this.boundingSphere=new Ie,this.boundingBox=new Ee}computeBoundingSphere(){}computeBoundingBox(){}setSide(e){const r=this.getIndex().count;this.setDrawRange(e===Be?r/2:0,e===Q?r:r/2)}set detail(e){if(e!==this._detail){this._detail=e,("number"!=typeof e||e<1)&&(e=1);let r=function(e){let r=rr[e];if(!r){const s=new He(1,1,e,e),l=s.clone(),u=s.attributes,h=l.attributes,p=new ee,m=u.uv.count;for(let e=0;e<m;e++)h.position.array[3*e]*=-1,h.normal.array[3*e+2]*=-1;["position","normal","uv"].forEach((e=>{p.setAttribute(e,new Xe([...u[e].array,...h[e].array],u[e].itemSize))})),p.setIndex([...s.index.array,...l.index.array.map((e=>e+m))]),p.translate(.5,.5,0),r=rr[e]=p}return r}(e);["position","normal","uv"].forEach((e=>{this.attributes[e]=r.attributes[e].clone()})),this.setIndex(r.getIndex().clone())}}get detail(){return this._detail}set curveRadius(e){e!==this._curveRadius&&(this._curveRadius=e,this._updateBounds())}get curveRadius(){return this._curveRadius}updateGlyphs(e,r,s,l,u){updateBufferAttr(this,"aTroikaGlyphBounds",e,4),updateBufferAttr(this,nr,r,1),updateBufferAttr(this,"aTroikaGlyphColor",u,3),this._blockBounds=s,this._chunkedBounds=l,this.instanceCount=r.length,this._updateBounds()}_updateBounds(){const e=this._blockBounds;if(e){const{curveRadius:r,boundingBox:s}=this;if(r){const{PI:l,floor:u,min:h,max:p,sin:m,cos:v}=Math,x=l/2,b=2*l,_=Math.abs(r),S=e[0]/_,A=e[2]/_,C=u((S+x)/b)!==u((A+x)/b)?-_:h(m(S)*_,m(A)*_),R=u((S-x)/b)!==u((A-x)/b)?_:p(m(S)*_,m(A)*_),E=u((S+l)/b)!==u((A+l)/b)?2*_:p(_-v(S)*_,_-v(A)*_);s.min.set(C,e[1],r<0?-E:0),s.max.set(R,e[3],r<0?0:E)}else s.min.set(e[0],e[1],0),s.max.set(e[2],e[3],0);s.getBoundingSphere(this.boundingSphere)}}applyClipRect(e){let r=this.getAttribute(nr).count,s=this._chunkedBounds;if(s)for(let l=s.length;l--;){r=s[l].end;let u=s[l].rect;if(u[1]<e.w&&u[3]>e.y&&u[0]<e.z&&u[2]>e.x)break}this.instanceCount=r}}function updateBufferAttr(e,r,s,l){const u=e.getAttribute(r);s?u&&u.array.length===s.length?(u.array.set(s),u.needsUpdate=!0):(e.setAttribute(r,new G(s,l)),delete e._maxInstanceCount,e.dispose()):u&&e.deleteAttribute(r)}function createTextDerivedMaterial(e){const r=createDerivedMaterial(e,{chained:!0,extensions:{derivatives:!0},uniforms:{uTroikaSDFTexture:{value:null},uTroikaSDFTextureSize:{value:new I},uTroikaSDFGlyphSize:{value:0},uTroikaSDFExponent:{value:0},uTroikaTotalBounds:{value:new Ne(0,0,0,0)},uTroikaClipRect:{value:new Ne(0,0,0,0)},uTroikaDistanceOffset:{value:0},uTroikaOutlineOpacity:{value:0},uTroikaFillOpacity:{value:1},uTroikaPositionOffset:{value:new I},uTroikaCurveRadius:{value:0},uTroikaBlurRadius:{value:0},uTroikaStrokeWidth:{value:0},uTroikaStrokeColor:{value:new x},uTroikaStrokeOpacity:{value:1},uTroikaOrient:{value:new je},uTroikaUseGlyphColors:{value:!0},uTroikaSDFDebug:{value:!1}},vertexDefs:"\nuniform vec2 uTroikaSDFTextureSize;\nuniform float uTroikaSDFGlyphSize;\nuniform vec4 uTroikaTotalBounds;\nuniform vec4 uTroikaClipRect;\nuniform mat3 uTroikaOrient;\nuniform bool uTroikaUseGlyphColors;\nuniform float uTroikaDistanceOffset;\nuniform float uTroikaBlurRadius;\nuniform vec2 uTroikaPositionOffset;\nuniform float uTroikaCurveRadius;\nattribute vec4 aTroikaGlyphBounds;\nattribute float aTroikaGlyphIndex;\nattribute vec3 aTroikaGlyphColor;\nvarying vec2 vTroikaGlyphUV;\nvarying vec4 vTroikaTextureUVBounds;\nvarying float vTroikaTextureChannel;\nvarying vec3 vTroikaGlyphColor;\nvarying vec2 vTroikaGlyphDimensions;\n",vertexTransform:"\nvec4 bounds = aTroikaGlyphBounds;\nbounds.xz += uTroikaPositionOffset.x;\nbounds.yw -= uTroikaPositionOffset.y;\n\nvec4 outlineBounds = vec4(\n  bounds.xy - uTroikaDistanceOffset - uTroikaBlurRadius,\n  bounds.zw + uTroikaDistanceOffset + uTroikaBlurRadius\n);\nvec4 clippedBounds = vec4(\n  clamp(outlineBounds.xy, uTroikaClipRect.xy, uTroikaClipRect.zw),\n  clamp(outlineBounds.zw, uTroikaClipRect.xy, uTroikaClipRect.zw)\n);\n\nvec2 clippedXY = (mix(clippedBounds.xy, clippedBounds.zw, position.xy) - bounds.xy) / (bounds.zw - bounds.xy);\n\nposition.xy = mix(bounds.xy, bounds.zw, clippedXY);\n\nuv = (position.xy - uTroikaTotalBounds.xy) / (uTroikaTotalBounds.zw - uTroikaTotalBounds.xy);\n\nfloat rad = uTroikaCurveRadius;\nif (rad != 0.0) {\n  float angle = position.x / rad;\n  position.xz = vec2(sin(angle) * rad, rad - cos(angle) * rad);\n  normal.xz = vec2(sin(angle), cos(angle));\n}\n  \nposition = uTroikaOrient * position;\nnormal = uTroikaOrient * normal;\n\nvTroikaGlyphUV = clippedXY.xy;\nvTroikaGlyphDimensions = vec2(bounds[2] - bounds[0], bounds[3] - bounds[1]);\n\n\nfloat txCols = uTroikaSDFTextureSize.x / uTroikaSDFGlyphSize;\nvec2 txUvPerSquare = uTroikaSDFGlyphSize / uTroikaSDFTextureSize;\nvec2 txStartUV = txUvPerSquare * vec2(\n  mod(floor(aTroikaGlyphIndex / 4.0), txCols),\n  floor(floor(aTroikaGlyphIndex / 4.0) / txCols)\n);\nvTroikaTextureUVBounds = vec4(txStartUV, vec2(txStartUV) + txUvPerSquare);\nvTroikaTextureChannel = mod(aTroikaGlyphIndex, 4.0);\n",fragmentDefs:"\nuniform sampler2D uTroikaSDFTexture;\nuniform vec2 uTroikaSDFTextureSize;\nuniform float uTroikaSDFGlyphSize;\nuniform float uTroikaSDFExponent;\nuniform float uTroikaDistanceOffset;\nuniform float uTroikaFillOpacity;\nuniform float uTroikaOutlineOpacity;\nuniform float uTroikaBlurRadius;\nuniform vec3 uTroikaStrokeColor;\nuniform float uTroikaStrokeWidth;\nuniform float uTroikaStrokeOpacity;\nuniform bool uTroikaSDFDebug;\nvarying vec2 vTroikaGlyphUV;\nvarying vec4 vTroikaTextureUVBounds;\nvarying float vTroikaTextureChannel;\nvarying vec2 vTroikaGlyphDimensions;\n\nfloat troikaSdfValueToSignedDistance(float alpha) {\n  // Inverse of exponential encoding in webgl-sdf-generator\n  \n  float maxDimension = max(vTroikaGlyphDimensions.x, vTroikaGlyphDimensions.y);\n  float absDist = (1.0 - pow(2.0 * (alpha > 0.5 ? 1.0 - alpha : alpha), 1.0 / uTroikaSDFExponent)) * maxDimension;\n  float signedDist = absDist * (alpha > 0.5 ? -1.0 : 1.0);\n  return signedDist;\n}\n\nfloat troikaGlyphUvToSdfValue(vec2 glyphUV) {\n  vec2 textureUV = mix(vTroikaTextureUVBounds.xy, vTroikaTextureUVBounds.zw, glyphUV);\n  vec4 rgba = texture2D(uTroikaSDFTexture, textureUV);\n  float ch = floor(vTroikaTextureChannel + 0.5); //NOTE: can't use round() in WebGL1\n  return ch == 0.0 ? rgba.r : ch == 1.0 ? rgba.g : ch == 2.0 ? rgba.b : rgba.a;\n}\n\nfloat troikaGlyphUvToDistance(vec2 uv) {\n  return troikaSdfValueToSignedDistance(troikaGlyphUvToSdfValue(uv));\n}\n\nfloat troikaGetAADist() {\n  \n  #if defined(GL_OES_standard_derivatives) || __VERSION__ >= 300\n  return length(fwidth(vTroikaGlyphUV * vTroikaGlyphDimensions)) * 0.5;\n  #else\n  return vTroikaGlyphDimensions.x / 64.0;\n  #endif\n}\n\nfloat troikaGetFragDistValue() {\n  vec2 clampedGlyphUV = clamp(vTroikaGlyphUV, 0.5 / uTroikaSDFGlyphSize, 1.0 - 0.5 / uTroikaSDFGlyphSize);\n  float distance = troikaGlyphUvToDistance(clampedGlyphUV);\n \n  // Extrapolate distance when outside bounds:\n  distance += clampedGlyphUV == vTroikaGlyphUV ? 0.0 : \n    length((vTroikaGlyphUV - clampedGlyphUV) * vTroikaGlyphDimensions);\n\n  \n\n  return distance;\n}\n\nfloat troikaGetEdgeAlpha(float distance, float distanceOffset, float aaDist) {\n  #if defined(IS_DEPTH_MATERIAL) || defined(IS_DISTANCE_MATERIAL)\n  float alpha = step(-distanceOffset, -distance);\n  #else\n\n  float alpha = smoothstep(\n    distanceOffset + aaDist,\n    distanceOffset - aaDist,\n    distance\n  );\n  #endif\n\n  return alpha;\n}\n",fragmentColorTransform:"\nfloat aaDist = troikaGetAADist();\nfloat fragDistance = troikaGetFragDistValue();\nfloat edgeAlpha = uTroikaSDFDebug ?\n  troikaGlyphUvToSdfValue(vTroikaGlyphUV) :\n  troikaGetEdgeAlpha(fragDistance, uTroikaDistanceOffset, max(aaDist, uTroikaBlurRadius));\n\n#if !defined(IS_DEPTH_MATERIAL) && !defined(IS_DISTANCE_MATERIAL)\nvec4 fillRGBA = gl_FragColor;\nfillRGBA.a *= uTroikaFillOpacity;\nvec4 strokeRGBA = uTroikaStrokeWidth == 0.0 ? fillRGBA : vec4(uTroikaStrokeColor, uTroikaStrokeOpacity);\nif (fillRGBA.a == 0.0) fillRGBA.rgb = strokeRGBA.rgb;\ngl_FragColor = mix(fillRGBA, strokeRGBA, smoothstep(\n  -uTroikaStrokeWidth - aaDist,\n  -uTroikaStrokeWidth + aaDist,\n  fragDistance\n));\ngl_FragColor.a *= edgeAlpha;\n#endif\n\nif (edgeAlpha == 0.0) {\n  discard;\n}\n",customRewriter({vertexShader:e,fragmentShader:r}){let s=/\buniform\s+vec3\s+diffuse\b/;return s.test(r)&&(r=r.replace(s,"varying vec3 vTroikaGlyphColor").replace(/\bdiffuse\b/g,"vTroikaGlyphColor"),s.test(e)||(e=e.replace(It,"uniform vec3 diffuse;\n$&\nvTroikaGlyphColor = uTroikaUseGlyphColors ? aTroikaGlyphColor / 255.0 : diffuse;\n"))),{vertexShader:e,fragmentShader:r}}});return r.transparent=!0,Object.defineProperties(r,{isTroikaTextMaterial:{value:!0},shadowSide:{get(){return this.side},set(){}}}),r}const sr=new C({color:16777215,side:Q,transparent:!0}),or=8421504,ar=new h,ir=new F,lr=new F,cr=[],ur=new F,hr="+x+y";function first(e){return Array.isArray(e)?e[0]:e}let getFlatRaycastMesh=()=>{const e=new re(new He(1,1),sr);return getFlatRaycastMesh=()=>e,e},getCurvedRaycastMesh=()=>{const e=new re(new He(1,1,32,1),sr);return getCurvedRaycastMesh=()=>e,e};const dr={type:"syncstart"},fr={type:"synccomplete"},pr=["font","fontSize","fontStyle","fontWeight","lang","letterSpacing","lineHeight","maxWidth","overflowWrap","text","direction","textAlign","textIndent","whiteSpace","anchorX","anchorY","colorRanges","sdfGlyphSize"],gr=pr.concat("material","color","depthOffset","clipRect","curveRadius","orientation","glyphGeometryDetail");class Text extends re{constructor(){super(new GlyphsGeometry,null),this.text="",this.anchorX=0,this.anchorY=0,this.curveRadius=0,this.direction="auto",this.font=null,this.unicodeFontsURL=null,this.fontSize=.1,this.fontWeight="normal",this.fontStyle="normal",this.lang=null,this.letterSpacing=0,this.lineHeight="normal",this.maxWidth=1/0,this.overflowWrap="normal",this.textAlign="left",this.textIndent=0,this.whiteSpace="normal",this.material=null,this.color=null,this.colorRanges=null,this.outlineWidth=0,this.outlineColor=0,this.outlineOpacity=1,this.outlineBlur=0,this.outlineOffsetX=0,this.outlineOffsetY=0,this.strokeWidth=0,this.strokeColor=or,this.strokeOpacity=1,this.fillOpacity=1,this.depthOffset=0,this.clipRect=null,this.orientation=hr,this.glyphGeometryDetail=1,this.sdfGlyphSize=null,this.gpuAccelerateSDF=!0,this.debugSDF=!1}sync(e){this._needsSync&&(this._needsSync=!1,this._isSyncing?(this._queuedSyncs||(this._queuedSyncs=[])).push(e):(this._isSyncing=!0,this.dispatchEvent(dr),getTextRenderInfo({text:this.text,font:this.font,lang:this.lang,fontSize:this.fontSize||.1,fontWeight:this.fontWeight||"normal",fontStyle:this.fontStyle||"normal",letterSpacing:this.letterSpacing||0,lineHeight:this.lineHeight||"normal",maxWidth:this.maxWidth,direction:this.direction||"auto",textAlign:this.textAlign,textIndent:this.textIndent,whiteSpace:this.whiteSpace,overflowWrap:this.overflowWrap,anchorX:this.anchorX,anchorY:this.anchorY,colorRanges:this.colorRanges,includeCaretPositions:!0,sdfGlyphSize:this.sdfGlyphSize,gpuAccelerateSDF:this.gpuAccelerateSDF,unicodeFontsURL:this.unicodeFontsURL},(r=>{this._isSyncing=!1,this._textRenderInfo=r,this.geometry.updateGlyphs(r.glyphBounds,r.glyphAtlasIndices,r.blockBounds,r.chunkedBounds,r.glyphColors);const s=this._queuedSyncs;s&&(this._queuedSyncs=null,this._needsSync=!0,this.sync((()=>{s.forEach((e=>e&&e()))}))),this.dispatchEvent(fr),e&&e()}))))}onBeforeRender(e,r,s,l,u,h){this.sync(),u.isTroikaTextMaterial&&this._prepareForRender(u),u._hadOwnSide=u.hasOwnProperty("side"),this.geometry.setSide(u._actualSide=u.side),u.side=Se}onAfterRender(e,r,s,l,u,h){u._hadOwnSide?u.side=u._actualSide:delete u.side}dispose(){this.geometry.dispose()}get textRenderInfo(){return this._textRenderInfo||null}get material(){let e=this._derivedMaterial;const r=this._baseMaterial||this._defaultMaterial||(this._defaultMaterial=sr.clone());if(e&&e.baseMaterial===r||(e=this._derivedMaterial=createTextDerivedMaterial(r),r.addEventListener("dispose",(function onDispose(){r.removeEventListener("dispose",onDispose),e.dispose()}))),this.outlineWidth||this.outlineBlur||this.outlineOffsetX||this.outlineOffsetY){let r=e._outlineMtl;return r||(r=e._outlineMtl=Object.create(e,{id:{value:e.id+.1}}),r.isTextOutlineMaterial=!0,r.depthWrite=!1,r.map=null,e.addEventListener("dispose",(function onDispose(){e.removeEventListener("dispose",onDispose),r.dispose()}))),[r,e]}return e}set material(e){e&&e.isTroikaTextMaterial?(this._derivedMaterial=e,this._baseMaterial=e.baseMaterial):this._baseMaterial=e}get glyphGeometryDetail(){return this.geometry.detail}set glyphGeometryDetail(e){this.geometry.detail=e}get curveRadius(){return this.geometry.curveRadius}set curveRadius(e){this.geometry.curveRadius=e}get customDepthMaterial(){return first(this.material).getDepthMaterial()}get customDistanceMaterial(){return first(this.material).getDistanceMaterial()}_prepareForRender(e){const r=e.isTextOutlineMaterial,s=e.uniforms,l=this.textRenderInfo;if(l){const{sdfTexture:e,blockBounds:u}=l;s.uTroikaSDFTexture.value=e,s.uTroikaSDFTextureSize.value.set(e.image.width,e.image.height),s.uTroikaSDFGlyphSize.value=l.sdfGlyphSize,s.uTroikaSDFExponent.value=l.sdfExponent,s.uTroikaTotalBounds.value.fromArray(u),s.uTroikaUseGlyphColors.value=!r&&!!l.glyphColors;let h,p,m,v=0,x=0,b=0,_=0,S=0;if(r){let{outlineWidth:e,outlineOffsetX:r,outlineOffsetY:s,outlineBlur:l,outlineOpacity:u}=this;v=this._parsePercent(e)||0,x=Math.max(0,this._parsePercent(l)||0),h=u,_=this._parsePercent(r)||0,S=this._parsePercent(s)||0}else b=Math.max(0,this._parsePercent(this.strokeWidth)||0),b&&(m=this.strokeColor,s.uTroikaStrokeColor.value.set(null==m?or:m),p=this.strokeOpacity,null==p&&(p=1)),h=this.fillOpacity;s.uTroikaDistanceOffset.value=v,s.uTroikaPositionOffset.value.set(_,S),s.uTroikaBlurRadius.value=x,s.uTroikaStrokeWidth.value=b,s.uTroikaStrokeOpacity.value=p,s.uTroikaFillOpacity.value=null==h?1:h,s.uTroikaCurveRadius.value=this.curveRadius||0;let A=this.clipRect;if(A&&Array.isArray(A)&&4===A.length)s.uTroikaClipRect.value.fromArray(A);else{const e=100*(this.fontSize||.1);s.uTroikaClipRect.value.set(u[0]-e,u[1]-e,u[2]+e,u[3]+e)}this.geometry.applyClipRect(s.uTroikaClipRect.value)}s.uTroikaSDFDebug.value=!!this.debugSDF,e.polygonOffset=!!this.depthOffset,e.polygonOffsetFactor=e.polygonOffsetUnits=this.depthOffset||0;const u=r?this.outlineColor||0:this.color;if(null==u)delete e.color;else{const r=e.hasOwnProperty("color")?e.color:e.color=new x;u===r._input&&"object"!=typeof u||r.set(r._input=u)}let h=this.orientation||hr;if(h!==e._orientation){let r=s.uTroikaOrient.value;h=h.replace(/[^-+xyz]/g,"");let l=h!==hr&&h.match(/^([-+])([xyz])([-+])([xyz])$/);if(l){let[,e,s,u,h]=l;ir.set(0,0,0)[s]="-"===e?1:-1,lr.set(0,0,0)[h]="-"===u?-1:1,ar.lookAt(ur,ir.cross(lr),lr),r.setFromMatrix4(ar)}else r.identity();e._orientation=h}}_parsePercent(e){if("string"==typeof e){let r=e.match(/^(-?[\d.]+)%$/),s=r?parseFloat(r[1]):NaN;e=(isNaN(s)?0:s/100)*this.fontSize}return e}localPositionToTextCoords(e,r=new I){r.copy(e);const s=this.curveRadius;return s&&(r.x=Math.atan2(e.x,Math.abs(s)-Math.abs(e.z))*Math.abs(s)),r}worldPositionToTextCoords(e,r=new I){return ir.copy(e),this.localPositionToTextCoords(this.worldToLocal(ir),r)}raycast(e,r){const{textRenderInfo:s,curveRadius:l}=this;if(s){const u=s.blockBounds,h=l?getCurvedRaycastMesh():getFlatRaycastMesh(),p=h.geometry,{position:m,uv:v}=p.attributes;for(let e=0;e<v.count;e++){let r=u[0]+v.getX(e)*(u[2]-u[0]);const s=u[1]+v.getY(e)*(u[3]-u[1]);let h=0;l&&(h=l-Math.cos(r/l)*l,r=Math.sin(r/l)*l),m.setXYZ(e,r,s,h)}p.boundingSphere=this.geometry.boundingSphere,p.boundingBox=this.geometry.boundingBox,h.matrixWorld=this.matrixWorld,h.material.side=this.material.side,cr.length=0,h.raycast(e,cr);for(let e=0;e<cr.length;e++)cr[e].object=this,r.push(cr[e])}}copy(e){const r=this.geometry;return super.copy(e),this.geometry=r,gr.forEach((r=>{this[r]=e[r]})),this}clone(){return(new this.constructor).copy(this)}}pr.forEach((e=>{const r="_private_"+e;Object.defineProperty(Text.prototype,e,{get(){return this[r]},set(e){e!==this[r]&&(this[r]=e,this._needsSync=!0)}})}));const mr=new WeakMap;const vr=new WeakMap;var yr=Object.freeze({__proto__:null,GlyphsGeometry:GlyphsGeometry,Text:Text,configureTextBuilder:function(e){Jt?console.warn("configureTextBuilder called after first font request; will be ignored."):assign(Kt,e)},createTextDerivedMaterial:createTextDerivedMaterial,dumpSDFTextures:function(){Object.keys(Qt).forEach((e=>{const r=Qt[e].sdfCanvas,{width:s,height:l}=r;console.log("%c.",`\n      background: url(${r.toDataURL()});\n      background-size: ${s}px ${l}px;\n      color: transparent;\n      font-size: 0;\n      line-height: ${l}px;\n      padding-left: ${s}px;\n    `)}))},fontResolverWorkerModule:Bt,getCaretAtPoint:function(e,r,s){let l=null;const u=function(e){let r=vr.get(e);if(!r){r=[];const{caretPositions:s}=e;let l;const visitCaret=(e,s,u,h)=>{(!l||u<(l.top+l.bottom)/2)&&r.push(l={bottom:s,top:u,carets:[]}),u>l.top&&(l.top=u),s<l.bottom&&(l.bottom=s),l.carets.push({x:e,y:s,height:u-s,charIndex:h})};let u=0;for(;u<s.length;u+=4)visitCaret(s[u],s[u+2],s[u+3],u/4);visitCaret(s[u-3],s[u-2],s[u-1],u/4)}return vr.set(e,r),r}(e);let h=null;return u.forEach((e=>{(!h||Math.abs(s-(e.top+e.bottom)/2)<Math.abs(s-(h.top+h.bottom)/2))&&(h=e)})),h.carets.forEach((e=>{(!l||Math.abs(r-e.x)<Math.abs(r-l.x))&&(l=e)})),l},getSelectionRects:function(e,r,s){let l;if(e){let u=mr.get(e);if(u&&u.start===r&&u.end===s)return u.rects;const{caretPositions:h}=e;if(s<r){const e=r;r=s,s=e}r=Math.max(r,0),s=Math.min(s,h.length+1),l=[];let p=null;for(let e=r;e<s;e++){const r=h[4*e],s=h[4*e+1],u=Math.min(r,s),m=Math.max(r,s),v=h[4*e+2],x=h[4*e+3];(!p||v!==p.bottom||x!==p.top||u>p.right||m<p.left)&&(p={left:1/0,right:-1/0,bottom:v,top:x},l.push(p)),p.left=Math.min(u,p.left),p.right=Math.max(m,p.right)}l.sort(((e,r)=>r.bottom-e.bottom||e.left-r.left));for(let e=l.length-1;e-- >0;){const r=l[e],s=l[e+1];r.bottom===s.bottom&&r.top===s.top&&r.left<=s.right&&r.right>=s.left&&(s.left=Math.min(s.left,r.left),s.right=Math.max(s.right,r.right),l.splice(e,1))}mr.set(e,{start:r,end:s,rects:l})}return l},getTextRenderInfo:getTextRenderInfo,preloadFont:function({font:e,characters:r,sdfGlyphSize:s},l){getTextRenderInfo({font:e,sdfGlyphSize:s,text:Array.isArray(r)?r.join("\n"):""+r},l)},typesetterWorkerModule:er});const xr="0.0.1";var br;const addGripInteractable=e=>{bt.addInteractable(e)},removeGripInteractable=e=>{bt.removeInteractable(e)},addPointerInteractable=e=>{Tt.addInteractable(e)},removePointerInteractable=e=>{Tt.removeInteractable(e)};const init=async(e,r,s,l,u,h)=>{(br=u)||(br=await async function(){return"xr"in navigator&&(await navigator.xr.isSessionSupported("immersive-vr")||await navigator.xr.isSessionSupported("immersive-ar"))}()?"XR":"ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0?"TOUCH":"POINTER"),xt.init(e,r,br),Tt.init(br,r,s,l,h),bt.init(br,s)},update=e=>{"XR"==br&&(xt.update(e),bt.update()),Tt.update()};export{GripInteractable,bt as GripInteractableHandler,xt as InputHandler,PointerInteractable,Tt as PointerInteractableHandler,yr as TroikaThreeText,addGripInteractable,addPointerInteractable,init,removeGripInteractable,removePointerInteractable,update,xr as version};
